,,,,,,,,,,,,,,,,,,,
//???60
int,IDLE_LIST_MAX,=,100,;,//60,;
if,(idleList.size(),>,IDLE_LIST_MAX)
{
java.util.Random,r,=,new,java.util.Random(RandomUtil.GetRandSeed()),;
//while,(idleList.Count,>,10)
while,(idleList.size(),>,IDLE_LIST_MAX)
{
idleList.remove(r.nextInt(idleList.size())),;
}
}
//??
len,=,idleList.size(),;
for,(i,=,0,;,i,<,len,;,i++)
{
//,contentXml.Append((idleList[i],as,IUserModel).toXMLString()),;
//
if,(logicHasUser(idleList.get(i)))
{
IUserModel,idleUser,=,logicGetUser(idleList.get(i)),;
contentXml.append(idleUser.toXMLString()),;
}
}
//??
Send(session,,XmlInstruction.fengBao(svrAction,,contentXml.toString())),;
//log
Log.WriteStrBySend(svrAction,,session.getRemoteEndPoint().toString()),;
}
catch,(UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorLoadD",,exd.getMessage()),;
}
}
/**,
??????????
@param,session
@param,doc
*/
public,void,doorLeaveRoom_Svr(AppSession,session,,XmlDocument,doc)
{
try
{
//1.???????
//2.??
XmlNode,node,=,doc.SelectSingleNode("/msg/body/room"),;
String,roomId,=,node.getAttributeValue("id"),;
//sr,=,server,response
String,srAction,=,"",;
String,contentXml,=,"",;
//????
logicLeaveRoom_Svr(session.getRemoteEndPoint().toString()),;
//??,,,,,,,,,,,,,,,,
srAction,=,ServerAction.leaveRoom,;
contentXml,=,"<rm,id='",+,roomId,+,"'/>",;
Send(session,,XmlInstruction.fengBao(srAction,,contentXml)),;
}
catch,(JDOMException,|,UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorLeaveRoom_Svr",,exd.getMessage()),;
}
}
/**,
????
@param,session
@param,doc
*/
public,void,doorLeaveRoom(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
//1.???????
//2.??
XmlNode,node,=,doc.SelectSingleNode("/msg/body/room"),;
int,roomId,=,Integer.parseInt(node.getAttributeValue("id")),;
//??roomId???
if,(!logicHasRoom(roomId))
{
return,;
}
if,(!logicHasUserInRoom(session.getRemoteEndPoint().toString(),,roomId))
{
return,;
}
//sr,=,server,response
String,srAction,=,"",;
String,contentXml,=,"",;
//????
logicLeaveRoom(session.getRemoteEndPoint().toString()),;
//??,,,,,
srAction,=,ServerAction.leaveRoom,;
//
contentXml,=,"<rm,id='",+,roomId,+,"'/>",;
Send(session,,XmlInstruction.fengBao(srAction,,contentXml)),;
//log
Log.WriteStrBySend(srAction,,session.getRemoteEndPoint().toString()),;
}
catch,(JDOMException,|,IOException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorLeaveRoom",,exd.getMessage(),exd.getStackTrace()),;
}
}
/**,
@param,session
@param,doc
@param,item
*/
public,void,doorLeaveRoomAndGoHallAutoMatch(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
//1.???????
//2.??
XmlNode,node,=,doc.SelectSingleNode("/msg/body/room"),;
int,roomId,=,Integer.parseInt(node.getAttributeValue("id")),;
//????
if,(!logicHasRoom(roomId))
{
return,;
}
if,(!logicHasUserInRoom(session.getRemoteEndPoint().toString(),,roomId))
{
return,;
}
//sr,=,server,response
String,srAction,=,"",;
String,contentXml,=,"",;
//????
logicLeaveRoom(session.getRemoteEndPoint().toString()),;
//??,,,,,
srAction,=,ServerAction.leaveRoomAndGoHallAutoMatch,;
//
contentXml,=,"<rm,id='",+,roomId,+,"'/>",;
Send(session,,XmlInstruction.fengBao(srAction,,contentXml)),;
//log
Log.WriteStrBySend(srAction,,session.getRemoteEndPoint().toString()),;
}
catch,(JDOMException,|,IOException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorLeaveRoomAndGoHallAutoMatch",,exd.getMessage(),exd.getStackTrace()),;
}
}
/**,
????
?roomId?????
?????????
@param,session
@param,doc,,,,,,,,
*/
public,void,doorSetRvars(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
int,roomId,=,0,;
String,strIpPort,=,"",;
try
{
strIpPort,=,session.getRemoteEndPoint().toString(),;
//<vars><var,n='selectQizi',t='s'><![CDATA[red_pao_1]]></var></vars>
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
roomId,=,Integer.parseInt(node.getAttributeValue("r")),;
//????
if,(!logicHasRoom(roomId))
{
return,;
}
if,(!logicHasUserInRoom(strIpPort,,roomId))
{
return,;
}
//
XmlNode,nodeVars,=,doc.SelectSingleNode("/msg/body/vars"),;
//
IRoomModel,room,=,logicGetRoom(roomId),;
IUserModel,user,=,logicGetUser(strIpPort),;
//save
//??????????,?????????????
int,len,=,nodeVars.ChildNodes().length,;
int,i,=,0,;
String,n,=,"",;
String,v,=,"",;
for,(i,=,0,;,i,<,len,;,i++)
{
n,=,nodeVars.ChildNodes()[i].getAttributeValue("n"),;
v,=,nodeVars.ChildNodes()[i].getText(),;
//?????
//RvarsStatus
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,int,tempRef_sta,;
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,boolean,tempVar,=,!room.chkVars(n,,v,,user.getId(),,nodeVars,,i),;
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,if,(tempVar)
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,{
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,return,;
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,}
}
//
n,=,"",;
v,=,"",;
for,(i,=,0,;,i,<,len,;,i++)
{
n,=,nodeVars.ChildNodes()[i].getAttributeValue("n"),;
v,=,nodeVars.ChildNodes()[i].getText(),;
room.setVars(n,v),;
}
//??
String,saction,=,ServerAction.rVarsUpdate,;
String,contentXml,=,"<room,id='",+,(new,Integer(roomId)).toString(),+,"'>",+,nodeVars.OuterXml(),+,"</room>",;
netTurnRoom(strIpPort,,roomId,,saction,,contentXml),;
//log,,,,,,,,,,,,,,,,
Log.WriteStrByTurn(
SR.getRoom_displayName(),+,String.valueOf(roomId),,
strIpPort,,
saction,,
n,,
nodeVars.OuterXml()),;
}
catch,(JDOMException,|,UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorSetRvars",,exd.getMessage(),exd.getStackTrace()),;
}
try
{
//??,??????????
//??????????
logicCheckGameStart(roomId),;
//??
logicCheckGameStartFirstChuPai(roomId,,strIpPort),;
//??????????,?????????,??????,????
logicCheckGameOver_RoomClear(roomId,,strIpPort),;
//??
//??????????
logicCheckGameOver(roomId,,strIpPort),;
}
catch,(JDOMException,|,IOException,|,RuntimeException,exc)
{
Log.WriteStrByException(CLASS_NAME,,"doorSetRvars",,exc.getMessage(),exc.getStackTrace()),;
}
}
/**,
@param,session
@param,doc
@param,item
*/
public,void,doorSetModuleVars(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
String,strIpPort,=,session.getRemoteEndPoint().toString(),;
if,(!logicHasUser(strIpPort))
{
return,;
}
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
XmlNode,node2,=,doc.SelectSingleNode("/msg/body/vars"),;
IUserModel,user,=,logicGetUser(strIpPort),;
//
RoomModelByToac,roomToac,=,null,;
String,game_result_xml_rc,=,"",;
String,roomXml,=,"",;
//
for,(int,i,=,0,;,i,<,node2.ChildNodes().length,;,i++)
{
String,n,=,node2.ChildNodes()[i].getAttributeValue("n"),;
String,v,=,node2.ChildNodes()[i].getText(),;
//-------------------------------------------------------
String[],setVarsStatus,=,{"",""},;
//
if,(DdzLogic_Toac.name.equals(n))
{
roomToac,=,new,RoomModelByToac(user),;
setVarsStatus,=,roomToac.setVars(n,,v),;
}
else
{
throw,new,IllegalArgumentException("can,not,find,module,name:",+,n),;
}
//-------------------------------------------------------
if,(setVarsStatus[0].equals("True"),||,setVarsStatus[0].equals("true"))
{
//----------------------------------------------------
if,(DdzLogic_Toac.name.equals(n))
{
//send,?????,????,
game_result_xml_rc,=,roomToac.getMatchResultXmlByRc(),;
roomXml,=,roomToac.toXMLString(),;
//
Send(RCConnector.getSocket(),,XmlInstruction.DBfengBao(RCClientAction.updG,,game_result_xml_rc)),;
}
else
{
throw,new,IllegalArgumentException("can,not,find,module,name:",+,n),;
}
//
Log.WriteStrByTurn(SR.getRecordServer_displayName(),,RCConnector.getRemoteEndPoint(),,RCClientAction.updG),;
//----------------------------------------------------
//
Send(session,,XmlInstruction.fengBao(ServerAction.moduleVarsUpdate,,roomXml)),;
//
Log.WriteStrBySend(ServerAction.moduleVarsUpdate,,strIpPort),;
}
else
{
Send(session,,XmlInstruction.fengBao(ServerAction.moduleVarsUpdateKO,,setVarsStatus[1])),;
//
Log.WriteStrBySend(ServerAction.moduleVarsUpdateKO,,strIpPort),;
}
}
}
catch,(JDOMException,|,UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"setModuleVars",,exd.getMessage(),,exd.getStackTrace()),;
}
}
/**,
??user,To,???user?????????
@param,session
@param,doc,,,,,,,,
*/
public,void,doorSetMvars(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
String,strIpPort,=,session.getRemoteEndPoint().toString(),;
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
String,roomId,=,node.getAttributeValue("r"),;
XmlNode,node2,=,doc.SelectSingleNode("/msg/body/vars"),;
//????
if,(!logicHasRoom(Integer.parseInt(roomId)))
{
return,;
}
//
IRoomModel,room,=,logicGetRoom(Integer.parseInt(roomId)),;
//check
if,(logicHasUser(strIpPort))
{
IUserModel,fromUser,=,logicGetUser(strIpPort),;
//<val,n="5a105e8b9d40e1329780d62ea2265d8a",t="s"><![CDATA[askJoinRoom,100]]></val>
for,(int,i,=,0,;,i,<,node2.ChildNodes().length,;,i++)
{
String,n,=,node2.ChildNodes()[i].getAttributeValue("n"),;
String,v,=,node2.ChildNodes()[i].getText(),;//InnerText,;
//???????
IUserModel,fromUserCpy,=,UserModelFactory.Create(fromUser.getStrIpPort(),,fromUser.getId(),,0,,fromUser.getSex(),,fromUser.getAccountName(),,fromUser.getNickName(),,fromUser.getBbs(),,fromUser.getHeadIco()),;
if,(logicHasUserById(v))
{
IUserModel,toUser,=,logicGetUserById(v),;
IUserModel,toUserCpy,=,UserModelFactory.Create(toUser.getStrIpPort(),,toUser.getId(),,0,,toUser.getSex(),,toUser.getAccountName(),,toUser.getNickName(),,toUser.getBbs(),,toUser.getHeadIco()),;
String,msg,=,String.valueOf(room.getTab()),+,",",+,
String.valueOf(room.getId()),+,",",+,
String.valueOf(room.getDig()),+,",",+,
String.valueOf(room.getCarryg()),;
Mail().setMvars(fromUserCpy,,
toUserCpy,,
n,,
msg),;
}
else
{
//????
}
},//end,for
},//end,if
//??
netSendMail(),;
}
catch,(JDOMException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorSetMvars",,exd.getMessage()),;
}
}
/**,
????????
??????????,?????????????
???????????,???????
???????????
@param,session
@param,doc,,,,,,,,
*/
public,void,doorPubMsg(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
String,strIpPort,=,session.getRemoteEndPoint().toString(),;
//<msg,t="sys"><body,action="pubMsg",r="7"><txt><![CDATA[dffddf]]></txt></body></msg>
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
String,roomId,=,node.getAttributeValue("r"),;
//????
//-1,=,roomId,?,?????
if,(!logicHasRoom(Integer.parseInt(roomId)),&&,!roomId.equals("-1"))
{
return,;
}
if,(!logicHasUserInRoom(session.getRemoteEndPoint().toString(),,Integer.parseInt(roomId)),&&,!roomId.equals("-1"))
{
return,;
}
XmlNode,node2,=,doc.SelectSingleNode("/msg/body/txt"),;
//filter
node2.setInnerText(FilterWordManager.replace(node2.InnerText())),;
String,saction,=,ServerAction.pubMsg,;
String,contentXml,=,"<room,id='",+,roomId,+,"'>",+,node2.OuterXml(),+,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
logicGetUser(session.getRemoteEndPoint().toString()).toXMLString(),+,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"</room>",;
netTurnRoom(strIpPort,,Integer.parseInt(roomId),,saction,,contentXml,true),;
//log
Log.WriteStrByTurn(SR.getRoom_displayName(),,roomId,,saction),;
}
catch,(JDOMException,|,UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorPubMsg",,exd.getMessage()),;
}
}
public,void,doorPubAuMsg(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
String,strIpPort,=,session.getRemoteEndPoint().toString(),;
//<msg,t="sys"><body,action="pubMsg",r="7"><txt><![CDATA[dffddf]]></txt></body></msg>
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
String,roomId,=,node.getAttributeValue("r"),;
//????
if,(!logicHasRoom(Integer.parseInt(roomId)))
{
return,;
}
if,(!logicHasUserInRoom(session.getRemoteEndPoint().toString(),,Integer.parseInt(roomId)))
{
return,;
}
XmlNode,node2,=,doc.SelectSingleNode("/msg/body/txt"),;
String,saction,=,ServerAction.pubAuMsg,;
String,contentXml,=,"<room,id='",+,roomId,+,"'>",+,node2.OuterXml(),+,
logicGetUser(session.getRemoteEndPoint().toString()).toXMLString(),+,,
"</room>",;
netTurnRoom(strIpPort,,Integer.parseInt(roomId),,saction,,contentXml,true),;
//log
Log.WriteStrByTurn(SR.getRoom_displayName(),,roomId,,saction),;
}
catch,(JDOMException,|,UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorPubAuMsg",,exd.getMessage()),;
}
}
public,void,doorLoadTopList(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
//
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
String,strIpPort,=,session.getRemoteEndPoint().toString(),;
//???????
if,(!CLIENTAcceptor.hasUser(strIpPort))
{
return,;
}
//
IUserModel,user,=,CLIENTAcceptor.getUser(strIpPort),;
//???????????
//??GM
/*
if,(user.Id,!=,roomCostUid,||
user.NickName,!=,roomCostU)
{
return,;
}
*,*/
//
String,caction,=,RCClientAction.loadTopList,;
StringBuilder,sb,=,new,StringBuilder(),;
sb.append("<game,n='"),;
sb.append(Program.GAME_NAME),;
sb.append("'>"),;
sb.append("<session>").append(strIpPort).append("</session>"),;
sb.append("</game>"),;
String,content,=,sb.toString(),;
//?????????
Send(RCConnector.getSocket(),,XmlInstruction.DBfengBao(caction,,content)),;
//
Log.WriteStrByTurn(SR.getRecordServer_displayName(),,RCConnector.getRemoteEndPoint(),,caction),;
}
catch,(JDOMException,|,UnsupportedEncodingException,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME,,"doorLoadTopList",,exd.getMessage()),;
}
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver,;
/**
*
*,@author,FUX
*/
public,class,DdzLogic_Toac,{
/**,
module,name
*/
public,static,final,String,name,=,"turnOver_a_Card",;
/**,
*/
public,static,int,turnOver_a_Card_module_run,;
/**,
????,???
*/
private,static,float,_costG,;
public,static,float,getcostG()
{
return,_costG,;
}
/**,
?????????
*/
private,static,String,_costU,;
public,static,String,getcostUN()
{
return,_costU,;
}
private,static,String,_costUid,;
public,static,String,getcostUid()
{
return,_costUid,;
}
/**,
@param,value
@param,value2
@param,value3
*/
private,static,void,setCostg(float,value,,String,value2,,String,value3)
{
_costG,=,value,;
_costU,=,value2,;
_costUid,=,value3,;
}
/**,
*/
private,static,long,_g1,;
public,static,long,getg1()
{
return,_g1,;
}
/**,
*/
private,static,long,_g2,;
public,static,long,getg2()
{
return,_g2,;
}
/**,
*/
private,static,long,_g3,;
public,static,long,getg3()
{
return,_g3,;
}
/**,
@param,turnOver_a_Card_module_run_
@param,g1_
@param,g2_
@param,g3_
*/
public,static,void,init(String,costUser_,,int,turnOver_a_Card_module_run_,,long,g1_,,long,g2_,,long,g3_,,float,turnOver_a_Card_module_costG_)
{
turnOver_a_Card_module_run,=,turnOver_a_Card_module_run_,;
_g1,=,g1_,;
_g2,=,g2_,;
_g3,=,g3_,;
//,,,,,,,,,,,,
String,costUid_,=,costUser_.equals(""),?,"":DdzLogic.getInstance().getMd5Hash(costUser_),;
setCostg(turnOver_a_Card_module_costG_,,costUser_,,costUid_),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver,;
import,net.silverfoxserver.core.util.SR,;
import,net.silverfoxserver.core.socket.SessionMessage,;
import,net.silverfoxserver.core.socket.AppSession,;
import,net.silverfoxserver.core.log.Log,;
import,System.Xml.XmlDocument,;
import,java.io.IOException,;
import,java.io.UnsupportedEncodingException,;
import,java.util.Timer,;
import,java.util.logging.Level,;
import,java.util.logging.Logger,;
import,net.silverfoxserver.core.array.QueueMethod,;
import,net.silverfoxserver.core.array.SessionMsgQueue,;
import,net.silverfoxserver.core.array.SmqOppResult,;
import,net.silverfoxserver.core.protocol.ClientAction,;
import,net.silverfoxserver.core.protocol.DBServerAction,;
import,net.silverfoxserver.core.protocol.RCServerAction,;
import,net.silverfoxserver.core.protocol.ServerAction,;
import,net.silverfoxserver.core.server.GameLPU,;
import,org.jboss.netty.channel.ChannelEvent,;
import,org.jboss.netty.channel.MessageEvent,;
import,org.jdom2.JDOMException,;
/**
*
*,@author,FUX
*/
public,class,DdzLPU,extends,GameLPU{
/**
*,??
*,
*/
private,static,DdzLPU,_instance,=,null,;
public,static,DdzLPU,getInstance()
{
if(null,==,_instance)
{
_instance,=,new,DdzLPU(),;
}
return,_instance,;
},,,
@Override
public,void,init()
{
getMsgTimer().schedule(new,MsgTimedTask(),,0,,GameLPU.DELAY),;
//_msgTimer.Enabled,=,true,;
}
@Override
public,void,msgTimedEvent(),throws,UnsupportedEncodingException
{
SmqOppResult,ruCount,=,getmsgList().Opp(QueueMethod.Count,,null),;
int,len,=,ruCount.count,;
for,(int,i,=,0,;,i,<,len,;,i++)
{
//C#,TO,JAVA,CONVERTER,TODO,TASK:,There,is,no,preprocessor,in,Java:
///#region,?????Session
SmqOppResult,ruShift,=,getmsgList().Opp(QueueMethod.Shift,,null),;
if,(!ruShift.oppSucess)
{
Log.WriteStrByArgument(DdzLPU.class.getName(),,"msgTimedEvent",,"QueueMethod.Shift",,"oppSucess,is,false"),;
continue,;
}
if(null,==,ruShift.item)
{
Log.WriteStrByArgument(DdzLPU.class.getName(),,"msgTimedEvent",,"QueueMethod.Shift",,"item,is,null"),;
continue,;
}
SessionMessage,item,=,ruShift.item,;
//
XmlDocument,doc,=,item.doc(),;
String,strIpPort,=,item.strIpPort(),;
String,action,=,item.action(),;
ChannelEvent,e,=,item.e(),;
item.Dereference(),;
AppSession,c,=,new,AppSession(e.getChannel(),e),;
//
if,(!item.getfromServer())
{
if,(action.equals(ClientAction.verChk))
{
DdzLogic.getInstance().doorVerChk(c,,doc),;
continue,;
}
if,(action.equals(ClientAction.loadDBType))
{
DdzLogic.getInstance().doorLoadDBType(c,,doc),;
continue,;
}
if,(action.equals(ClientAction.hasReg))
{
DdzLogic.getInstance().doorHasReg(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.reg))
{
DdzLogic.getInstance().doorReg(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.login))
{
DdzLogic.getInstance().doorLogin(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.heartBeat))
{
DdzLogic.getInstance().doorHeartBeat(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.loadG))
{
DdzLogic.getInstance().doorLoadG(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.loadD))
{
DdzLogic.getInstance().doorLoadD(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.listModule))
{
DdzLogic.getInstance().doorListModule(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.listRoom))
{
DdzLogic.getInstance().doorListRoom(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.joinRoom))
{
DdzLogic.getInstance().doorJoinRoom(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.joinReconnectionRoom))
{
DdzLogic.getInstance().doorJoinReconnectionRoom(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.autoJoinRoom))
{
DdzLogic.getInstance().doorAutoJoinRoom(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.autoMatchRoom))
{
DdzLogic.getInstance().doorAutoMatchRoom(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.pubMsg))
{
DdzLogic.getInstance().doorPubMsg(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.pubAuMsg))
{
DdzLogic.getInstance().doorPubAuMsg(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.setRvars))
{
DdzLogic.getInstance().doorSetRvars(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.setMvars))
{
DdzLogic.getInstance().doorSetMvars(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.setModuleVars))
{
DdzLogic.getInstance().doorSetModuleVars(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.leaveRoom))
{
DdzLogic.getInstance().doorLeaveRoom(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.leaveRoomAndGoHallAutoMatch))
{
DdzLogic.getInstance().doorLeaveRoomAndGoHallAutoMatch(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.loadTopList))
{
DdzLogic.getInstance().doorLoadTopList(c,,doc,,item),;
continue,;
}
if,(action.equals(ClientAction.sessionClosed))
{
try,{
DdzLogic.getInstance().logicSessionClosed(strIpPort),;
},catch,(JDOMException,ex),{
Log.WriteStr(ex.getMessage()),;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
},catch,(IOException,ex),{
Log.WriteStr(ex.getMessage()),;
}
continue,;
}
}else
{
//
if,(action.equals(ServerAction.needProof))
{
DdzRCLogic.getInstance().doorNeedProof(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.proofOK))
{
DdzRCLogic.getInstance().doorProofOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.proofKO))
{
DdzRCLogic.getInstance().doorProofKO(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.loadDBTypeOK))
{
DdzRCLogic.getInstance().doorLoadDBTypeOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.logOK))
{
DdzRCLogic.getInstance().doorLogOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.logKO))
{
DdzRCLogic.getInstance().doorLogKO(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.hasRegOK))
{
DdzRCLogic.getInstance().doorHasRegOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.hasRegKO))
{
DdzRCLogic.getInstance().doorHasRegKO(c,,doc,,item),;
continue,;
},,,,,,,,,,,,,,,,,,,,,,,,
if,(action.equals(ServerAction.regOK))
{
DdzRCLogic.getInstance().doorRegOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.regKO))
{
DdzRCLogic.getInstance().doorRegKO(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.loadGOK))
{
DdzRCLogic.getInstance().doorLoadGOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.chkEveryDayLoginAndGetOK))
{
DdzRCLogic.getInstance().doorChkEveryDayLoginAndGetOK(c,,doc,,item),;
continue,;
}
if,(action.equals(ServerAction.loadTopListOK))
{
DdzRCLogic.getInstance().doorLoadTopListOK(c,,doc,,item),;
continue,;
}
}
//
Log.WriteStr(SR.GetString(SR.getInvalid_protocol_num(),,action)),;
}//end,for
//
DdzLogic.getInstance().TimedAutoMatchRoom(),;
DdzLogic.getInstance().TimedWaitReconnection(),;
DdzLogic.getInstance().TimedChkHeartBeat(),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver,;
import,System.Xml.XmlDocument,;
import,System.Xml.XmlNode,;
import,java.io.UnsupportedEncodingException,;
import,java.util.logging.Level,;
import,java.util.logging.Logger,;
import,net.silverfoxserver.core.log.Log,;
import,net.silverfoxserver.core.model.IUserModel,;
import,net.silverfoxserver.core.protocol.RCClientAction,;
import,net.silverfoxserver.core.protocol.ServerAction,;
import,net.silverfoxserver.core.server.GameLogicServer,;
import,net.silverfoxserver.core.server.RecordLogicClientServer,;
import,net.silverfoxserver.core.socket.AppSession,;
import,net.silverfoxserver.core.socket.SessionMessage,;
import,net.silverfoxserver.core.socket.XmlInstruction,;
import,net.silverfoxserver.core.util.SR,;
import,net.silverfoxserver.extfactory.UserModelFactory,;
import,org.jdom2.JDOMException,;
/**
*
*,@author,FUX
*/
public,class,DdzRCLogic,extends,RecordLogicClientServer,{
/**
*,
*,@return,
*/
@Override
public,String,CLASS_NAME()
{,,,,,,,,,,,,
return,DdzRCLogic.class.getName(),;,,,,,,,,,,,,,,,,,
}
/**
*,??
*,
*/
private,static,DdzRCLogic,_instance,=,null,;
public,static,DdzRCLogic,getInstance()
{
if(null,==,_instance)
{
_instance,=,new,DdzRCLogic(),;
}
return,_instance,;
}
public,void,init(GameLogicServer,value)
{
super.setGameLogicServer(value),;
}
//C#,TO,JAVA,CONVERTER,TODO,TASK:,There,is,no,preprocessor,in,Java:
///#endregion
//C#,TO,JAVA,CONVERTER,TODO,TASK:,There,is,no,preprocessor,in,Java:
///#region,???????????
@Override
public,void,doorLogOK(AppSession,session,,XmlDocument,doc,,SessionMessage,item)
{
try
{
XmlNode,node,=,doc.SelectSingleNode("/msg/body"),;
String,userStrIpPort,=,node.ChildNodes()[0].getText(),;
String,usersex,,,,,=,node.ChildNodes()[1].getText(),;
String,username,=,node.ChildNodes()[2].getText(),;
String,userpwd,=,node.ChildNodes()[3].getText(),;
String,useremail,,,=,node.ChildNodes()[4].getText(),;
String,bbs,=,node.ChildNodes()[5].getText(),;
String,hico,=,node.ChildNodes()[6].getText(),;
String,sid,=,node.ChildNodes()[7].getText(),;
int,id_sql,=,Integer.valueOf(node.ChildNodes()[8].getText()),;
String,id,=,node.ChildNodes()[9].getText(),;
String,status,=,node.ChildNodes()[10].getText(),;
//
String,saction,=,ServerAction.logOK,;
StringBuilder,contentXml,=,new,StringBuilder(),;
//??
//?????session????usersession,????????
AppSession,userSession,=,DdzLogic.getInstance().CLIENTAcceptor.getSession(userStrIpPort),;
//??????,????????,????????????????,?????
AppSession,outSession,=,DdzLogic.getInstance().CLIENTAcceptor.getSessionByAccountName(username),;
if,(null,!=,outSession)
{
//?????,??????????,??:??????????
//????ClearSession
String,logoutAction,=,ServerAction.logout,;
String,logoutCode,=,"1",;
StringBuilder,logoutXml,=,new,StringBuilder(),;
logoutXml.append("<session>").append(userSession.getRemoteEndPoint().toString()).append("</session>"),;
logoutXml.append("<session>").append(outSession.getRemoteEndPoint().toString()).append("</session>"),;
logoutXml.append("<code>").append(logoutCode).append("</code>"),;
logoutXml.append("<u></u>"),;
DdzLogic.getInstance().Send(outSession,,XmlInstruction.fengBao(logoutAction,,logoutXml.toString())),;
//
Log.WriteStrBySend(logoutAction,,outSession.getRemoteEndPoint().toString()),;
//
DdzLogic.getInstance().CLIENTAcceptor.trigClearSession(outSession,,outSession.getRemoteEndPoint().toString()),;
}
//??????????
if,(null,!=,userSession)
{
//??????
if,(DdzLogic.getInstance().CLIENTAcceptor.getUserCount(),>=,DdzLogic.getInstance().CLIENTAcceptor.getMaxOnlineUserConfig())
{
//??saction
saction,=,ServerAction.logKO,;
//??status
status,=,"12",;,//??MembershipLoginStatus2.PeopleFull12
contentXml.append("<session>").append(userStrIpPort).append("</session>"),;
contentXml.append("<status>").append(status).append("</status>"),;
contentXml.append("<u></u>"),;
DdzLogic.getInstance().Send(userSession,,XmlInstruction.fengBao(saction,,contentXml.toString())),;
//
Log.WriteStrBySend(saction,,userStrIpPort),;
}
else
{
IUserModel,user,=,UserModelFactory.Create(userStrIpPort,,id,,id_sql,,usersex,,username,,username,,bbs,,hico),;
//????????
//CLIENTAcceptor.addUser(userSession.getRemoteEndPoint().ToString(),,user),;
DdzLogic.getInstance().CLIENTAcceptor.addUser(userStrIpPort,,user),;
contentXml.append("<session>").append(userStrIpPort).append("</session>"),;
contentXml.append("<status>").append(status).append("</status>"),;
contentXml.append(user.toXMLString()),;
DdzLogic.getInstance().Send(userSession,,XmlInstruction.fengBao(saction,,contentXml.toString())),;
//
Log.WriteStrBySend(saction,,userStrIpPort),;
//
Log.WriteFileByLoginSuccess(username,,userStrIpPort),;
Log.WriteFileByOnlineUserCount(DdzLogic.getInstance().CLIENTAcceptor.getUserCount()),;
},//end,if
},//end,if
}
catch,(JDOMException,|,UnsupportedEncodingException,,|,RuntimeException,exd)
{
Log.WriteStrByException(CLASS_NAME(),,"doorLogOK",,exd.getMessage(),exd.getStackTrace()),;
}
},,,,
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver,;
/**
*,????
*,@author,FUX
*/
public,class,LogoutCode,{
//,??:
//,,,,,?????*????????
public,static,final,int,Success0,=,0,;
//
//,??:
//,,,,,??????????,??:???????????
public,static,final,int,OtherUseSameNameLogin1,=,1,;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver,;
/**
*,?1,
*,@author,FUX
*/
public,class,MembershipLoginStatus2,{
//,??:
//,,,,,??????,???
public,static,final,int,PeopleFull12,=,12,;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver,;
/**
*
*,@author,FUX
*/
import,java.io.UnsupportedEncodingException,;
import,java.time.LocalTime,;
import,java.util.Timer,;
import,java.util.logging.Level,;
import,java.util.logging.Logger,;
import,net.silverfoxserver.core.log.Log,;
public,class,MsgTimedTask,extends,java.util.TimerTask{
@Override
public,void,run(),{
try,{
//,TODO,Auto-generated,method,stub
DdzLPU.getInstance().msgTimedEvent(),;
},catch,(UnsupportedEncodingException,ex),{
Log.WriteStrByException(MsgTimedTask.class.getName(),,"run",,ex.getMessage()),;
}
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extfactory,;
import,net.silverfoxserver.core.model.IChairModel,;
import,net.silverfoxserver.core.model.IRuleModel,;
import,net.silverfoxserver.extmodel.ChairModelByDdz,;
/**
*
*,@author,ACER-FX
*/
public,class,ChairModelFactory,{
public,static,IChairModel,Create(int,id,,IRuleModel,rule)
{
return,new,ChairModelByDdz(id,,rule),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extfactory,;
import,java.io.IOException,;
import,net.silverfoxserver.core.model.IRoomModel,;
import,net.silverfoxserver.core.model.IRuleModel,;
import,net.silverfoxserver.extmodel.RoomModelByDdz,;
import,org.jdom2.JDOMException,;
/**
*
*,@author,ACER-FX
*/
public,class,RoomModelFactory,{
public,static,IRoomModel,Create(int,roomId,,int,tab,,IRuleModel,rule),throws,JDOMException,,IOException
{
return,new,RoomModelByDdz(roomId,,rule,,tab,,""),;
}
public,static,IRoomModel,Create(int,roomId,,int,tab,,String,gridXml,,IRuleModel,rule),throws,JDOMException,,IOException
{
return,new,RoomModelByDdz(roomId,,rule,,tab,,gridXml),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extfactory,;
import,net.silverfoxserver.core.model.IRuleModel,;
import,net.silverfoxserver.extmodel.RuleModelByDdz,;
/**
*
*,@author,ACER-FX
*/
public,class,RuleModelFactory,{
public,static,IRuleModel,Create()
{
return,new,RuleModelByDdz(),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extfactory,;
import,net.silverfoxserver.core.model.ITabModel,;
import,net.silverfoxserver.extmodel.TabModelByDdz,;
/**
*
*,@author,ACER-FX
*/
public,class,TabModelFactory,{
public,static,ITabModel,Create(int,tab)
{
return,new,TabModelByDdz(tab),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extfactory,;
import,net.silverfoxserver.core.model.IUserModel,;
import,net.silverfoxserver.extmodel.UserModelByDdz,;
/**
*
*,@author,ACER-FX
*/
public,class,UserModelFactory,{
public,static,IUserModel,Create(String,strIpPort,,String,id,,int,id_sql,,String,sex,,String,accountName,,String,nickName,,String,bbs,,String,headIco)
{
return,new,UserModelByDdz(strIpPort,,id,,id_sql,,sex,,accountName,,nickName,,bbs,,headIco),;
}
public,static,IUserModel,Create()
{
return,new,UserModelByDdz(),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extlogic,;
/**
*,F,-,??(?)
M,-,??(?)
X,-,??(?)
T,-,??(?)
*,
*,@author,ACER-FX
*/
public,class,PokerName,{
/**,
????
*/
public,static,final,String,BG_NORMAL,=,"bg_normal",;
/**,
????,?
????
*/
public,static,final,String,BG_DIZHU,=,"bg_dizhu",;
public,static,final,String,BG_NONGMING,=,"bg_nongming",;
public,static,final,String,F_3,=,"f_3",;
public,static,final,String,F_4,=,"f_4",;
public,static,final,String,F_5,=,"f_5",;
public,static,final,String,F_6,=,"f_6",;
public,static,final,String,F_7,=,"f_7",;
public,static,final,String,F_8,=,"f_8",;
public,static,final,String,F_9,=,"f_9",;
public,static,final,String,F_10,=,"f_10",;
public,static,final,String,F_J,=,"f_J",;
public,static,final,String,F_Q,=,"f_Q",;
public,static,final,String,F_K,=,"f_K",;
public,static,final,String,F_A,=,"f_A",;
public,static,final,String,F_2,=,"f_2",;
public,static,final,String,M_3,=,"m_3",;
public,static,final,String,M_4,=,"m_4",;
public,static,final,String,M_5,=,"m_5",;
public,static,final,String,M_6,=,"m_6",;
public,static,final,String,M_7,=,"m_7",;
public,static,final,String,M_8,=,"m_8",;
public,static,final,String,M_9,=,"m_9",;
public,static,final,String,M_10,=,"m_10",;
public,static,final,String,M_J,=,"m_J",;
public,static,final,String,M_Q,=,"m_Q",;
public,static,final,String,M_K,=,"m_K",;
public,static,final,String,M_A,=,"m_A",;
public,static,final,String,M_2,=,"m_2",;
public,static,final,String,X_3,=,"x_3",;
public,static,final,String,X_4,=,"x_4",;
public,static,final,String,X_5,=,"x_5",;
public,static,final,String,X_6,=,"x_6",;
public,static,final,String,X_7,=,"x_7",;
public,static,final,String,X_8,=,"x_8",;
public,static,final,String,X_9,=,"x_9",;
public,static,final,String,X_10,=,"x_10",;
public,static,final,String,X_J,=,"x_J",;
public,static,final,String,X_Q,=,"x_Q",;
public,static,final,String,X_K,=,"x_K",;
public,static,final,String,X_A,=,"x_A",;
public,static,final,String,X_2,=,"x_2",;
public,static,final,String,T_3,=,"t_3",;
public,static,final,String,T_4,=,"t_4",;
public,static,final,String,T_5,=,"t_5",;
public,static,final,String,T_6,=,"t_6",;
public,static,final,String,T_7,=,"t_7",;
public,static,final,String,T_8,=,"t_8",;
public,static,final,String,T_9,=,"t_9",;
public,static,final,String,T_10,=,"t_10",;
public,static,final,String,T_J,=,"t_J",;
public,static,final,String,T_Q,=,"t_Q",;
public,static,final,String,T_K,=,"t_K",;
public,static,final,String,T_A,=,"t_A",;
public,static,final,String,T_2,=,"t_2",;
/**,
??,?
??
*/
public,static,final,String,JOKER_XIAO,=,"Joker_xiao",;
public,static,final,String,JOKER_DA,=,"Joker_da",;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,AutoMatchRoomModel,{
private,String,_strIpPort,;
private,int,_tab,;
public,final,int,getTab()
{
return,_tab,;
}
private,int,_roomOldId,;
public,AutoMatchRoomModel(String,strIpPort,,int,roomTab,,int,roomOldId)
{
this._strIpPort,=,strIpPort,;
this._tab,=,roomTab,;
this._roomOldId,=,roomOldId,;
}
public,final,String,getStrIpPort()
{
return,_strIpPort,;
}
public,final,int,getRoomOldId()
{
return,_roomOldId,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.core.log.Log,;
import,net.silverfoxserver.core.model.IChairModel,;
import,net.silverfoxserver.core.model.IRuleModel,;
import,net.silverfoxserver.core.model.IUserModel,;
import,net.silverfoxserver.extfactory.UserModelFactory,;
/**
*
*,@author,ACER-FX
*/
public,class,ChairModelByDdz,implements,IChairModel{
/**
*,????
*,
*,id????????????
*/
private,int,_id,;
public,final,int,getId()
{
return,_id,;
}
/**,
????
*/
private,IUserModel,_user,;
public,final,IUserModel,getUser()
{
return,this._user,;
}
/**,
????
*/
private,volatile,boolean,_ready,;
/**,
ready????
*/
private,volatile,String,_readyAdd,;
public,ChairModelByDdz(int,id,,IRuleModel,rule)
{
this._id,=,id,;
this._user,=,UserModelFactory.Create(),;
this._ready,=,false,;
this._readyAdd,=,"",;
}
/**,
???????setProperty??,???????
????
@param,user
*/
public,final,void,setUser(IUserModel,value)
{
this._user,=,value.clone(),;
}
public,final,boolean,isReady()
{
return,this._ready,;
}
@Override
public,final,void,setReady(boolean,value)
{
this._ready,=,value,;
if,(value)
{
if,(this._user.getId().equals(""))
{
Log.WriteStr("setReady,must,this,chair,has,people"),;
}
}
}
@Override
public,final,void,setReadyAdd(String,value)
{
this._readyAdd,=,value,;
if,(!value.equals(""))
{
if,(this._user.getId().equals(""))
{
throw,new,IllegalArgumentException("setReadyAdd,must,this,chair,has,people"),;
}
}
}
/**,
?????????
@return,
*/
public,final,String,getReadyAdd()
{
return,this._readyAdd,;
}
/**,
??
*/
public,final,void,reset()
{
//
setUser(new,UserModelByDdz()),;
//
this._ready,=,false,;
this._readyAdd,=,"",;
}
/**,
??????xml
@return,
*/
public,final,String,toXMLString()
{
StringBuilder,sb,=,new,StringBuilder(),;
//
sb.append("<chair,id='"),;
sb.append((new,Integer(this.getId())).toString()),;
sb.append("',ready='"),;
sb.append(convertBoolToAS3(this.isReady())),;
sb.append("'>"),;
sb.append(this.getUser().toXMLString()),;
sb.append("</chair>"),;
return,sb.toString(),;
}
/**,
AS3,0-?,1-?
@param,value
@return,
*/
public,final,String,convertBoolToAS3(boolean,value)
{
if,(value)
{
return,"1",;
}
return,"0",;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,MatchResultByDdz,{
//public,readonly,String,RED_WIN,=,"red_win",;
//public,readonly,String,BLACK_WIN,=,"black_win",;
public,final,String,DIZHU_WIN,=,"dizhu_win",;
public,final,String,NONGMING_WIN,=,"nongming_win",;
/**,
??,
????????,????????
??????
*/
public,final,String,HE,=,"he",;
/**,
??????
*/
public,final,String,EMPTY,=,"",;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.core.util.RandomUtil,;
/**
*
*,@author,ACER-FX
*/
public,class,PaiBoardByDdz,{
/**,
?????????,????
*/
private,PaiName,PAI_NAME,=,new,PaiName(),;
/**,
??
*/
public,volatile,String[][],grid,;
/**,
??
*/
public,volatile,String[],grid2,;
public,PaiBoardByDdz()
{
//
reset(),;
}
/**,
????
*/
private,void,reset()
{
grid,=,new,String[][]{{"","","","","","","","","","","","","","","","","","","",""},,{"","","","","","","","","","","","","","","","","","","",""},,{"","","","","","","","","","","","","","","","","","","",""}},;
grid2,=,new,String[],{"",,"",,""},;
}
/**,
??????reset
*/
public,final,void,xipai()
{
//
reset(),;
//
int,i,=,0,;
int,len,=,0,;
int,n,=,0,;
//clone,pai,name
java.util.ArrayList<String>,p,=,PAI_NAME.GetList(),;
//????17??
len,=,17,;
//?????????????????:,
//Millisecond,?????,0,-,999
//DateTime.Now.Ticks???1970?1?1?(???????,???1970)????????????——????
//54??????,54!
//????????,???:,2.3e,+,71
//?????seed???????????,???0??????,
//Millisecond??,??????999?????
//guid?????,???????
//???Random????????????????,
//?????????????????????,
//?shuffle??????????
//.net???RNGCryptoServiceProvider????????
//GetRandSeed???????,0,-,int32.MaxValue,??????,??999????
java.util.Random,r,=,new,java.util.Random(RandomUtil.GetRandSeed()),;
for,(i,=,0,;,i,<,len,;,i++)
{
n,=,r.nextInt(p.size()),;
grid[0][i],=,p.get(n),;
p.remove(n),;
}
//test
/*
grid[0,,0],=,PokerName.X_J,;,p.Remove(PokerName.X_J),;
grid[0,,1],=,PokerName.F_A,;,p.Remove(PokerName.F_A),;
grid[0,,2],=,PokerName.X_A,;,p.Remove(PokerName.X_A),;
grid[0,,3],=,PokerName.T_A,;,p.Remove(PokerName.T_A),;
grid[0,,4],=,PokerName.T_K,;,p.Remove(PokerName.T_K),;
grid[0,,5],=,PokerName.F_K,;,p.Remove(PokerName.F_K),;
grid[0,,6],=,PokerName.M_K,;,p.Remove(PokerName.M_K),;
grid[0,,7],=,PokerName.T_8,;,p.Remove(PokerName.T_8),;
grid[0,,8],=,PokerName.X_8,;,p.Remove(PokerName.X_8),;
grid[0,,9],=,PokerName.X_3,;,p.Remove(PokerName.X_3),;
grid[0,,10],=,PokerName.T_3,;,p.Remove(PokerName.T_3),;
grid[0,,11],=,PokerName.X_2,;,p.Remove(PokerName.X_2),;
grid[0,,12],=,PokerName.X_4,;,p.Remove(PokerName.X_4),;
grid[0,,13],=,PokerName.X_5,;,p.Remove(PokerName.X_5),;
grid[0,,14],=,PokerName.X_6,;,p.Remove(PokerName.X_6),;
grid[0,,15],=,PokerName.X_10,;,p.Remove(PokerName.X_10),;
grid[0,,16],=,PokerName.T_10,;,p.Remove(PokerName.T_10),;
*/
for,(i,=,0,;,i,<,len,;,i++)
{
n,=,r.nextInt(p.size()),;
grid[1][i],=,p.get(n),;
p.remove(n),;
}
//test
/*
grid[1,,0],=,PokerName.M_J,;,p.Remove(PokerName.M_J),;
grid[1,,1],=,PokerName.F_4,;,p.Remove(PokerName.F_4),;
grid[1,,2],=,PokerName.X_4,;,p.Remove(PokerName.X_4),;
grid[1,,3],=,PokerName.T_4,;,p.Remove(PokerName.T_4),;
grid[1,,4],=,PokerName.T_5,;,p.Remove(PokerName.T_5),;
grid[1,,5],=,PokerName.F_5,;,p.Remove(PokerName.F_5),;
grid[1,,6],=,PokerName.M_5,;,p.Remove(PokerName.M_5),;
grid[1,,7],=,PokerName.T_Q,;,p.Remove(PokerName.T_Q),;
grid[1,,8],=,PokerName.X_Q,;,p.Remove(PokerName.X_Q),;
grid[1,,9],=,PokerName.X_K,;,p.Remove(PokerName.X_K),;
grid[1,,10],=,PokerName.M_K,;,p.Remove(PokerName.M_K),;
grid[1,,11],=,PokerName.M_2,;,p.Remove(PokerName.M_2),;
grid[1,,12],=,PokerName.M_4,;,p.Remove(PokerName.M_4),;
grid[1,,13],=,PokerName.X_5,;,p.Remove(PokerName.X_5),;
grid[1,,14],=,PokerName.X_6,;,p.Remove(PokerName.X_6),;
grid[1,,15],=,PokerName.X_J,;,p.Remove(PokerName.X_J),;
grid[1,,16],=,PokerName.T_10,;,p.Remove(PokerName.T_10),;
*/
for,(i,=,0,;,i,<,len,;,i++)
{
n,=,r.nextInt(p.size()),;
grid[2][i],=,p.get(n),;
p.remove(n),;
},//end,for
//??
grid2[0],=,p.get(0),;
grid2[1],=,p.get(1),;
grid2[2],=,p.get(2),;
//distory
p.clear(),;
}
public,final,int,getBombCountByGrid(int,h)
{
int,count,=,0,;
if,(0,!=,h,&&,1,!=,h,&&,2,!=,h)
{
throw,new,IllegalArgumentException("h,out,grid,index"),;
}
java.util.ArrayList<Integer>,pcArr,=,new,java.util.ArrayList<Integer>(),;
for,(int,i,=,0,;,i,<,3,;,i++),//3?
{
if,(i,==,h)
{
for,(int,j,=,0,;,j,<,20,;,j++),//20?
{
if,("",!=,grid[i][j])
{
pcArr.add(PaiCode.convertToCode(grid[i][j])),;
}
}
},//end,if
}
//
PaiCode.sort(pcArr),;,//sort????
java.util.ArrayList<PaiUnit>,pickArr,=,PaiRuleTip.pick(pcArr),;
for,(int,j,=,0,;,j,<,pickArr.size(),;,j++)
{
if,(pickArr.get(j).Rule().equals("bomb"))
{
count++,;
}
if,(pickArr.get(j).Rule().equals("huojian"))
{
count++,;
}
}
return,count,;
}
public,final,java.util.ArrayList<String>,getPaiByGrid(int,h)
{
if,(0,!=,h,&&,1,!=,h,&&,2,!=,h)
{
throw,new,IllegalArgumentException("h,out,grid,index"),;
}
//
java.util.ArrayList<String>,paiList,=,new,java.util.ArrayList<String>(),;
//
for,(int,i,=,0,;,i,<,3,;,i++),//3?
{
if,(i,==,h)
{
for,(int,j,=,0,;,j,<,20,;,j++),//20?
{
if,("",!=,grid[i][j])
{
//count++,;
paiList.add(grid[i][j]),;
}
}
},//end,if
}
return,paiList,;
}
/**,
??grid,???????
@param,h
@return,
*/
public,final,int,getPaiCountByGrid(int,h)
{
int,count,=,0,;
if,(0,!=,h,&&,1,!=,h,&&,2,!=,h)
{
throw,new,IllegalArgumentException("h,out,grid,index"),;
}
for,(int,i,=,0,;,i,<,3,;,i++),//3?
{
if,(i,==,h)
{
for,(int,j,=,0,;,j,<,20,;,j++),//20?
{
if,("",!=,grid[i][j])
{
count++,;
}
}
},//end,if
}
return,count,;
}
/**,
?grid2??????grid
@param,h
*/
//C#,TO,JAVA,CONVERTER,WARNING:,Unsigned,integer,types,have,no,direct,equivalent,in,Java:
//ORIGINAL,LINE:,public,void,addDiPaiToGrid(uint,h)
public,final,void,addDiPaiToGrid(int,h)
{
grid[h][17],=,grid2[0],;
grid[h][18],=,grid2[1],;
grid[h][19],=,grid2[2],;
}
/**,
??????,update??????
???????????
??Room??xml??????
@param,itemName
*/
public,final,void,update(String,itemName,,String,action)
{
if,(action.equals("del"))
{
for,(int,i,=,0,;,i,<,3,;,i++),//3?
{
for,(int,j,=,0,;,j,<,20,;,j++),//20?
{
if,(itemName.equals(grid[i][j]))
{
grid[i][j],=,"",;
return,;
}
}
}
throw,new,IllegalArgumentException("del,pai,can,not,find:",+,itemName),;
}
else
{
throw,new,IllegalArgumentException("action,can,not,find:",+,action),;
}
}
public,final,String,toXMLString()
{
StringBuilder,sb,=,new,StringBuilder(),;
int,i,=,0,;
int,j,=,0,;
//chessboard???item??
for,(i,=,0,;,i,<,3,;,i++),//3?
{
for,(j,=,0,;,j,<,20,;,j++),//20?
{
if,("",!=,grid[i][j])
{
//qizi???item
sb.append("<item,n='"),;
sb.append(grid[i][j]),;
sb.append("',h='"),;
sb.append((new,Integer(i)).toString()),;
sb.append("',v='"),;
sb.append((new,Integer(j)).toString()),;
sb.append("'/>"),;
}
}
},//end,for
//??
//??,grid2??????
for,(j,=,0,;,j,<,3,;,j++)
{
if,(!grid2[j].equals(""))
{
//qizi???item
sb.append("<item,n='"),;
sb.append(grid2[j]),;
sb.append("',h='"),;
sb.append("3',v='"),;,//??h??012,???3
sb.append((new,Integer(j)).toString()),;
sb.append("'/>"),;
}
}
return,sb.toString(),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.extlogic.PokerName,;
/**
*,
*,Pai????????????,???PaiRule???
*,
*,@author,ACER-FX
*/
public,class,PaiCode,{
/**
*,???????
*/
public,static,final,int,BG_NORMAL,=,-3,;
public,static,final,int,BG_NONGMING,=,-2,;
public,static,final,int,BG_DIZHU,=,-1,;
public,static,final,int,F_3,=,0,;
public,static,final,int,M_3,=,1,;
public,static,final,int,X_3,=,2,;
public,static,final,int,T_3,=,3,;
public,static,final,int,F_4,=,4,;
public,static,final,int,M_4,=,5,;
public,static,final,int,X_4,=,6,;
public,static,final,int,T_4,=,7,;
public,static,final,int,F_5,=,8,;
public,static,final,int,M_5,=,9,;
public,static,final,int,X_5,=,10,;
public,static,final,int,T_5,=,11,;
public,static,final,int,F_6,=,12,;
public,static,final,int,M_6,=,13,;
public,static,final,int,X_6,=,14,;
public,static,final,int,T_6,=,15,;
public,static,final,int,F_7,=,16,;
public,static,final,int,M_7,=,17,;
public,static,final,int,X_7,=,18,;
public,static,final,int,T_7,=,19,;
public,static,final,int,F_8,=,20,;
public,static,final,int,M_8,=,21,;
public,static,final,int,X_8,=,22,;
public,static,final,int,T_8,=,23,;
public,static,final,int,F_9,=,24,;
public,static,final,int,M_9,=,25,;
public,static,final,int,X_9,=,26,;
public,static,final,int,T_9,=,27,;
public,static,final,int,F_10,=,28,;
public,static,final,int,M_10,=,29,;
public,static,final,int,X_10,=,30,;
public,static,final,int,T_10,=,31,;
public,static,final,int,F_J,=,32,;
public,static,final,int,M_J,=,33,;
public,static,final,int,X_J,=,34,;
public,static,final,int,T_J,=,35,;
public,static,final,int,F_Q,=,36,;
public,static,final,int,M_Q,=,37,;
public,static,final,int,X_Q,=,38,;
public,static,final,int,T_Q,=,39,;
public,static,final,int,F_K,=,40,;
public,static,final,int,M_K,=,41,;
public,static,final,int,X_K,=,42,;
public,static,final,int,T_K,=,43,;
public,static,final,int,F_A,=,44,;
public,static,final,int,M_A,=,45,;
public,static,final,int,X_A,=,46,;
public,static,final,int,T_A,=,47,;
public,static,final,int,F_2,=,56,;
public,static,final,int,M_2,=,57,;
public,static,final,int,X_2,=,58,;
public,static,final,int,T_2,=,59,;
public,static,final,int,JOKER_XIAO,=,60,;
public,static,final,int,JOKER_DA,=,64,;
/**
*,arrTmp???,?????????
*,??????void
*/
public,static,void,sort(java.util.ArrayList<Integer>,codeArr)
{
int,len,=,codeArr.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
for,(int,j,=,i,+,1,;,j,<,len,;,j++)
{
if,(codeArr.get(i),>,codeArr.get(j)),//,>,???
{
//a=a+b,;,
//b=a-b,;,,
//a=a-b,;,
codeArr.set(i,,codeArr.get(i),+,codeArr.get(j)),;
codeArr.set(j,,codeArr.get(i),-,codeArr.get(j)),;
codeArr.set(i,,codeArr.get(i),-,codeArr.get(j)),;
}
}
}
}
/**
*,????????
*,PaiCode?????????,???PaiRule???
*/
public,static,boolean,ai(int,pai1,,int,pai2)
{
if,(Math.abs(guiWei(pai1),-,guiWei(pai2)),!=,4)
{
return,false,;
}
return,true,;
}
/**
*,????????
*/
public,static,boolean,same(int,pai1,,int,pai2)
{
//?????
if,(Math.abs(guiWei(pai1),-,guiWei(pai2)),>=,4)
{
return,false,;
}
return,true,;
}
/**
*,??
*/
public,static,int,guiWei(int,code)
{
//if(,(code,&,3),==,0)//(code,%,4),==,0)
if,((code,&,3),==,0)
{
return,code,;
}
return,code,-,(code,&,3),;,//,,,,,,code,&,3),;,,,,//%,4
}
public,static,int,convertToCode(String,paiName)
{
int,code,;
//C#,TO,JAVA,CONVERTER,NOTE:,The,following,'switch',operated,on,a,string,member,and,was,converted,to,Java,'if-else',logic:
//		,switch(paiName)
//ORIGINAL,LINE:,case,PokerName.BG_NORMAL:
if,(PokerName.BG_NORMAL.equals(paiName))
{
code,=,BG_NORMAL,;
}
//ORIGINAL,LINE:,case,PokerName.BG_NONGMING:
else,if,(PokerName.BG_NONGMING.equals(paiName))
{
code,=,BG_NONGMING,;
}
//ORIGINAL,LINE:,case,PokerName.BG_DIZHU:
else,if,(PokerName.BG_DIZHU.equals(paiName))
{
code,=,BG_DIZHU,;
}
//ORIGINAL,LINE:,case,PokerName.F_3:
else,if,(PokerName.F_3.equals(paiName))
{
code,=,F_3,;
}
//ORIGINAL,LINE:,case,PokerName.M_3:
else,if,(PokerName.M_3.equals(paiName))
{
code,=,M_3,;
}
//ORIGINAL,LINE:,case,PokerName.X_3:
else,if,(PokerName.X_3.equals(paiName))
{
code,=,X_3,;
}
//ORIGINAL,LINE:,case,PokerName.T_3:
else,if,(PokerName.T_3.equals(paiName))
{
code,=,T_3,;
}
//ORIGINAL,LINE:,case,PokerName.F_4:
else,if,(PokerName.F_4.equals(paiName))
{
code,=,F_4,;
}
//ORIGINAL,LINE:,case,PokerName.M_4:
else,if,(PokerName.M_4.equals(paiName))
{
code,=,M_4,;
}
//ORIGINAL,LINE:,case,PokerName.X_4:
else,if,(PokerName.X_4.equals(paiName))
{
code,=,X_4,;
}
//ORIGINAL,LINE:,case,PokerName.T_4:
else,if,(PokerName.T_4.equals(paiName))
{
code,=,T_4,;
}
//ORIGINAL,LINE:,case,PokerName.F_5:
else,if,(PokerName.F_5.equals(paiName))
{
code,=,F_5,;
}
//ORIGINAL,LINE:,case,PokerName.M_5:
else,if,(PokerName.M_5.equals(paiName))
{
code,=,M_5,;
}
//ORIGINAL,LINE:,case,PokerName.X_5:
else,if,(PokerName.X_5.equals(paiName))
{
code,=,X_5,;
}
//ORIGINAL,LINE:,case,PokerName.T_5:
else,if,(PokerName.T_5.equals(paiName))
{
code,=,T_5,;
}
//ORIGINAL,LINE:,case,PokerName.F_6:
else,if,(PokerName.F_6.equals(paiName))
{
code,=,F_6,;
}
//ORIGINAL,LINE:,case,PokerName.M_6:
else,if,(PokerName.M_6.equals(paiName))
{
code,=,M_6,;
}
//ORIGINAL,LINE:,case,PokerName.X_6:
else,if,(PokerName.X_6.equals(paiName))
{
code,=,X_6,;
}
//ORIGINAL,LINE:,case,PokerName.T_6:
else,if,(PokerName.T_6.equals(paiName))
{
code,=,T_6,;
}
//ORIGINAL,LINE:,case,PokerName.F_7:
else,if,(PokerName.F_7.equals(paiName))
{
code,=,F_7,;
}
//ORIGINAL,LINE:,case,PokerName.M_7:
else,if,(PokerName.M_7.equals(paiName))
{
code,=,M_7,;
}
//ORIGINAL,LINE:,case,PokerName.X_7:
else,if,(PokerName.X_7.equals(paiName))
{
code,=,X_7,;
}
//ORIGINAL,LINE:,case,PokerName.T_7:
else,if,(PokerName.T_7.equals(paiName))
{
code,=,T_7,;
}
//ORIGINAL,LINE:,case,PokerName.F_8:
else,if,(PokerName.F_8.equals(paiName))
{
code,=,F_8,;
}
//ORIGINAL,LINE:,case,PokerName.M_8:
else,if,(PokerName.M_8.equals(paiName))
{
code,=,M_8,;
}
//ORIGINAL,LINE:,case,PokerName.X_8:
else,if,(PokerName.X_8.equals(paiName))
{
code,=,X_8,;
}
//ORIGINAL,LINE:,case,PokerName.T_8:
else,if,(PokerName.T_8.equals(paiName))
{
code,=,T_8,;
}
//ORIGINAL,LINE:,case,PokerName.F_9:
else,if,(PokerName.F_9.equals(paiName))
{
code,=,F_9,;
}
//ORIGINAL,LINE:,case,PokerName.M_9:
else,if,(PokerName.M_9.equals(paiName))
{
code,=,M_9,;
}
//ORIGINAL,LINE:,case,PokerName.X_9:
else,if,(PokerName.X_9.equals(paiName))
{
code,=,X_9,;
}
//ORIGINAL,LINE:,case,PokerName.T_9:
else,if,(PokerName.T_9.equals(paiName))
{
code,=,T_9,;
}
//ORIGINAL,LINE:,case,PokerName.F_10:
else,if,(PokerName.F_10.equals(paiName))
{
code,=,F_10,;
}
//ORIGINAL,LINE:,case,PokerName.M_10:
else,if,(PokerName.M_10.equals(paiName))
{
code,=,M_10,;
}
//ORIGINAL,LINE:,case,PokerName.X_10:
else,if,(PokerName.X_10.equals(paiName))
{
code,=,X_10,;
}
//ORIGINAL,LINE:,case,PokerName.T_10:
else,if,(PokerName.T_10.equals(paiName))
{
code,=,T_10,;
}
//ORIGINAL,LINE:,case,PokerName.F_J:
else,if,(PokerName.F_J.equals(paiName))
{
code,=,F_J,;
}
//ORIGINAL,LINE:,case,PokerName.M_J:
else,if,(PokerName.M_J.equals(paiName))
{
code,=,M_J,;
}
//ORIGINAL,LINE:,case,PokerName.X_J:
else,if,(PokerName.X_J.equals(paiName))
{
code,=,X_J,;
}
//ORIGINAL,LINE:,case,PokerName.T_J:
else,if,(PokerName.T_J.equals(paiName))
{
code,=,T_J,;
}
//ORIGINAL,LINE:,case,PokerName.F_Q:
else,if,(PokerName.F_Q.equals(paiName))
{
code,=,F_Q,;
}
//ORIGINAL,LINE:,case,PokerName.M_Q:
else,if,(PokerName.M_Q.equals(paiName))
{
code,=,M_Q,;
}
//ORIGINAL,LINE:,case,PokerName.X_Q:
else,if,(PokerName.X_Q.equals(paiName))
{
code,=,X_Q,;
}
//ORIGINAL,LINE:,case,PokerName.T_Q:
else,if,(PokerName.T_Q.equals(paiName))
{
code,=,T_Q,;
}
//ORIGINAL,LINE:,case,PokerName.F_K:
else,if,(PokerName.F_K.equals(paiName))
{
code,=,F_K,;
}
//ORIGINAL,LINE:,case,PokerName.M_K:
else,if,(PokerName.M_K.equals(paiName))
{
code,=,M_K,;
}
//ORIGINAL,LINE:,case,PokerName.X_K:
else,if,(PokerName.X_K.equals(paiName))
{
code,=,X_K,;
}
//ORIGINAL,LINE:,case,PokerName.T_K:
else,if,(PokerName.T_K.equals(paiName))
{
code,=,T_K,;
}
//ORIGINAL,LINE:,case,PokerName.F_A:
else,if,(PokerName.F_A.equals(paiName))
{
code,=,F_A,;
}
//ORIGINAL,LINE:,case,PokerName.M_A:
else,if,(PokerName.M_A.equals(paiName))
{
code,=,M_A,;
}
//ORIGINAL,LINE:,case,PokerName.X_A:
else,if,(PokerName.X_A.equals(paiName))
{
code,=,X_A,;
}
//ORIGINAL,LINE:,case,PokerName.T_A:
else,if,(PokerName.T_A.equals(paiName))
{
code,=,T_A,;
}
//ORIGINAL,LINE:,case,PokerName.F_2:
else,if,(PokerName.F_2.equals(paiName))
{
code,=,F_2,;
}
//ORIGINAL,LINE:,case,PokerName.M_2:
else,if,(PokerName.M_2.equals(paiName))
{
code,=,M_2,;
}
//ORIGINAL,LINE:,case,PokerName.X_2:
else,if,(PokerName.X_2.equals(paiName))
{
code,=,X_2,;
}
//ORIGINAL,LINE:,case,PokerName.T_2:
else,if,(PokerName.T_2.equals(paiName))
{
code,=,T_2,;
}
//ORIGINAL,LINE:,case,PokerName.JOKER_XIAO:
else,if,(PokerName.JOKER_XIAO.equals(paiName))
{
code,=,JOKER_XIAO,;
}
//ORIGINAL,LINE:,case,PokerName.JOKER_DA:
else,if,(PokerName.JOKER_DA.equals(paiName))
{
code,=,JOKER_DA,;
}
else
{
throw,new,IllegalArgumentException("can,not,find,pai,name:",+,paiName),;
}
return,code,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.extlogic.PokerName,;
/**
*
*,@author,ACER-FX
*/
public,class,PaiName,{
/**,
pai,code,for,rule
string[]???const?????
*/
private,String[],_list,;
public,PaiName()
{
_list,=,new,String[],{PokerName.F_3,PokerName.M_3,PokerName.X_3,PokerName.T_3,,PokerName.F_4,PokerName.M_4,PokerName.X_4,PokerName.T_4,,PokerName.F_5,PokerName.M_5,PokerName.X_5,PokerName.T_5,,PokerName.F_6,PokerName.M_6,PokerName.X_6,PokerName.T_6,,PokerName.F_7,PokerName.M_7,PokerName.X_7,PokerName.T_7,,PokerName.F_8,PokerName.M_8,PokerName.X_8,PokerName.T_8,,PokerName.F_9,PokerName.M_9,PokerName.X_9,PokerName.T_9,,PokerName.F_10,PokerName.M_10,PokerName.X_10,PokerName.T_10,,PokerName.F_J,PokerName.M_J,PokerName.X_J,PokerName.T_J,,PokerName.F_Q,PokerName.M_Q,PokerName.X_Q,PokerName.T_Q,,PokerName.F_K,PokerName.M_K,PokerName.X_K,PokerName.T_K,,PokerName.F_A,PokerName.M_A,PokerName.X_A,PokerName.T_A,,PokerName.F_2,PokerName.M_2,PokerName.X_2,PokerName.T_2,,PokerName.JOKER_XIAO,PokerName.JOKER_DA},;
}
public,final,java.util.ArrayList<String>,GetList()
{
//
int,len,=,_list.length,;
java.util.ArrayList<String>,_p,=,new,java.util.ArrayList<String>(len),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
_p.add(_list[i]),;
}
return,_p,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,PaiRule,{
public,final,String,MING_PAI,=,"ming_pai",;
/**,
????????
*/
public,final,int,JF_MAXCOUNT,=,9,;
/**,
??????
*/
public,final,int,JF_MAXVALUE,=,3,;
/**,
??????,???
*/
public,final,int,JF_MINVALUE,=,0,;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,PaiRuleCompare,{
public,static,java.util.ArrayList<String>,validate(java.util.ArrayList<Integer>,pcArr)
{
//copy,param
java.util.ArrayList<Integer>,valiArr,=,new,java.util.ArrayList<Integer>(pcArr),;
//loop,use
int,valiArrLen,=,valiArr.size(),;
//??,???1,???2				
java.util.ArrayList<String>,valiPx,=,new,java.util.ArrayList<String>(),;
switch,(valiArrLen)
{
case,2:
valiPx,=,parse_px_2(valiArr),;
break,;,//??,or,??
case,4:
valiPx,=,parse_px_4(valiArr),;
break,;,//???,or,??
},//end,switch
return,valiPx,;
}
/**,
??????????,????
???????,??????
@param,pcArr
@return,
*/
public,static,boolean,validate_bomb(java.util.ArrayList<Integer>,pcArr)
{
//loop,use
int,valiArrLen,=,pcArr.size(),;
PaiCode.sort(pcArr),;,//sort????
if,(4,==,valiArrLen)
{
if,(parse_px_4(pcArr).get(0).equals("bomb"))
{
return,true,;
}
}
return,false,;
}
public,static,boolean,validate_huojian(java.util.ArrayList<Integer>,pcArr)
{
//loop,use
int,valiArrLen,=,pcArr.size(),;
PaiCode.sort(pcArr),;,//sort????
if,(2,==,valiArrLen)
{
if,(parse_px_2(pcArr).get(0).equals("huojian"))
{
return,true,;
}
}
return,false,;
}
//????,2
//2???????
//???????,???????
private,static,java.util.ArrayList<String>,parse_px_2(java.util.ArrayList<Integer>,pcArr)
{
//
java.util.ArrayList<String>,px,=,new,java.util.ArrayList<String>(),;
//??
if,((pcArr.get(0),==,PaiCode.JOKER_XIAO,&&,pcArr.get(1),==,PaiCode.JOKER_DA),||,(pcArr.get(0),==,PaiCode.JOKER_DA,&&,pcArr.get(1),==,PaiCode.JOKER_XIAO))
{
px.add("huojian"),;
px.add((new,Integer(PaiCode.JOKER_XIAO)).toString()),;
px.add((new,Integer(PaiCode.JOKER_DA)).toString()),;
return,px,;
}
//??
if,(PaiCode.same(pcArr.get(0),,pcArr.get(1)))
{
px.add("pair"),;
px.add(pcArr.get(0).toString()),;
return,px,;
}
//
px.add("miss"),;
return,px,;
}
/**,
4???????
???????,???????
?4????,????????,??????????
????????,PaiCode.sort(pcArr),;//sort????
*/
private,static,java.util.ArrayList<String>,parse_px_4(java.util.ArrayList<Integer>,pcArr)
{
java.util.ArrayList<String>,px,=,new,java.util.ArrayList<String>(),;
//??
if,(PaiCode.same(pcArr.get(0),,pcArr.get(1)),&&,PaiCode.same(pcArr.get(1),,pcArr.get(2)),&&,PaiCode.same(pcArr.get(2),,pcArr.get(3)))
{
px.add("bomb"),;,//PaiRule.BOMB),;
px.add(pcArr.get(0).toString()),;,//meta,data
return,px,;
}
//???		,,		
//3332
if,(PaiCode.same(pcArr.get(0),,pcArr.get(1)),&&,PaiCode.same(pcArr.get(1),,pcArr.get(2)))
{
px.add("sanzhang_single"),;
px.add(pcArr.get(0).toString()),;,//meta,data
return,px,;
}
//2333,
if,(PaiCode.same(pcArr.get(1),,pcArr.get(2)),&&,PaiCode.same(pcArr.get(2),,pcArr.get(3)))
{
px.add("sanzhang_single"),;
px.add(pcArr.get(1).toString()),;,//meta,data
return,px,;
}
//mis,rule
px.add("miss"),;
return,px,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,PaiRuleTip,{
/**
*,?????????????
*,
*,?????????
*,
*,??
*,
*,??,paiCodeCopy,=,pcc
*,
*,????????
*/,
public,static,java.util.ArrayList<PaiUnit>,pick(java.util.ArrayList<Integer>,pccArr)
{
java.util.ArrayList<PaiUnit>,pickup,=,new,java.util.ArrayList<PaiUnit>(),;
//loop,use
int,i,=,0,;
int,j,=,0,;
int,len,=,0,;
//
//PaiUnit,single,;
PaiUnit,pair,;
//PaiUnit,sanzhang,;
PaiUnit,bomb,;
//??
while,(pccArr.size(),>,0)
{
i,=,0,;
j,=,i,+,1,;
len,=,pccArr.size(),;
if,(len,>=,2,&&,((PaiCode.guiWei(pccArr.get(i)),==,PaiCode.guiWei(pccArr.get(j))),||,(pccArr.get(i),==,PaiCode.JOKER_XIAO,&&,pccArr.get(j),==,PaiCode.JOKER_DA),||,(pccArr.get(i),==,PaiCode.JOKER_DA,&&,pccArr.get(j),==,PaiCode.JOKER_XIAO)))
{
//
if,((len,-,j,-,1),>=,2)
{
//??
if,(PaiCode.guiWei(pccArr.get(j)),==,PaiCode.guiWei(pccArr.get(j,+,1)),&&,PaiCode.guiWei(pccArr.get(j,+,1)),==,PaiCode.guiWei(pccArr.get(j,+,2)))
{
bomb,=,new,PaiUnit(pccArr.get(i),,pccArr.get(j),,pccArr.get(j,+,1),,pccArr.get(j,+,2)),;
pickup.add(bomb),;
//pccArr.removeRange(i,,j,+,2,+,1,+,i),;
pccArr.subList(i,,j,+,2,+,1,+,i).clear(),;
continue,;
}
//??
if,(PaiCode.guiWei(pccArr.get(j)),==,PaiCode.guiWei(pccArr.get(j,+,1)))
{
//sanzhang,=,new,PaiUnit(pccArr[i],pccArr[j],pccArr[j+1]),;
//pickup.push(sanzhang),;
//pccArr.removeRange(i,,j,+,1,+,1,+,i),;
pccArr.subList(i,,j,+,1,+,1,+,i).clear(),;
continue,;
}
//??
pair,=,new,PaiUnit(pccArr.get(i),,pccArr.get(j),,-1,,-1),;
pickup.add(pair),;
//pccArr.removeRange(i,,j,+,1,+,i),;
pccArr.subList(i,,j,+,1,+,i).clear(),;
continue,;
}
else,if,((len,-,j,-,1),>=,1)
{
//??
if,(PaiCode.guiWei(pccArr.get(j)),==,PaiCode.guiWei(pccArr.get(j,+,1)))
{
//sanzhang,=,new,PaiUnit(pccArr[i],pccArr[j],pccArr[j+1]),;
//pickup.push(sanzhang),;
//pccArr.removeRange(i,,j,+,1,+,1,+,i),;
pccArr.subList(i,,j,+,1,+,1,+,i).clear(),;
continue,;
}
//??
pair,=,new,PaiUnit(pccArr.get(i),,pccArr.get(j),,-1,,-1),;
pickup.add(pair),;
//pccArr.removeRange(i,,j,+,1,+,i),;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
pccArr.subList(i,,j,+,1,+,i).clear(),;
continue,;
}
else
{
//??
pair,=,new,PaiUnit(pccArr.get(i),,pccArr.get(j),,-1,,-1),;
pickup.add(pair),;
//pccArr.removeRange(i,,j,+,1,+,i),;
pccArr.subList(i,,j,+,1,+,i).clear(),;
continue,;
},//end,if
}
else
{
//single,=,new,PaiUnit(pccArr[i]),;
//pickup.push(single),;
//pccArr.removeRange(i,,j,+,i),;,,,,,,,,,,,,,,,,,,,,,,,,,,
pccArr.subList(i,,j,+,i).clear(),;
continue,;
}
},//end,while
return,pickup,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,PaiUnit,{
public,java.util.ArrayList<Integer>,code,;
public,PaiUnit(int,code1,,int,code2,,int,code3,,int,code4)
{
int,code5,=,-1,;
int,code6,=,-1,;
int,code7,=,-1,;
int,code8,=,-1,;
int,code9,=,-1,;
int,code10,=,-1,;
int,code11,=,-1,;
int,code12,=,-1,;
int,code13,=,-1,;
int,code14,=,-1,;
int,code15,=,-1,;
int,code16,=,-1,;
int,code17,=,-1,;
int,code18,=,-1,;
int,code19,=,-1,;
int,code20,=,-1,;
code,=,new,java.util.ArrayList<Integer>(),;
code.add(code1),;
if,(-1,!=,code2)
{
code.add(code2),;
}
if,(-1,!=,code3)
{
code.add(code3),;
}
if,(-1,!=,code4)
{
code.add(code4),;
}
if,(-1,!=,code5)
{
code.add(code5),;
}
if,(-1,!=,code6)
{
code.add(code6),;
}
if,(-1,!=,code7)
{
code.add(code7),;
}
if,(-1,!=,code8)
{
code.add(code8),;
}
if,(-1,!=,code9)
{
code.add(code9),;
}
if,(-1,!=,code10)
{
code.add(code10),;
}
if,(-1,!=,code11)
{
code.add(code11),;
}
if,(-1,!=,code12)
{
code.add(code12),;
}
if,(-1,!=,code13)
{
code.add(code13),;
}
if,(-1,!=,code14)
{
code.add(code14),;
}
if,(-1,!=,code15)
{
code.add(code15),;
}
if,(-1,!=,code16)
{
code.add(code16),;
}
if,(-1,!=,code17)
{
code.add(code17),;
}
if,(-1,!=,code18)
{
code.add(code18),;
}
if,(-1,!=,code19)
{
code.add(code19),;
}
if,(-1,!=,code20)
{
code.add(code20),;
}
}
/**
*,Meta
*/,
public,final,int,Meta()
{
return,PaiCode.guiWei(code.get(0)),;
}
/**
*,
*/,
public,final,boolean,hasCode(int,n)
{
int,len,=,this.code.size(),;
for,(int,i,=,0,;i,<,len,;i++)
{
if,(this.code.get(i),==,n)
{
return,true,;
}
}
return,false,;
}
public,final,PaiUnit,clone()
{
int,len,=,this.code.size(),;
PaiUnit,pun,=,new,PaiUnit(this.code.get(0),,-1,,-1,,-1),;
for,(int,i,=,1,;i,<,len,;i++)
{
pun.code.add(this.code.get(i)),;
}
return,pun,;
}
public,final,String,Rule()
{
return,PaiRuleCompare.validate(code).get(0),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,System.Console,;
import,System.Xml.XmlDocument,;
import,System.Xml.XmlNode,;
import,System.Xml.XmlNodeList,;
import,java.io.IOException,;
import,java.math.BigDecimal,;
import,java.time.LocalTime,;
import,java.util.Iterator,;
import,java.util.Map.Entry,;
import,java.util.logging.Level,;
import,java.util.logging.Logger,;
import,net.silverfoxserver.core.model.IChairModel,;
import,net.silverfoxserver.core.model.ILookChairModel,;
import,net.silverfoxserver.core.model.IRoomModel,;
import,net.silverfoxserver.core.model.IRuleModel,;
import,net.silverfoxserver.core.model.IUserModel,;
import,net.silverfoxserver.core.util.AS3Util,;
import,net.silverfoxserver.core.util.MathUtil,;
import,net.silverfoxserver.extfactory.ChairModelFactory,;
import,net.silverfoxserver.extlogic.PokerName,;
import,org.jdom2.Element,;
import,org.jdom2.JDOMException,;
import,org.jdom2.Namespace,;
import,org.jdom2.output.XMLOutputter,;
/**
*
*,@author,ACER-FX
*/
public,class,RoomModelByDdz,implements,IRoomModel{
/**,
??id
???,???volatile,
*/
private,int,_id,;
@Override
public,final,int,getId()
{
return,this._id,;
}
/**,
????,??
??????tab,navigate,??
*/
private,int,_tab,;
@Override
public,final,int,getTab()
{
return,this._tab,;
}
/**,
???????????
*/
private,int,_tabAutoMatchMode,;
/**,
???
*/
private,int,_tabQuickRoomMode,;
/**,
??
???,???volatile,
*/
private,int,_diG,;
/**,
????
???,???volatile,
*/
private,int,_carryG,;
/**,
????,???
???,???volatile,
*/
private,float,_costG,;
/**,
?????????
*/
private,String,_costU,;
private,String,_costUid,;
/**,
????
*/
private,String,_name,;
/**,
????,???"",??????+id??
?????????????
@return,
*/
@Override
public,final,String,getName()
{
return,this._name,;
}
@Override
public,final,void,setName(String,value)
{
_name,=,value,;
}
/**,
????
*/
private,String,_pwd,;
@Override
public,final,String,getPwd()
{
return,this._pwd,;
}
@Override
public,final,void,setPwd(String,value)
{
_pwd,=,value,;
}
/**
*,???VIP??
*,
*/
private,int,_vip,;
@Override
public,int,getVip(),{
return,_vip,;
}
@Override
public,void,setVip(int,value),{
_vip,=,value,;
}
/**,
????
*/
private,String,_roomStatus,;
@Override
public,final,String,getStatus()
{
return,this._roomStatus,;
}
private,void,setStatus(String,value)
{
this._roomStatus,=,value,;
}
/**,
????????
*/
private,int,_reconnectionTime,;
@Override
public,final,void,setReconnectionTime(int,value)
{
_reconnectionTime,=,value,;
}
/**,
????,????
*/
private,volatile,boolean,_isWaitReconnection,;
@Override
public,final,int,getMaxWaitReconnectionTime()
{
return,this._reconnectionTime,*,1000,;
}
private,volatile,int,_curWaitReconnectionTime,;
private,volatile,IUserModel,_waitReconnectionUser,;
@Override
public,final,boolean,isWaitReconnection()
{
return,this._isWaitReconnection,;
}
@Override
public,final,int,getCurWaitReconnectionTime()
{
return,this._curWaitReconnectionTime,;
}
@Override
public,final,void,setCurWaitReconnectionTime(int,value)
{
this._curWaitReconnectionTime,=,value,;
}
@Override
public,final,IUserModel,getWaitReconnectionUser()
{
return,this._waitReconnectionUser,;
}
/**,
*/
private,int,_everyDayLogin,;
@Override
public,final,void,setEveryDayLogin(int,value)
{
_everyDayLogin,=,value,;
}
@Override
public,final,int,getEveryDayLogin()
{
return,_everyDayLogin,;
}
/**,
????
*/
private,volatile,String,_matchResult,;
/**,
//,The,.NET,Framework,2.0,way,to,create,a,list
List<int>,list1,=,new,List<int>(),;
//,No,boxing,,no,casting:
//list1.Add(3),;
//,Compile-time,error:
//,list1.Add("It,is,raining,in,Redmond."),;
?????????,???,ArrayList,List<T>,?????????????????????????????????????,???????????,ArrayList,??,???????,??????????????
*/
private,java.util.ArrayList<IChairModel>,_chair,;
//private,List<IChairModel>,_lookChair,;
/**,
????
*/
private,PaiBoardByDdz,_board,;
/**,
??,????????
*/
private,volatile,String,difen,;
/**,
????????
*/
private,volatile,int,bomb,;
private,volatile,int,leaveBomb,;
private,volatile,String,leaveUserId,;
/**,
???userId
???red
*/
private,String,_dizhu,;
public,final,String,getdizhu()
{
return,_dizhu,;
}
public,final,void,setdizhu(String,value)
{
_dizhu,=,value,;
}
/**,
???userId
?,???
???black
*/
private,volatile,String,nongming,;
/**,
???????????,?????????????
????,?????????
????????????
*/
private,volatile,String,mingpai,;
/**,
*/
private,String,_turn,;
public,final,String,getturn()
{
return,_turn,;
}
public,final,void,setturn(String,value)
{
_turn,=,value,;
}
/**,
3???????
click????,?????????,?????
?????????????,?????
*/
private,RoundModelByDdz,_record,;
/**,
????
*/
private,java.util.ArrayList<RoundModelByDdz>,_round,;
/**,
??,?????????
*/
public,RoundTypeByDdz,ROUND_TYPE,=,new,RoundTypeByDdz(),;
/**,
??,???????
*/
/**,
??,?????????
*/
public,MatchResultByDdz,MATCH_RESULT,=,new,MatchResultByDdz(),;
/**,
??,???????
*/
public,PaiName,PAI_NAME,=,new,PaiName(),;
public,PaiRule,PAI_RULE,=,new,PaiRule(),;
/**,
??????
???????,???volatile,
*/
private,boolean,_allowPlayerGlessThanZeroOnGameOver,;
public,final,void,setAllowPlayerGlessThanZeroOnGameOver(boolean,value)
{
_allowPlayerGlessThanZeroOnGameOver,=,value,;
}
/**,
??????
*/
private,int,_runAwayMultiG,;
public,final,void,setRunAwayMultiG(int,value)
{
_runAwayMultiG,=,value,;
}
/**,
*/
private,int,_clock,;
public,final,void,setClockPlusPlus()
{
_clock++,;
}
public,final,int,getClock()
{
return,_clock,;
}
public,RoomModelByDdz(int,id,,IRuleModel,rule,,int,tab,,String,gridXml),throws,JDOMException,,IOException
{
this._id,=,id,;
this._tab,=,tab,;
if,(gridXml.equals(""))
{
this._name,=,"",;
}
else
{
XmlDocument,gridDoc,=,new,XmlDocument(),;
gridDoc.LoadXml(gridXml),;
this._name,=,gridDoc.getDocumentElement().getAttributeValue("n",,Namespace.NO_NAMESPACE),;
//this._name,=,gridDoc.DocumentElement.Attributes["name"].Value,;
}
this.setStatus(RoomStatusByDdz.GAME_WAIT_START),;
this._matchResult,=,MATCH_RESULT.EMPTY,;
this._chair,=,new,java.util.ArrayList<IChairModel>(),;
for,(int,i,=,1,;,i,<=,rule.getChairCount(),;,i++)
{
this._chair.add(ChairModelFactory.Create(i,,rule)),;
},//end,for
//red,=,"",;
//black,=,"",;
this.difen,=,"",;
this.bomb,=,0,;
this.leaveBomb,=,0,;
this.leaveUserId,=,"",;
this.setdizhu(""),;
this.nongming,=,"",;
this.mingpai,=,"",;
this.setturn(""),;
this._board,=,new,PaiBoardByDdz(),;
this._record,=,new,RoundModelByDdz(ROUND_TYPE.JIAO_FEN),;
this._round,=,new,java.util.ArrayList<RoundModelByDdz>(),;
_runAwayMultiG,=,1,;
_isWaitReconnection,=,false,;
_curWaitReconnectionTime,=,0,;
_waitReconnectionUser,=,null,;
}
//Properties
public,final,int,getDig()
{
return,this._diG,;
}
/**,
????????,????????????
@param,value
@return,
*/
public,final,void,setDig(int,value)
{
this._diG,=,value,;
}
public,final,int,getCarryg()
{
return,this._carryG,;
}
public,final,void,setCarryg(int,value)
{
this._carryG,=,value,;
}
public,final,float,getCostg()
{
return,this._costG,;
}
public,final,String,getCostU()
{
return,this._costU,;
}
public,final,String,getCostUid()
{
return,this._costUid,;
}
public,final,void,setCostg(float,value,,String,value2,,String,value3)
{
this._costG,=,value,;
this._costU,=,value2,;
this._costUid,=,value3,;
}
public,final,boolean,isTabAutoMatchMode()
{
if,(0,==,this._tabAutoMatchMode)
{
return,false,;
}
return,true,;
}
public,final,int,getTabAutoMatchMode()
{
return,this._tabAutoMatchMode,;
}
public,final,void,setTabAutoMatchMode(int,value)
{
this._tabAutoMatchMode,=,value,;
}
public,final,void,setTabQuickRoomMode(int,value)
{
this._tabQuickRoomMode,=,value,;
}
/**,
value,???false
@param,value
*/
public,final,void,setReadyForAllChair(boolean,value)
{
int,len,=,this._chair.size(),;
//?????????
//?????ready
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
chair.setReady(value),;
}
}
public,final,void,setReadyAddForAllChair(String,value)
{
int,len,=,this._chair.size(),;
//?????????
//?????ready
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
chair.setReadyAdd(value),;
}
}
public,final,void,reset()
{
this.setStatus(RoomStatusByDdz.GAME_WAIT_START),;
this._matchResult,=,MATCH_RESULT.EMPTY,;
//?????????
//?????ready
setReadyForAllChair(false),;
setReadyAddForAllChair(""),;
//?????,??????,???
this.difen,=,"",;
this.bomb,=,0,;
this.leaveBomb,=,0,;
this.leaveUserId,=,"",;
this.setdizhu(""),;
this.nongming,=,"",;
this.mingpai,=,"",;
this.setturn(""),;
//??,reset
this._board,=,new,PaiBoardByDdz(),;
//????,reset
this._record,=,new,RoundModelByDdz(ROUND_TYPE.JIAO_FEN),;
//????,reset
this._round,=,new,java.util.ArrayList<RoundModelByDdz>(),;
_isWaitReconnection,=,false,;
_curWaitReconnectionTime,=,0,;
this.setWaitReconnection(null),;
//_waitReconnectionUser,=,null,;
}
/**,
IChairModel??,User,???????
@param,value
@return,
*/
public,final,java.util.ArrayList<IChairModel>,findUser(IUserModel,value)
{
java.util.ArrayList<IChairModel>,users,=,new,java.util.ArrayList<IChairModel>(),;
//loop,use
int,i,=,0,;
int,len,=,this._chair.size(),;
//check
for,(i,=,0,;,i,<,len,;,i++)
{
//if,(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null)).getUser().getId(),==,value.getId())
if(this._chair.get(i).getUser().getId().equals(value.getId())),
{
break,;
}
//?????????,?????
if,(i,==,(len,-,1))
{
throw,new,IllegalArgumentException("can,not,found,user,id:",+,value.getId()),;
}
}
//add
for,(i,=,0,;,i,<,len,;,i++)
{
//,,,,,,,,,,,,,,,,,,,,if,(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null)).getUser().getId(),!=,value.getId())
//,,,,,,,,,,,,,,,,,,,,{
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,users.add(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null))),;
//,,,,,,,,,,,,,,,,,,,,}
if(!this._chair.get(i).getUser().getId().equals(value.getId())),
{
users.add(this._chair.get(i)),;
}
}
return,users,;
}
/**,
???,userId
@param,value
@return,
*/
public,final,java.util.ArrayList<IChairModel>,findUser(String,value)
{
java.util.ArrayList<IChairModel>,users,=,new,java.util.ArrayList<IChairModel>(),;
//loop,use
int,i,=,0,;
int,len,=,this._chair.size(),;
//check
for,(i,=,0,;,i,<,len,;,i++)
{
if,(value.equals(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null)).getUser().getId()))
{
break,;
}
//?????????,?????
if,(i,==,(len,-,1))
{
throw,new,IllegalArgumentException("can,not,found,user,id:",+,value),;
}
}
//add
for,(i,=,0,;,i,<,len,;,i++)
{
if,(!value.equals(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null)).getUser().getId()))
{
users.add(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null))),;
}
}
return,users,;
}
/**,
string,dizhu,string,nongming
????,??,??1,??2
@return,
*/
public,final,java.util.ArrayList<IChairModel>,findUser()
{
java.util.ArrayList<IChairModel>,users,=,new,java.util.ArrayList<IChairModel>(),;
//loop,use
int,i,=,0,;
int,len,=,this._chair.size(),;
//add
for,(i,=,0,;,i,<,len,;,i++)
{
if,(this.getdizhu().equals(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null)).getUser().getId()))
{
users.add(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null))),;
}
}
//add
for,(i,=,0,;,i,<,len,;,i++)
{
if,(!this.getdizhu().equals(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null)).getUser().getId()))
{
users.add(((IChairModel)((this._chair.get(i),instanceof,IChairModel),?,this._chair.get(i),:,null))),;
}
}
return,users,;
}
/**,
??????,???findUser??,????????
@param,users
*/
public,final,void,setNongMing(java.util.ArrayList<IChairModel>,users)
{
int,len,=,users.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
this.nongming,+=,users.get(i).getUser().getId(),;
this.nongming,+=,",",;
}
if,(this.nongming.endsWith(","))
{
//this.nongming.Remove(this.nongming.Length,-,1,,1),;
this.nongming,=,new,StringBuffer(nongming).deleteCharAt(nongming.length()-1).toString(),;
}
}
public,final,int,getChairCount()
{
return,this._chair.size(),;
}
public,final,int,getLookChairCount()
{
return,-1,;
//return,this._lookChair.Count,;
}
public,final,java.util.ArrayList<IUserModel>,getAllPeople()
{
java.util.ArrayList<IUserModel>,peopleList,=,new,java.util.ArrayList<IUserModel>(),;
int,jLen,=,this._chair.size(),;
for,(int,j,=,0,;,j,<,jLen,;,j++)
{
IChairModel,c,=,this._chair.get(j),;
if,(!c.getUser().getId().equals(""))
{
peopleList.add(c.getUser()),;
}
}
return,peopleList,;
}
/**,
???????
@return,
*/
public,final,int,getSomeBodyChairCount()
{
//loop,use
int,len,=,this._chair.size(),;
int,count,=,0,;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(!chair.getUser().getId().equals(""))
{
count++,;
}
}
return,count,;
}
public,final,int,getSomeBodyLookChairCount()
{
return,-1,;
//loop,use
/*
int,len,=,this._lookChair.Count,;
int,count,=,0,;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._lookChair[i],;
if,("",!=,chair.getUser().getId())
{
count++,;
}
}
return,count,;
*,*/
}
/**,
?????????
@param,user
@return,
*/
public,final,boolean,hasPeople(IUserModel,user)
{
for,(int,i,=,0,;,i,<,this._chair.size(),;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(chair.getUser().getId().equals(user.getId()))
{
return,true,;
}
},//end,for
return,false,;
}
public,final,boolean,hasSameIpPeople(IUserModel,user,,boolean,isOnChair)
{
//test
//return,false,;
if,(isOnChair)
{
for,(int,i,=,0,;,i,<,this._chair.size(),;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(!chair.getUser().getId().equals(""))
{
String[],compare_1,=,chair.getUser().getStrIpPort().split("[:]",,-1),;
String[],compare_2,=,user.getStrIpPort().split("[:]",,-1),;
if,(compare_1[0].equals(compare_2[0]))
{
return,true,;
}
}
},//end,for
}
return,false,;
}
/**,
????????,,hasPeople
@param,user
@return,
*/
public,final,IChairModel,getChair(IUserModel,user)
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(chair.getUser().getId().equals(user.getId()))
{
return,chair,;
}
},//end,for
//throw,new,ArgumentException("can,not,find,user,",+,user.getId(),+,",func:getChair"),;
return,null,;
}
public,final,IChairModel,getChair(String,userId)
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,c,=,this._chair.get(i),;
if,(userId.equals(c.getUser().getId()))
{
return,c,;
}
},//end,for
//throw,new,ArgumentException("can,not,find,user,",+,user,+,",func:getChair"),;
return,null,;
}
public,final,java.util.ArrayList<IChairModel>,getOtherChair(String,user)
{
//loop,use
int,len,=,this._chair.size(),;
java.util.ArrayList<IChairModel>,list,=,new,java.util.ArrayList<IChairModel>(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(!user.equals(chair.getUser().getId()))
{
list.add(chair),;
}
},//end,for
return,list,;
}
public,final,IChairModel,getChair(int,id)
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(chair.getId(),==,id)
{
return,chair,;
}
},//end,for
//throw,new,ArgumentException("can,not,find,chair,",+,id.ToString(),+,",func:getChair"),;
return,null,;
}
public,final,ILookChairModel,getLookChair(IUserModel,value)
{
return,null,;
}
public,final,ILookChairModel,getLookChair(int,id)
{
return,null,;
}
public,final,,ILookChairModel,getLookChair(String,userId)
{
return,null,;
}
/**,
??
@param,user
@return,
*/
public,final,boolean,setSitDown(IUserModel,user,Boolean,look)
{
//???????,????????
look,=,false,;
//loop,use
int,len,=,this._chair.size(),;
int,i,=,0,;
IChairModel,c,=,null,;
//
for,(i,=,0,;,i,<,len,;,i++)
{
c,=,this._chair.get(i),;
if,(,user.getId().equals(c.getUser().getId()))
{
//??????????????
return,true,;
}
}
//
for,(i,=,0,;,i,<,len,;,i++)
{
c,=,this._chair.get(i),;
if,(!c.getUser().getId().equals(""))
{
//??,???
}
else
{
c.setUser(user),;
//????,?????
//???????,??????????,???ready?????
return,true,;
},//end,if
},//end,for
return,false,;
}
public,final,void,setReadyAdd(String,userId,,String,info)
{
//loop,use
int,len,=,this._chair.size(),;
//????????????
if,(this.mingpai.equals(""))
{
this.mingpai,=,userId,;
}
//
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(userId.equals(chair.getUser().getId()))
{
chair.setReadyAdd(info),;
break,;
},//end,if
},//end,for
}
/**,
??
@param,user
*/
public,final,void,setReady(String,userId)
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,c,=,this._chair.get(i),;
if,(userId.equals(c.getUser().getId()))
{
if,(!c.isReady())
{
c.setReady(true),;
//????ok,??????
//?????????????????
if,(hasAllReady())
{
this.setStatus(RoomStatusByDdz.GAME_ALL_READY_WAIT_START),;
//??????ready?????
setReadyForAllChair(false),;
}
break,;
}
}
},//end,for
}
/**,
round
board
@param,value,,,,,,,,
*/
public,final,void,setChuPai(String,value)
{
//loop,use
int,i,=,0,;
String[],sp,=,value.split("[,]",,-1),;
String,userId,=,sp[0],;
//????????
int,spLen,=,sp.length,;
if,(5,==,spLen,||,3,==,spLen)
{
//List<int>,pcArr,=,new,List<int>(),;
java.util.ArrayList<Integer>,pcArr,=,new,java.util.ArrayList<Integer>(spLen,-,1),;
for,(i,=,1,;,i,<,spLen,;,i++)
{
pcArr.add(PaiCode.convertToCode(sp[i])),;
}
//??(??)????????
if,(PaiRuleCompare.validate_bomb(pcArr),||,PaiRuleCompare.validate_huojian(pcArr))
{
this.bomb++,;
}
}
//
//??????,save,and,new
if,(this._record.isFull())
{
this._round.add(this._record),;
this._record,=,new,RoundModelByDdz(ROUND_TYPE.CHU_PAI),;
}
String,pai,=,"",;
//
spLen,=,sp.length,;
for,(i,=,1,;,i,<,spLen,;,i++)
{
pai,+=,sp[i],;
pai,+=,",",;
}
this._record.setPai(pai,,userId),;,//,set,player
//board
spLen,=,sp.length,;
for,(i,=,1,;,i,<,spLen,;,i++)
{
this._board.update(sp[i],,"del"),;
}
}
/**,
@param,value
*/
public,final,void,setJiaoFen(String,value)
{
//
String[],sp,=,value.split("[,]",,-1),;
String,userId,=,sp[0],;
int,fen,=,Integer.parseInt(sp[1]),;
//?????3?
if,(fen,>,PAI_RULE.JF_MAXVALUE)
{
fen,=,PAI_RULE.JF_MAXVALUE,;
}
//loop,use
int,i,=,0,;
int,len,=,this._chair.size(),;
//save
for,(i,=,0,;,i,<,len,;,i++)
{
if,(userId.equals(this._chair.get(i).getUser().getId()))
{
//??????,save,and,new
if,(this._record.isFull())
{
this._round.add(this._record),;
this._record,=,new,RoundModelByDdz(ROUND_TYPE.JIAO_FEN),;
}
this._record.setFen(fen,,userId),;,//,set,player
//record????????????empty
//????????????????
//-------------------------------------------------------------------
if,(this.getStatus().equals(RoomStatusByDdz.GAME_START))
{
//3?????
if,(2,==,this._round.size(),&&,false,==,this._record.isEmpty(),&&,!this._record.clock_three.equals(""))
{
//check
if,(PAI_RULE.JF_MINVALUE,==,((RoundModelByDdz)((this._round.get(0),instanceof,RoundModelByDdz),?,this._round.get(0),:,null)).clock_one_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,((RoundModelByDdz)((this._round.get(0),instanceof,RoundModelByDdz),?,this._round.get(0),:,null)).clock_two_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,((RoundModelByDdz)((this._round.get(0),instanceof,RoundModelByDdz),?,this._round.get(0),:,null)).clock_three_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,((RoundModelByDdz)((this._round.get(1),instanceof,RoundModelByDdz),?,this._round.get(1),:,null)).clock_one_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,((RoundModelByDdz)((this._round.get(1),instanceof,RoundModelByDdz),?,this._round.get(1),:,null)).clock_two_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,((RoundModelByDdz)((this._round.get(1),instanceof,RoundModelByDdz),?,this._round.get(1),:,null)).clock_three_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,this._record.clock_one_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,this._record.clock_two_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,this._record.clock_three_jiaofen)
{
this.setStatus(RoomStatusByDdz.GAMEOVER_ROOMCLEAR_WAIT_START),;
this._round.add(this._record),;
//reset??new
return,;
}
},//end,if
//??3?
//?3???????
if,(PAI_RULE.JF_MAXVALUE,==,fen)
{
this.setdizhu(userId),;
this.difen,=,String.valueOf(fen),;
//nongming
java.util.ArrayList<IChairModel>,users,=,this.findUser(this._chair.get(i).getUser()),;
//
this.setNongMing(users),;
//
this.setStatus(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU),;
this._round.add(this._record),;,//??????????
this._record,=,new,RoundModelByDdz(ROUND_TYPE.CHU_PAI),;
return,;
}
if,(PAI_RULE.JF_MAXVALUE,>,fen),//??3?
{
//??3?,???????,??
if,(this._record.clock_three.equals(""))
{
return,;
}
else
{
//?????
if,(PAI_RULE.JF_MINVALUE,==,this._record.clock_one_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,this._record.clock_two_jiaofen,&&,PAI_RULE.JF_MINVALUE,==,this._record.clock_three_jiaofen)
{
return,;
}
else
{
//????????,??????
//????,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//????,???,??????
int,maxJf,=,MathUtil.selecMaxNumber(this._record.clock_one_jiaofen,,this._record.clock_two_jiaofen,,this._record.clock_three_jiaofen),;
if,(maxJf,==,this._record.clock_one_jiaofen)
{
this.setdizhu(this._record.clock_one),;
this.difen,=,String.valueOf(maxJf),;
//nongming
java.util.ArrayList<IChairModel>,users,=,this.findUser(this._record.clock_one),;
this.setNongMing(users),;
}
else,if,(maxJf,==,this._record.clock_two_jiaofen)
{
this.setdizhu(this._record.clock_two),;
this.difen,=,String.valueOf(maxJf),;
java.util.ArrayList<IChairModel>,users,=,this.findUser(this._record.clock_two),;
this.setNongMing(users),;
}
else,if,(maxJf,==,this._record.clock_three_jiaofen)
{
this.setdizhu(this._record.clock_three),;
this.difen,=,String.valueOf(maxJf),;
java.util.ArrayList<IChairModel>,users,=,this.findUser(this._record.clock_three),;
this.setNongMing(users),;
}
else
{
throw,new,IllegalArgumentException("can,not,find,max,jiao,fen"),;
}
//
this.setStatus(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU),;
//????save,????
this._round.add(this._record),;
this._record,=,new,RoundModelByDdz(ROUND_TYPE.CHU_PAI),;
}
}
}
},//end,if
break,;
},//end,if
},//end,for
}
/**,
???????
?????????????
??????,???????,??????ready?????
??????,hasAllReadyCanStart
@return,
*/
private,boolean,hasAllReady()
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,c,=,this._chair.get(i),;
if,(c.isReady())
{
}
else
{
return,false,;,//??????????,return,false
}
},//end,for
return,true,;
}
public,final,boolean,hasAllReadyCanStart()
{
if,(this.getStatus().equals(RoomStatusByDdz.GAME_ALL_READY_WAIT_START))
{
return,true,;
}
return,false,;
}
/**,
@return,
*/
public,final,int,chkVars(String,n,,String,v,,IUserModel,u)
{
int,i,=,0,;
int,j,=,0,;
int,spLen,=,0,;
int,sta,=,RvarsStatus.Success0,;
String,userId,=,u.getId(),;
//???????
//,,,,,,,,,,,,if,(n.equals("chairReady"))
//,,,,,,,,,,,,{
//,,,,,,,,,,,,,,,,,,,,//?????????????
//,,,,,,,,,,,,,,,,,,,,if,(!v.equals(userId))
//,,,,,,,,,,,,,,,,,,,,{
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,return,false,;
//,,,,,,,,,,,,,,,,,,,,}
//
//,,,,,,,,,,,,}
//else,
if,(n.equals("tuoGuan"))
{
//?????????????
if,(!v.equals(userId))
{
return,RvarsStatus.OnlyIsIapplyMy1,;
}
}
else,if,(n.equals("jiaoFen"))
{
//?????????????
if,(!v.contains(userId))
{
return,RvarsStatus.OnlyIsIapplyMy1,;
}
//------------,??????,begin,------------
//,,,,,,,,,,,,,,,,,,,,String[],sp,=,v.split("[,]",,-1),;
//
//,,,,,,,,,,,,,,,,,,,,//
//,,,,,,,,,,,,,,,,,,,,int,fen,=,Integer.parseInt(sp[1]),;
//
//,,,,,,,,,,,,,,,,,,,,//?????3?
//,,,,,,,,,,,,,,,,,,,,if,(fen,>,PAI_RULE.JF_MAXVALUE)
//,,,,,,,,,,,,,,,,,,,,{
//,,,,,,,,,,,,,,,,,,,,,,,,,,,,fen,=,PAI_RULE.JF_MAXVALUE,;
//,,,,,,,,,,,,,,,,,,,,}
//
//,,,,,,,,,,,,,,,,,,,,nodeVars.ChildNodes()[loop_i].setText(sp[0],+,",",+,String.valueOf(fen)),;
//------------,??????,end,------------
}
else,if,(n.equals("chuPai"))
{
//?????????????
if,(!v.contains(userId))
{
return,RvarsStatus.OnlyIsIapplyMy1,;
}
//???????????
IChairModel,c,=,this.getChair(userId),;
if,(null,==,c)
{
return,RvarsStatus.OnlyIsIapplyMy1,;
}
//,int,h0_pai,=,this._board.getPaiCountByGrid(0),;
java.util.ArrayList<String>,h_paiList,=,this._board.getPaiByGrid(c.getId(),-,1),;
String[],sp,=,v.split("[,]",,-1),;
spLen,=,sp.length,;
for,(i,=,1,;,i,<,spLen,;,i++)
{
boolean,hasPai,=,false,;
for,(j,=,0,;,j,<,h_paiList.size(),;,j++)
{
if,(h_paiList.get(j).equals(sp[i]))
{
hasPai,=,true,;
break,;
}
}
if,(!hasPai)
{
return,RvarsStatus.NoCard2,;
}
}
}
//sta,=,RvarsStatus.Success0,;
return,sta,;
}
/**,
@param,n
@param,v,,,,,,
*/
public,final,void,setVars(String,n,,String,v)
{
if,(n.equals("chairReady"))
{
//userId
this.setReady(v),;
}
else,if,(n.equals("chairMingReady"))
{
this.setReady(v),;
this.setReadyAdd(v,,PAI_RULE.MING_PAI),;
}
else,if,(n.equals("jiaoFen"),&&,this.hasGamePlaying())
{
this.setJiaoFen(v),;,//,v.split(","),;
//
this.getTurn(),;
}
else,if,(n.equals("chuPai"),&&,this.hasGamePlaying(RoomStatusByDdz.GAME_START_CHUPAI))
{
//selectPai???,??????,????
this.setChuPai(v),;
//
setGameOver(),;
//
this.getTurn(),;
}
//else,if,("renShu",==,n)
//{
//,,,,setGameOver(v,,0),;
//
//,,,,this.getTurn(),;
//}
}
/**,
??????
@param,roomStatus,,,,,,,,
*/
public,final,void,setGameStart(String,value)
{
//C#,TO,JAVA,CONVERTER,NOTE:,The,following,'switch',operated,on,a,string,member,and,was,converted,to,Java,'if-else',logic:
//		switch,(value)
//ORIGINAL,LINE:,case,"":
if,(value.equals(""),||,RoomStatusByDdz.GAME_START.equals(value))
{
if,(this.getStatus().equals(RoomStatusByDdz.GAME_ALL_READY_WAIT_START))
{
this.setStatus(value),;
//??
this._board.xipai(),;
//
this.getTurn(),;
}
}
//ORIGINAL,LINE:,case,RoomStatusByDdz.GAME_START_CAN_GET_DIZHU:
else,if,(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU.equals(value))
{
if,(this.getStatus().equals(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU))
{
//?????
//-------------------------
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(this.getdizhu().equals(chair.getUser().getId()))
{
//i??h
//C#,TO,JAVA,CONVERTER,WARNING:,Unsigned,integer,types,have,no,direct,equivalent,in,Java:
//ORIGINAL,LINE:,this._board.addDiPaiToGrid(Convert.ToUInt32(i)),;
this._board.addDiPaiToGrid((int)i),;
break,;
},//end,if
},//end,for
}
//
this.getTurn(),;
}
//ORIGINAL,LINE:,case,RoomStatusByDdz.GAME_START_CHUPAI:
else,if,(RoomStatusByDdz.GAME_START_CHUPAI.equals(value))
{
if,(this.getStatus().equals(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU))
{
//
this.setStatus(value),;
}
}
else
{
}
}
/**,
???????
0,-,??
1,-,??
@param,userId
@param,category
*/
public,final,void,setGameOver(String,userId,,int,category)
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(userId.equals(chair.getUser().getId()))
{
if,(this.getdizhu().equals(userId))
{
this._matchResult,=,this.MATCH_RESULT.NONGMING_WIN,;
this.setturn(""),;
this.setStatus(RoomStatusByDdz.GAMEOVER_WAIT_START),;
}
else
{
this._matchResult,=,this.MATCH_RESULT.DIZHU_WIN,;
this.setturn(""),;
this.setStatus(RoomStatusByDdz.GAMEOVER_WAIT_START),;
}
},//end,if
},//end,for
}
/**,
setGameOver??????
h??grid?????0??,
*/
private,void,setWhoWin(int,h)
{
IChairModel,h_chair,=,this._chair.get(h),;
if,(this.getdizhu().equals(h_chair.getUser().getId()))
{
this._matchResult,=,MATCH_RESULT.DIZHU_WIN,;
}
else,if,(this.nongming.contains(h_chair.getUser().getId()))
{
this._matchResult,=,MATCH_RESULT.NONGMING_WIN,;
}
this.setturn(""),;
this.setStatus(RoomStatusByDdz.GAMEOVER_WAIT_START),;
}
/**,
????????0????
*/
public,final,void,setGameOver()
{
int,h0_pai,=,this._board.getPaiCountByGrid(0),;
int,h1_pai,=,this._board.getPaiCountByGrid(1),;
int,h2_pai,=,this._board.getPaiCountByGrid(2),;
if,(0,==,h0_pai)
{
setWhoWin(0),;
}
else,if,(0,==,h1_pai)
{
setWhoWin(1),;
}
else,if,(0,==,h2_pai)
{
setWhoWin(2),;
}
}
/**,
?????
@param,viewName
*/
public,final,void,setGameOver(String,viewName)
{
throw,new,IllegalArgumentException("?????"),;
}
/**,
??????????
???????
?????,UserLeave??
?????leaveUser,????????
?????????,?setLeaveUser
@param,leaveUser
*/
public,final,void,setWaitReconnection(IUserModel,waitUser)
{
if,(null,==,waitUser)
{
this._isWaitReconnection,=,false,;
}
else
{
this._isWaitReconnection,=,true,;
}
this._waitReconnectionUser,=,waitUser,;
}
public,final,void,setGameOver(IUserModel,leaveUser)
{
//loop,use,,,,,,,,,,,,
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,("".equals(chair.getUser().getId()))
{
chair.setUser(leaveUser),;
break,;
}
}
//for,(int,i,=,0,;,i,<,len,;,i++)
//{
//IChairModel,chair,=,this._chair[i],;
//if,(chair.getUser().getId(),==,leaveUser.getId())
//{
//???????
//if,(chair.getUser().getId(),==,this.dizhu)
if,(this.getdizhu().equals(leaveUser.getId()))
{
//????,?????????
this.leaveUserId,=,leaveUser.getId(),;,//chair.getUser().getId(),;
this.leaveBomb,=,getAllHasBombCount(),;
this._matchResult,=,this.MATCH_RESULT.NONGMING_WIN,;
this.setturn(""),;
this.setStatus(RoomStatusByDdz.GAMEOVER_WAIT_START),;
//break,;
}
//else,if(this.nongming.IndexOf(chair.getUser().getId()),>=,0)
else,if,(this.nongming.indexOf(leaveUser.getId()),>=,0)
{
//????,?????????
this.leaveUserId,=,leaveUser.getId(),;
this.leaveBomb,=,getAllHasBombCount(),;
this._matchResult,=,this.MATCH_RESULT.DIZHU_WIN,;
this.setturn(""),;
this.setStatus(RoomStatusByDdz.GAMEOVER_WAIT_START),;
//,break,;
}
else
{
//????????????
//???????
this.setdizhu(leaveUser.getId()),;,//chair.getUser().getId(),;
java.util.ArrayList<IChairModel>,list,=,this.getOtherChair(leaveUser.getId()),;
//chair.getUser().getId()
this.setNongMing(list),;
//?????
//??????
this._matchResult,=,this.MATCH_RESULT.NONGMING_WIN,;
this.setturn(""),;
this.setStatus(RoomStatusByDdz.GAMEOVER_WAIT_START),;
//break,;
}
//}
//}//end,for
//leave,??????????????
//setLeaveUser(leaveUser),;
}
/**,
???????????
*/
public,final,int,getAllHasBombCount()
{
//????,??????,??1???
//return,1,;
return,_runAwayMultiG,;
/*
*,
int,h0_bomb,=,0,;
int,h1_bomb,=,0,;
int,h2_bomb,=,0,;
try
{
h0_bomb,=,this._board.getBombCountByGrid(0),;
h1_bomb,=,this._board.getBombCountByGrid(1),;
h2_bomb,=,this._board.getBombCountByGrid(2),;
}
catch,(Exception,exd)
{
h0_bomb,=,0,;
h1_bomb,=,0,;
h2_bomb,=,0,;
}
return,h0_bomb,+,h1_bomb,+,h2_bomb,;
*/
}
public,final,void,setLeaveUser(IUserModel,leaveUser)
{
//loop,use
int,len,=,this._chair.size(),;
for,(int,i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(chair.getUser().getId(),==,leaveUser.getId())
{
if,(this.getdizhu().equals(leaveUser.getId()))
{
//????
if,(!this.isWaitReconnection())
{
this.setdizhu(""),;
}
}
else
{
//
if,(!this.isWaitReconnection())
{
this.nongming,=,"",;
}
}
//reset
chair.reset(),;
}
},//end,for
}
public,final,boolean,hasGamePlaying()
{
if,(this.getStatus().equals(RoomStatusByDdz.GAME_START),||,this.getStatus().equals(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU),||,this.getStatus().equals(RoomStatusByDdz.GAME_START_CHUPAI))
{
return,true,;
}
return,false,;
}
/**,
??????????
@param,roomStatus
@return,
*/
public,final,boolean,hasGamePlaying(String,roomStatus)
{
if,(hasGamePlaying())
{
if,(this.getStatus().equals(roomStatus))
{
return,true,;
}
}
return,false,;
}
public,final,boolean,hasGameOver_RoomClear()
{
if,(this.getStatus().equals(RoomStatusByDdz.GAMEOVER_ROOMCLEAR_WAIT_START))
{
return,true,;
}
return,false,;
}
public,final,boolean,hasGameOver()
{
if,(this.getStatus().equals(RoomStatusByDdz.GAMEOVER_WAIT_START))
{
return,true,;
}
return,false,;
}
/**,
??????,????????????
?,-,?,or,?,or,??,or,????
red,,black,,he,,,,,,""
@return,
*/
public,final,String,getWhoWin()
{
if,(this._matchResult.equals(this.MATCH_RESULT.DIZHU_WIN))
{
return,"dizhu",;
}
if,(this._matchResult.equals(this.MATCH_RESULT.NONGMING_WIN))
{
return,"nongming",;
}
if,(this._matchResult.equals(this.MATCH_RESULT.HE))
{
return,"he",;
}
if,(this._matchResult.equals(this.MATCH_RESULT.EMPTY))
{
return,"",;
}
throw,new,IllegalArgumentException("can,not,found,",+,this._matchResult,+,",in,MATCH_RESULT"),;
}
/**,
???????????
record?round?????????,?????????
@return,
*/
public,final,IChairModel,getClockNext()
{
IChairModel,chair,;
if,(!this._record.clock_three.equals(""))
{
chair,=,this.getChair(this._record.clock_three),;
}
else,if,(!this._record.clock_two.equals(""))
{
chair,=,this.getChair(this._record.clock_two),;
}
else,if,(!this._record.clock_one.equals(""))
{
chair,=,this.getChair(this._record.clock_one),;
}
else
{
chair,=,this.getChair(this._round.get(this._round.size(),-,1).clock_three),;
}
return,getChairNext(chair),;
}
/**,
@return,
*/
private,IChairModel,getChairNext(IChairModel,chair)
{
//loop,use
int,i,=,0,;
int,len,=,this._chair.size(),;
for,(i,=,0,;,i,<,len,;,i++)
{
if,(chair.getId(),==,this._chair.get(i).getId())
{
if,(i,==,(len,-,1))
{
return,this._chair.get(0),;
}
else
{
return,this._chair.get(i,+,1),;
}
},//end,if
//check
if,(i,==,(len,-,1))
{
throw,new,IllegalArgumentException("can,not,find,chair,id:",+,chair.getId(),+,",func:getChairNext"),;
}
},//end,for
return,this._chair.get(0),;
}
/**,
trun??????????,????,????????,
???????
@return,
*/
public,final,String,getTurnByCheckTurnNoOK()
{
//??
java.util.Random,ran,=,new,java.util.Random(LocalTime.now().getSecond()),;//new,java.util.Date().Millisecond),;
int,chairInd,=,ran.nextInt(this._chair.size()),;
setturn(this._chair.get(chairInd).getUser().getId()),;
return,getturn(),;
}
/**,
?????
@return,
*/
private,String,getTurn()
{
//?????
if,(this.getStatus().equals(RoomStatusByDdz.GAME_WAIT_START),||,this.getStatus().equals(RoomStatusByDdz.GAMEOVER_WAIT_START),||,this.getStatus().equals(RoomStatusByDdz.GAMEOVER_ROOMCLEAR_WAIT_START))
{
setturn(""),;
return,getturn(),;
}
//????
//????
//0?,0??
if,(0,==,this._round.size(),&&,this._record.clock_one.equals(""))
{
//????,?????,????
if,(this.mingpai.equals(""))
{
//??
java.util.Random,ran,=,new,java.util.Random(LocalTime.now().getSecond()),;//new,java.util.Date().Millisecond),;
int,chairInd,=,ran.nextInt(this._chair.size()),;
setturn(this._chair.get(chairInd).getUser().getId()),;
return,getturn(),;
}
else
{
setturn(this.mingpai),;
return,getturn(),;
}
}
else,if,(this.getStatus().equals(RoomStatusByDdz.GAME_START))
{
setturn(this.getClockNext().getUser().getId()),;
return,getturn(),;
}
else,if,(this.getStatus().equals(RoomStatusByDdz.GAME_START_CAN_GET_DIZHU))
{
setturn(this.getdizhu()),;
return,getturn(),;
}
else,if,(this.getStatus().equals(RoomStatusByDdz.GAME_START_CHUPAI))
{
setturn(this.getClockNext().getUser().getId()),;
return,getturn(),;
}
//return,"",;
setturn(this.getClockNext().getUser().getId()),;
return,getturn(),;
}
/**
*,??????
*,
*,@return,
*/
public,final,String,getHonorResultXmlByRc()
{
StringBuilder,sb,=,new,StringBuilder(),;
//
sb.append("<room,id='"),;
sb.append((new,Integer(this.getId())).toString()),;
sb.append("',name='"),;
sb.append(this._name),;
//sb.Append("',tab='"),;
//sb.Append(this.Tab.ToString()),;
sb.append("',gamename='"),;
sb.append("Ddz"),;
sb.append("'>"),;
//
sb.append(getHonorResultXmlByRcContent()),;
//
sb.append("</room>"),;
return,sb.toString(),;
}
/**,
????????,?????????
@return,
*/
public,final,String,getMatchResultXmlByRc()
{
StringBuilder,sb,=,new,StringBuilder(),;
//
sb.append("<room,id='"),;
sb.append((new,Integer(this.getId())).toString()),;
sb.append("',name='"),;
sb.append(this._name),;
//sb.Append("',tab='"),;
//sb.Append(this.Tab.ToString()),;
sb.append("',gamename='"),;
sb.append("Ddz"),;
sb.append("'>"),;
//
sb.append(getMatchResultXmlByRcContent()),;
//
sb.append("</room>"),;
return,sb.toString(),;
}
private,String,getMatchResultXmlByRcContent()
{
StringBuilder,sb,=,new,StringBuilder(),;
//????,?,1,,?-1
//??,=,bomb,x,2
//????,x,??,x,??,x,??
String,whoWin,;
long,winG,;
String,winG_,=,"",;
long,lostG,;
String,lostG_,=,"",;
long,costG,;
double,tmpG,;
int,bombG,;
int,mingPaiG,;
String,winId,;
String,lostId,;
String,winId_sql,;
String,lostId_sql,;
//??
//string,lostId1,;
//string,lostId2,;
String,costId,=,this.getCostUid(),;
String,costId_sql,=,"0",;
String,winNickName,;
String,lostNickName,;
String,costNickName,=,this.getCostU(),;
java.util.ArrayList<IChairModel>,users,=,this.findUser(),;
if,(0,==,this.bomb,&&,0,==,this.leaveBomb)
{
//????,0,x,0,=,0,
bombG,=,1,;
}
else
{
//?????
//bombG,=,this.bomb,*,2,+,this.leaveBomb,*,2,;
//????
//???????,??16?
if,((this.bomb,+,this.leaveBomb),>,16)
{
bombG,=,(int)Math.pow(2,,16),;
}
else
{
bombG,=,(int)Math.pow(2,,this.bomb,+,this.leaveBomb),;
}
}
//????
if,(this.mingpai.equals(""))
{
mingPaiG,=,1,;
}
else
{
//?????????????
mingPaiG,=,2,;
}
//?????
whoWin,=,this.getWhoWin(),;
//????
if,(whoWin.equals("dizhu"))
{
if,(!this.difen.equals(""),&&,!this.difen.equals("0"))
{
//2?????2?,???2???
//????,=,1
winG,=,2,*,this.getDig(),*,Integer.parseInt(this.difen),*,bombG,*,mingPaiG,;
lostG,=,this.getDig(),*,Integer.parseInt(this.difen),*,bombG,*,mingPaiG,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
else
{
//????(???)?????
//?????,????2???,?????????,??3???
//winG,=,2,*,this.getDig(),*,3??,;
//????,????????
winG,=,2,*,this.getDig(),*,3,*,mingPaiG,;
lostG,=,this.getDig(),*,3,*,mingPaiG,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
//winId,=,this.dizhu,;
//lostId,=,this.nongming,;
winId,=,users.get(0).getUser().getId(),;
lostId,=,users.get(1).getUser().getId(),+,",",+,users.get(2).getUser().getId(),;
winId_sql,=,String.valueOf(users.get(0).getUser().getId_SQL()),;
lostId_sql,=,String.valueOf(users.get(1).getUser().getId_SQL()),+,",",+,String.valueOf(users.get(2).getUser().getId_SQL()),;
winNickName,=,users.get(0).getUser().getNickName(),;
lostNickName,=,users.get(1).getUser().getNickName(),+,",",+,users.get(2).getUser().getNickName(),;
//--------------------------------------------------
//??????,??????????,?????????
//?????????,win,=,2,x,??(???,???,?????)??????
if,(!this._allowPlayerGlessThanZeroOnGameOver)
{
if,(users.get(1).getUser().getG(),>=,users.get(2).getUser().getG())
{
if,(lostG,>=,users.get(2).getUser().getG())
{
lostG,=,users.get(2).getUser().getG(),;
winG,=,2,*,lostG,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
}
else
{
if,(lostG,>=,users.get(1).getUser().getG())
{
lostG,=,users.get(1).getUser().getG(),;
winG,=,2,*,lostG,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
}
}
//
if,(!leaveUserId.equals(""))
{
//lostId,=,users[1].getUser().getId(),+,",",+,users[2].getUser().getId(),;
if,(leaveUserId.equals(users.get(1).getUser().getId()))
{
lostG_,=,String.valueOf(lostG,*,2),+,",0",;
}
if,(leaveUserId.equals(users.get(2).getUser().getId()))
{
lostG_,=,"0,",+,String.valueOf(lostG,*,2),;
}
}
else
{
lostG_,=,lostG,+,",",+,lostG,;
}
//--------------------------------------------------
}
else,if,(whoWin.equals("nongming")),//????
{
if,(!this.difen.equals(""),&&,!this.difen.equals("0"))
{
//
//????,=,1
winG,=,this.getDig(),*,Integer.parseInt(this.difen),*,bombG,*,mingPaiG,;
lostG,=,2,*,this.getDig(),*,Integer.parseInt(this.difen),*,bombG,*,mingPaiG,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
else
{
//????(???)?????
//?????,????2???,?????????,??3???
//????,????????
winG,=,this.getDig(),*,3,*,mingPaiG,;
lostG,=,2,*,this.getDig(),*,3,*,mingPaiG,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
//winId,=,this.nongming,;
//lostId,=,this.dizhu,;
winId,=,users.get(1).getUser().getId(),+,",",+,users.get(2).getUser().getId(),;
lostId,=,users.get(0).getUser().getId(),;
winId_sql,=,String.valueOf(users.get(1).getUser().getId_SQL()),+,",",+,String.valueOf(users.get(2).getUser().getId_SQL()),;
lostId_sql,=,String.valueOf(users.get(0).getUser().getId_SQL()),;
winNickName,=,users.get(1).getUser().getNickName(),+,",",+,users.get(2).getUser().getNickName(),;
lostNickName,=,users.get(0).getUser().getNickName(),;
//--------------------------------------------------
//
if,(!this._allowPlayerGlessThanZeroOnGameOver)
{
if,(lostG,>=,users.get(0).getUser().getG())
{
lostG,=,users.get(0).getUser().getG(),;
winG,=,lostG,/,2,;
//
tmpG,=,Math.floor(winG,*,this.getCostg()),;
costG,=,Long.parseLong(Floor(tmpG)),;
winG,=,winG,-,Long.parseLong(Floor(tmpG)),;
//lostG??,???????
}
}
//??
winG_,=,(new,Long(winG)).toString(),+,",",+,(new,Long(winG)).toString(),;
//--------------------------------------------------
}
else
{
throw,new,IllegalArgumentException("may,be,has,one,in,getWhoWin"),;
}
//??????
sb.append("<action,type='add',id='"),;
sb.append(costId),;
sb.append("',id_sql='"),;
sb.append(costId_sql),;
sb.append("',n='"),;
sb.append(costNickName),;
sb.append("',g='"),;
sb.append((new,Long(costG)).toString()),;
sb.append("'/>"),;
//????
sb.append("<action,type='add',id='"),;
sb.append(winId),;
sb.append("',id_sql='"),;
sb.append(winId_sql),;
sb.append("',n='"),;
sb.append(winNickName),;
sb.append("',g='"),;
//if,(string.IsNullOrEmpty(winG_))
//if,(tangible.DotNetToJavaStringHelper.isNullOrEmpty(winG_))
if(null,==,winG_,||,
winG_.isEmpty())
{
sb.append((new,Long(winG)).toString()),;
}
else
{
sb.append(String.valueOf(winG_)),;
}
sb.append("'/>"),;
sb.append("<action,type='sub',id='"),;
sb.append(lostId),;
sb.append("',id_sql='"),;
sb.append(lostId_sql),;
sb.append("',n='"),;
sb.append(lostNickName),;
sb.append("',g='"),;
//if,(tangible.DotNetToJavaStringHelper.isNullOrEmpty(lostG_))
if(null,==,lostG_,||,
lostG_.isEmpty())
{
sb.append((new,Long(lostG)).toString()),;
}
else
{
sb.append(String.valueOf(lostG_)),;
}
sb.append("'/>"),;
return,sb.toString(),;
}
/**
*,
*,
*,@return,
*/
private,String,getHonorResultXmlByRcContent()
{
StringBuilder,sb,=,new,StringBuilder(),;
String,winId,;
String,lostId,;
String,winId_sql,;
String,lostId_sql,;
String,winNickName,;
String,lostNickName,;
java.util.ArrayList<IChairModel>,users,=,this.findUser(),;
//?????
String,whoWin,=,this.getWhoWin(),;
//????
if,(whoWin.equals("dizhu"))
{
winId,=,users.get(0).getUser().getId(),;
lostId,=,users.get(1).getUser().getId(),+,",",+,users.get(2).getUser().getId(),;
winId_sql,=,String.valueOf(users.get(0).getUser().getId_SQL()),;
lostId_sql,=,String.valueOf(users.get(1).getUser().getId_SQL()),+,",",+,String.valueOf(users.get(2).getUser().getId_SQL()),;
winNickName,=,users.get(0).getUser().getNickName(),;
lostNickName,=,users.get(1).getUser().getNickName(),+,",",+,users.get(2).getUser().getNickName(),;
}
else,if,(whoWin.equals("nongming")),//????
{
winId,=,users.get(1).getUser().getId(),+,",",+,users.get(2).getUser().getId(),;
lostId,=,users.get(0).getUser().getId(),;
winId_sql,=,String.valueOf(users.get(1).getUser().getId_SQL()),+,",",+,String.valueOf(users.get(2).getUser().getId_SQL()),;
lostId_sql,=,String.valueOf(users.get(0).getUser().getId_SQL()),;
winNickName,=,users.get(1).getUser().getNickName(),+,",",+,users.get(2).getUser().getNickName(),;
lostNickName,=,users.get(0).getUser().getNickName(),;
}
else
{
throw,new,IllegalArgumentException("may,be,has,one,in,getWhoWin"),;
}
//????
sb.append("<action,type='win',id='"),;
sb.append(winId),;
sb.append("',id_sql='"),;
sb.append(winId_sql),;
sb.append("',n='"),;
sb.append(winNickName),;
sb.append("'/>"),;
sb.append("<action,type='lost',id='"),;
sb.append(lostId),;
sb.append("',id_sql='"),;
sb.append(lostId_sql),;
sb.append("',n='"),;
sb.append(lostNickName),;
sb.append("'/>"),;
return,sb.toString(),;
}
private,String,ByRecord(java.util.HashMap<String,,String>,rd,,RoundModelByDdz,_round_j)
{
if,(!_round_j.clock_one.equals(""))
{
if,(!rd.containsValue(_round_j.clock_one),&&,!rd.containsKey("A"))
{
rd.put("A",,_round_j.clock_one),;
}
if,(!rd.containsValue(_round_j.clock_one),&&,!rd.containsKey("B"))
{
rd.put("B",,_round_j.clock_one),;
}
if,(!rd.containsValue(_round_j.clock_one),&&,!rd.containsKey("C"))
{
rd.put("C",,_round_j.clock_one),;
}
}
if,(!_round_j.clock_two.equals(""))
{
if,(!rd.containsValue(_round_j.clock_two),&&,!rd.containsKey("A"))
{
rd.put("A",,_round_j.clock_two),;
}
if,(!rd.containsValue(_round_j.clock_two),&&,!rd.containsKey("B"))
{
rd.put("B",,_round_j.clock_two),;
}
if,(!rd.containsValue(_round_j.clock_two),&&,!rd.containsKey("C"))
{
rd.put("C",,_round_j.clock_two),;
}
}
if,(!_round_j.clock_three.equals(""))
{
if,(!rd.containsValue(_round_j.clock_three),&&,!rd.containsKey("A"))
{
rd.put("A",,_round_j.clock_three),;
}
if,(!rd.containsValue(_round_j.clock_three),&&,!rd.containsKey("B"))
{
rd.put("B",,_round_j.clock_three),;
}
if,(!rd.containsValue(_round_j.clock_three),&&,!rd.containsKey("C"))
{
rd.put("C",,_round_j.clock_three),;
}
}
String,rj,=,_round_j.toXMLSting(),;
//replace
if,(rd.containsKey("A"))
{
rj,=,rj.replace(rd.get("A"),,"A"),;
}
if,(rd.containsKey("B"))
{
rj,=,rj.replace(rd.get("B"),,"B"),;
}
if,(rd.containsKey("C"))
{
rj,=,rj.replace(rd.get("C"),,"C"),;
}
return,rj,;
}
private,String,ByRound(java.util.HashMap<String,,String>,rd,,int,j)
{
if,(!this._round.get(j).clock_one.equals(""))
{
if,(!rd.containsValue(this._round.get(j).clock_one),&&,!rd.containsKey("A"))
{
rd.put("A",,this._round.get(j).clock_one),;
}
if,(!rd.containsValue(this._round.get(j).clock_one),&&,!rd.containsKey("B"))
{
rd.put("B",,this._round.get(j).clock_one),;
}
if,(!rd.containsValue(this._round.get(j).clock_one),&&,!rd.containsKey("C"))
{
rd.put("C",,this._round.get(j).clock_one),;
}
}
if,(!this._round.get(j).clock_two.equals(""))
{
if,(!rd.containsValue(this._round.get(j).clock_two),&&,!rd.containsKey("A"))
{
rd.put("A",,this._round.get(j).clock_two),;
}
if,(!rd.containsValue(this._round.get(j).clock_two),&&,!rd.containsKey("B"))
{
rd.put("B",,this._round.get(j).clock_two),;
}
if,(!rd.containsValue(this._round.get(j).clock_two),&&,!rd.containsKey("C"))
{
rd.put("C",,this._round.get(j).clock_two),;
}
}
if,(!this._round.get(j).clock_three.equals(""))
{
if,(!rd.containsValue(this._round.get(j).clock_three),&&,!rd.containsKey("A"))
{
rd.put("A",,this._round.get(j).clock_three),;
}
if,(!rd.containsValue(this._round.get(j).clock_three),&&,!rd.containsKey("B"))
{
rd.put("B",,this._round.get(j).clock_three),;
}
if,(!rd.containsValue(this._round.get(j).clock_three),&&,!rd.containsKey("C"))
{
rd.put("C",,this._round.get(j).clock_three),;
}
}
String,rj,=,this._round.get(j).toXMLSting(),;
//replace
if,(rd.containsKey("A"))
{
rj,=,rj.replace(rd.get("A"),,"A"),;
}
if,(rd.containsKey("B"))
{
rj,=,rj.replace(rd.get("B"),,"B"),;
}
if,(rd.containsKey("C"))
{
rj,=,rj.replace(rd.get("C"),,"C"),;
}
return,rj,;
}
/**,
?????contentXml??????
*,@param,strIpPort
@param,contentXml
@return,
*/
public,final,String,getFilterContentXml(String,strIpPort,,String,contentXml)
{
//loop,use
int,i,=,0,;
int,j,=,0,;
int,h,=,0,;
//
int,len,=,this._chair.size(),;
//
int,n0,=,0,;
int,n1,=,0,;
int,n2,=,0,;
//,,,,,,,,,,,,XmlElement,ele0,;
//,,,,,,,,,,,,XmlElement,ele1,;
//,,,,,,,,,,,,XmlElement,ele2,;,,,,,,,,,,,,
Element,ele0,;
Element,ele1,;
Element,ele2,;
//
String,ming,=,"",;
for,(i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(PAI_RULE.MING_PAI.equals(chair.getReadyAdd()))
{
ming,+=,(new,Integer(i)).toString(),;
ming,+=,",",;,//ming,contains???????
}
},//end,for
//
//??????,????????,
//????????
//?????????
XmlDocument,doc,=,new,XmlDocument(),;
try,{
//??????,?ie??xml?????????
doc.LoadXml(contentXml),;
},catch,(JDOMException,|,IOException,ex),{
Console.WriteLine(ex.getMessage()),;
//Logger.getLogger(RoomModelByDdz.class.getName()).log(Level.SEVERE,,null,,ex),;
}
XmlNodeList,itemList,=,null,;
try,{
itemList,=,doc.SelectNodes("/room/item"),;
},catch,(JDOMException,ex),{
Console.WriteLine(ex.getMessage()),;
}
//
for,(i,=,0,;,i,<,len,;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
if,(strIpPort.equals(chair.getUser().getStrIpPort()))
{
if,(0,==,i)
{
//??1,2
//???????,?????17?,pai_bg,xml
for,(j,=,0,;,j,<,itemList.size(),;,j++)
{
Element,gridNode,=,(Element)itemList.get(j),;
h,=,Integer.parseInt(gridNode.getAttributeValue("h")),;
if,(1,==,h)
{
if,(!ming.contains((new,Integer(h)).toString()))
{
//xmlNodeList.Item(1).ParentNode.RemoveChild(,xmlNodeList.Item(1))
//gridNode.ParentNode().removeChild(gridNode.),;
gridNode.getParentElement().removeContent(gridNode),;
n1++,;
}
},//end,if
if,(2,==,h)
{
if,(!ming.contains((new,Integer(h)).toString()))
{
//xmlNodeList.Item(1).ParentNode.RemoveChild(,xmlNodeList.Item(1))
//gridNode.ParentNode.RemoveChild(gridNode),;
gridNode.getParentElement().removeContent(gridNode),;
n2++,;
}
},//end,if
},//end,for
//?????????,
//?????
/*
if,(!ming.Contains("1"))
{
if,(chair.getUser().getId(),==,this.dizhu)
{
ele1,=,doc.CreateElement("item"),;
ele1.SetAttribute("n",,PokerName.BG_NONGMING),;
}
}*/
if,(!ming.contains("1"))
{
//ele1,=,doc.CreateElement("item"),;
ele1,=,new,Element("item"),;
if,(this.getdizhu().equals(this._chair.get(1).getUser().getId()),&&,!this.getdizhu().equals(""))
{
ele1.setAttribute("n",,PokerName.BG_DIZHU),;,//??
}
else,if,(this.nongming.contains(this._chair.get(1).getUser().getId()),&&,!this.nongming.equals(""))
{
ele1.setAttribute("n",,PokerName.BG_NONGMING),;
}
else
{
ele1.setAttribute("n",,PokerName.BG_NORMAL),;
}
ele1.setAttribute("h",,"1"),;
ele1.setAttribute("v",,(new,Integer(n1)).toString()),;,//v??count???
//doc.getDocumentElement().appendChild(ele1),;
doc.getDocumentElement().addContent(ele1),;
}
if,(!ming.contains("2"))
{
//ele2,=,doc.CreateElement("item"),;
ele2,=,new,Element("item"),;
if,(this.getdizhu().equals(this._chair.get(2).getUser().getId()),&&,!this.getdizhu().equals(""))
{
ele2.setAttribute("n",,PokerName.BG_DIZHU),;,//??
}
else,if,(this.nongming.contains(this._chair.get(2).getUser().getId()),&&,!this.nongming.equals(""))
{
ele2.setAttribute("n",,PokerName.BG_NONGMING),;
}
else
{
ele2.setAttribute("n",,PokerName.BG_NORMAL),;
}
ele2.setAttribute("h",,"2"),;
ele2.setAttribute("v",,(new,Integer(n2)).toString()),;,//v??count???
//doc.DocumentElement.AppendChild(ele2),;
doc.getDocumentElement().addContent(ele2),;
}
}
else,if,(1,==,i)
{
//??0,2
//???????,?????17?,pai_bg,xml
for,(j,=,0,;,j,<,itemList.size(),;,j++)
{
//XmlNode,gridNode,=,itemList.Item(j),;
Element,gridNode,=,(Element)itemList.get(j),;
h,=,Integer.parseInt(gridNode.getAttributeValue("h")),;
if,(0,==,h)
{
if,(!ming.contains((new,Integer(h)).toString()))
{
//gridNode.ParentNode.RemoveChild(gridNode),;
gridNode.getParentElement().removeContent(gridNode),;
n0++,;
}
}
if,(2,==,h)
{
if,(!ming.contains((new,Integer(h)).toString()))
{
//gridNode.ParentNode.RemoveChild(gridNode),;
gridNode.getParentElement().removeContent(gridNode),;
n2++,;
}
}
},//end,for
//?????
if,(!ming.contains("0"))
{
//ele0,=,doc.CreateElement("item"),;
ele0,=,new,Element("item"),;
if,(this.getdizhu().equals(this._chair.get(0).getUser().getId()),&&,!this.getdizhu().equals(""))
{
ele0.setAttribute("n",,PokerName.BG_DIZHU),;,//??
}
else,if,(this.nongming.contains(this._chair.get(0).getUser().getId()),&&,!this.nongming.equals(""))
{
ele0.setAttribute("n",,PokerName.BG_NONGMING),;
}
else
{
ele0.setAttribute("n",,PokerName.BG_NORMAL),;
}
ele0.setAttribute("h",,"0"),;
ele0.setAttribute("v",,(new,Integer(n0)).toString()),;,//v??count???
//doc.DocumentElement.AppendChild(ele0),;
doc.getDocumentElement().addContent(ele0),;
}
if,(!ming.contains("2"))
{
//ele2,=,doc.CreateElement("item"),;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
ele2,=,new,Element("item"),;
if,(this.getdizhu().equals(this._chair.get(2).getUser().getId()),&&,!this.getdizhu().equals(""))
{
ele2.setAttribute("n",,PokerName.BG_DIZHU),;,//??
}
else,if,(this.nongming.contains(this._chair.get(2).getUser().getId()),&&,!this.nongming.equals(""))
{
ele2.setAttribute("n",,PokerName.BG_NONGMING),;
}
else
{
ele2.setAttribute("n",,PokerName.BG_NORMAL),;
}
ele2.setAttribute("h",,"2"),;
ele2.setAttribute("v",,(new,Integer(n2)).toString()),;,//v??count???
//doc.DocumentElement.AppendChild(ele2),;
doc.getDocumentElement().addContent(ele2),;
}
}
else,if,(2,==,i)
{
//??0,1
//???????,?????17?,pai_bg,xml
for,(j,=,0,;,j,<,itemList.size(),;,j++)
{
//XmlNode,gridNode,=,itemList.Item(j),;
Element,gridNode,=,(Element)itemList.get(j),;
h,=,Integer.parseInt(gridNode.getAttributeValue("h")),;
if,(0,==,h)
{
if,(!ming.contains((new,Integer(h)).toString()))
{
//gridNode.ParentNode.RemoveChild(gridNode),;
gridNode.getParentElement().removeContent(gridNode),;
n0++,;
}
}
if,(1,==,h)
{
if,(!ming.contains((new,Integer(h)).toString()))
{
//gridNode.ParentNode.RemoveChild(gridNode),;
gridNode.getParentElement().removeContent(gridNode),;
n1++,;
}
}
},//end,for
//?????
if,(!ming.contains("0"))
{
//ele0,=,doc.CreateElement("item"),;
ele0,=,new,Element("item"),;
if,(this.getdizhu().equals(this._chair.get(0).getUser().getId()),&&,!this.getdizhu().equals(""))
{
ele0.setAttribute("n",,PokerName.BG_DIZHU),;,//??
}
else,if,(this.nongming.contains(this._chair.get(0).getUser().getId()),&&,!this.nongming.equals(""))
{
ele0.setAttribute("n",,PokerName.BG_NONGMING),;
}
else
{
ele0.setAttribute("n",,PokerName.BG_NORMAL),;
}
ele0.setAttribute("h",,"0"),;
ele0.setAttribute("v",,(new,Integer(n0)).toString()),;,//v??count???
//doc.DocumentElement.AppendChild(ele0),;
doc.getDocumentElement().addContent(ele0),;
}
if,(!ming.contains("1"))
{
//ele1,=,doc.CreateElement("item"),;
ele1,=,new,Element("item"),;
if,(this.getdizhu().equals(this._chair.get(1).getUser().getId()),&&,!this.getdizhu().equals(""))
{
ele1.setAttribute("n",,PokerName.BG_DIZHU),;,//??
}
else,if,(this.nongming.contains(this._chair.get(1).getUser().getId()),&&,!this.nongming.equals(""))
{
ele1.setAttribute("n",,PokerName.BG_NONGMING),;
}
else
{
ele1.setAttribute("n",,PokerName.BG_NORMAL),;
}
ele1.setAttribute("h",,"1"),;
ele1.setAttribute("v",,(new,Integer(n1)).toString()),;,//v??count???
//doc.DocumentElement.AppendChild(ele1),;
doc.getDocumentElement().addContent(ele1),;
}
}
break,;
},//end,if
},//end,for
return,doc.OuterXml(),;
}
/**,
@return,
*/
@Override
public,final,String,toXMLString()
{
StringBuilder,sb,=,new,StringBuilder(),;
sb.append("<room,id='"),;
sb.append((new,Integer(this._id)).toString()),;
sb.append("',tab='"),;
sb.append((new,Integer(this._tab)).toString()),;
sb.append("',name='"),;
sb.append(this._name),;
sb.append("',diG='"),;
sb.append(String.valueOf(this._diG)),;
sb.append("',carryG='"),;
sb.append(String.valueOf(this._carryG)),;
sb.append("',tabAutoMatchMode='"),;
sb.append((new,Integer(this._tabAutoMatchMode)).toString()),;
sb.append("',tabQuickRoomMode='"),;
sb.append((new,Integer(this._tabQuickRoomMode)).toString()),;
sb.append("'>"),;
//matchInfo,node
sb.append("<match,dizhu='"),;
sb.append(this.getdizhu()),;
sb.append("',nongming='"),;
sb.append(this.nongming),;
sb.append("',round='"),;
sb.append(String.valueOf(this._round.size())),;
sb.append("',turn='"),;,//????
//
sb.append(this.getturn()),;
//sb.Append(this.getTurn()),;
sb.append("',iswaitreconn='"),;
sb.append(AS3Util.convertBoolToAS3(this.isWaitReconnection())),;
sb.append("',difen='"),;
sb.append(this.difen),;
sb.append("',bomb='"),;
sb.append(this.bomb),;
sb.append("',win='"),;
sb.append(this.getWhoWin()),;
sb.append("'/>"),;
//?????,???????
if,(!this.getWhoWin().equals(""))
{
sb.append(getMatchResultXmlByRcContent()),;
}
//chair,node
for,(int,i,=,0,;,i,<,this._chair.size(),;,i++)
{
IChairModel,chair,=,this._chair.get(i),;
sb.append(chair.toXMLString()),;
}
//item,node
sb.append(this._board.toXMLString()),;
//round,node
StringBuilder,rb,=,new,StringBuilder(),;
java.util.HashMap<String,,String>,rd,=,new,java.util.HashMap<String,,String>(),;
for,(int,j,=,0,;,j,<,this._round.size(),;,j++)
{
this._round.get(j).setId(j,+,1),;
//----,??round?????,?????id??,???????,begin,---
String,rj,=,ByRound(rd,,j),;
//----,??round?????,?????id??,???????,end,---
rb.append(rj),;
}
_record.setId(_round.size(),+,1),;
String,rs,=,ByRecord(rd,,_record),;,//this._record.toXMLSting(),;
rb.append(rs),;
//meta,key,,rd.toXMLString()
rb.append("<roundMeta,"),;
//C#,TO,JAVA,CONVERTER,TODO,TASK:,There,is,no,equivalent,to,implicit,typing,in,Java:
for,(Entry,entry,:,rd.entrySet()),{
String,Key,=entry.getKey().toString(),;
String,Value=,entry.getValue().toString(),;
//rb.append(vrd.Key,+,"='",+,vrd.Value,+,"',"),;
rb.append(Key).append("='").append(Value).append("',"),;
}
rb.append("/>"),;
//
sb.append(rb.toString()),;
//
sb.append("</room>"),;
return,sb.toString(),;
}
/**
*,java?Math.floor???????
*,??????
*,@param,value
*,@return,
*/
public,String,Floor(double,value),
{
double,d,=,Math.floor(value),;
String,dStr,=,String.valueOf(d),;
if(dStr.indexOf("."),>,0)
{
return,dStr.substring(0,dStr.indexOf(".")),;
}
return,dStr,;,,,,,,,,
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.core.model.IUserModel,;
import,net.silverfoxserver.core.util.RandomUtil,;
import,net.silverfoxserver.DdzLogic_Toac,;
/**
*
*,@author,ACER-FX
*/
public,class,RoomModelByToac,{
/**,
	,
*/
private,IUserModel,_u,;
public,final,IUserModel,getUser()
{
return,_u,;
}
/**,
*/
private,String[],_pickResult,=,{"0",,"0",,"0"},;
/**,
winOrLost,fen,machine_pick
*/
public,final,String[],getpickResult()
{
return,_pickResult,;
}
/**,
@param,value
*/
public,RoomModelByToac(IUserModel,value)
{
_u,=,value.clone(),;
_pickResult,=,new,String[]{"0",,"0",,"0"},;
}
/**,
??2?,???3?
???????????
@param,selectInd_
@param,fen
@return,
*/
public,final,String[],pick_a_card(int,selectInd_,,long,jiaoFen)
{
//winOrLost,fen,machine_pick,your_pick,light
//string[],pickResult,=,{,"0",,"0",,"0",},;
_pickResult,=,new,String[],{"0",,"0",,"0",,"0","0"},;
//
java.util.Random,r,=,new,java.util.Random(RandomUtil.GetRandSeed()),;
int,machine_pick,=,r.nextInt(3),;
machine_pick++,;
int,light,=,r.nextInt(2),;
//
_pickResult[2],=,(new,Integer(machine_pick)).toString(),;
_pickResult[3],=,(new,Integer(selectInd_)).toString(),;
_pickResult[4],=,(new,Integer(light)).toString(),;
//
if,(selectInd_,==,machine_pick)
{
_pickResult[0],=,"1",;
//?????,=,??,;
if,(0,==,light)
{
_pickResult[1],=,String.valueOf(jiaoFen,*,1),;
}
else
{
_pickResult[1],=,String.valueOf(jiaoFen,*,2),;
}
}
else
{
_pickResult[0],=,"0",;
//?????,=,??,*,1
_pickResult[1],=,String.valueOf(jiaoFen,*,1),;
}
return,_pickResult,;
}
/**,
@param,n
@param,v
@return,
*/
public,final,String[],setVars(String,n,,String,v)
{
String[],setStatus,=,{"false",,"",,""},;
//
String[],sp,=,v.split("[,]",,-1),;
//selectInd
int,selectInd,=,Integer.parseInt(sp[1]),;
long,jiaoFen,=,Long.parseLong(sp[2]),;
//
if,(1,!=,selectInd,&&,2,!=,selectInd,&&,3,!=,selectInd)
{
setStatus[0],=,"false",;
setStatus[1],=,"<status>1</status>",;
return,setStatus,;
}
//
if,(DdzLogic_Toac.getg1(),!=,jiaoFen,&&,
DdzLogic_Toac.getg2(),!=,jiaoFen,&&,
DdzLogic_Toac.getg3(),!=,jiaoFen)
{
setStatus[0],=,"false",;
setStatus[1],=,"<status>2</status>",;
return,setStatus,;
}
//---------------------------------------------------
pick_a_card(selectInd,,jiaoFen),;
//
setStatus[0],=,"true",;
setStatus[1],=,_pickResult[0],+,",",+,_pickResult[1],+,",",+,_pickResult[2],;
return,setStatus,;
}
/**,
@return,
*/
public,final,String,toXMLString()
{
StringBuilder,sb,=,new,StringBuilder(),;
//
sb.append("<module>"),;
sb.append("<m,n='"),;
sb.append(DdzLogic_Toac.name),;
sb.append("'>"),;
sb.append("<pickResult>"),;
sb.append(getpickResult()[0]).append(",").append(getpickResult()[1]).append(",").append(getpickResult()[2]).append(",").append(getpickResult()[3]).append(",").append(getpickResult()[4]),;
sb.append("</pickResult>"),;
sb.append(getUser().toXMLString()),;
sb.append("</m>"),;
//
sb.append("</module>"),;
return,sb.toString(),;
}
/**,
@return,
*/
public,final,String,getMatchResultXmlByRc()
{
StringBuilder,sb,=,new,StringBuilder(),;
//
sb.append("<room,id='"),;
sb.append("-1"),;
sb.append("',name='"),;
sb.append("noname"),;
sb.append("',gamename='"),;
sb.append(DdzLogic_Toac.name),;
sb.append("'>"),;
//
double,tmpG,;
long,tmpG2,;
String,type,=,"",;
//
long,winG,=,Long.parseLong(getpickResult()[1]),;
//
if,(getpickResult()[0].equals("1"))
{
type,=,"add",;
//
tmpG,=,Math.floor(winG,*,DdzLogic_Toac.getcostG()),;
tmpG2,=,Long.parseLong((new,Double(tmpG)).toString()),;
winG,=,winG,-,tmpG2,;
//
//??????
sb.append("<action,type='add',id='"),;
sb.append(DdzLogic_Toac.getcostUid()),;
sb.append("',n='"),;
sb.append(DdzLogic_Toac.getcostUN()),;
sb.append("',g='"),;
sb.append((new,Long(tmpG2)).toString()),;
sb.append("'/>"),;
}
else
{
type,=,"sub",;
//????
//??????????????,??????
sb.append("<action,type='add',id='"),;
sb.append(DdzLogic_Toac.getcostUid()),;
sb.append("',n='"),;
sb.append(DdzLogic_Toac.getcostUN()),;
sb.append("',g='"),;
sb.append((new,Long(winG)).toString()),;
sb.append("'/>"),;
}
sb.append("<action,type='",+,type,+,"',id='"),;
sb.append(getUser().getId()),;
sb.append("',n='"),;
sb.append(getUser().getNickName()),;
sb.append("',g='"),;
sb.append((new,Long(winG)).toString()),;
sb.append("'/>"),;
//
sb.append("</room>"),;
return,sb.toString(),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*,????
wait,,->,can,start,,,,,->,start(jiao,fen)
start,->,can,get,dizhu,->,start,chu,pai
start,chu,pai,->,over
*,
*,@author,ACER-FX
*/
public,class,RoomStatusByDdz,{
/**,
????
*/
public,static,boolean,isWaitStart(String,value)
{
if,(value.indexOf("wait_start"),>,-1)
{
return,true,;
}
return,false,;
}
/**,
????
*/
public,static,final,String,GAME_WAIT_START,=,"game_wait_start",;
/**,
????
*/
public,static,final,String,GAME_ALL_READY_WAIT_START,=,"game_all_ready_wait_start",;
/**,
???????,????????
*/
public,static,final,String,GAMEOVER_ROOMCLEAR_WAIT_START,=,"gameover_roomclear_wait_start",;
/**,
?????????
*/
public,static,final,String,GAMEOVER_WAIT_START,=,"gameover_wait_start",;
/**,
@param,value
@return,
*/
public,static,boolean,isStart(String,value)
{
if,(value.indexOf("game_start"),>,-1)
{
return,true,;
}
return,false,;
}
/**,
??
???17??,?????
*/
public,static,final,String,GAME_START,=,"game_start",;
/**,
?????????,
????,????
*/
public,static,final,String,GAME_START_CAN_GET_DIZHU,=,"game_start_can_get_dizhu",;
/**,
??
*/
public,static,final,String,GAME_START_CHUPAI,=,"game_start_chupai",;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*,????
*,
*,@author,ACER-FX
*/
public,class,RoundModelByDdz,{
/**,
?????
*/
private,int,_id,;
public,final,int,getId()
{
return,_id,;
}
public,final,void,setId(int,value)
{
_id,=,value,;
}
/**,
????,??????
*/
public,volatile,String,type,;
//
public,volatile,String,clock_one,;
public,volatile,int,clock_one_jiaofen,;
public,volatile,String,clock_one_chupai,;
//
public,volatile,String,clock_two,;
public,volatile,int,clock_two_jiaofen,;
public,volatile,String,clock_two_chupai,;
//
public,volatile,String,clock_three,;
public,volatile,int,clock_three_jiaofen,;
public,volatile,String,clock_three_chupai,;
public,RoundModelByDdz(String,type)
{
//???????,???new??,?????reset??
clock_one,=,"",;
clock_one_jiaofen,=,-1,;
clock_one_chupai,=,"",;
//
clock_two,=,"",;
clock_two_jiaofen,=,-1,;
clock_two_chupai,=,"",;
//
clock_three,=,"",;
clock_three_jiaofen,=,-1,;
clock_three_chupai,=,"",;
//
this.type,=,type,;
}
public,final,boolean,isFull()
{
if,(clock_one.equals(""),||,clock_two.equals(""),||,clock_three.equals(""))
{
return,false,;
}
return,true,;
}
public,final,boolean,isEmpty()
{
if,(clock_one.equals(""),&&,clock_two.equals(""),&&,clock_three.equals(""))
{
return,true,;
}
return,false,;
}
public,final,void,setFen(int,fen,,String,userId)
{
if,(clock_one.equals(""))
{
clock_one,=,userId,;
clock_one_jiaofen,=,fen,;
return,;
}
else,if,(clock_two.equals(""))
{
clock_two,=,userId,;
clock_two_jiaofen,=,fen,;
return,;
}
else,if,(clock_three.equals(""))
{
clock_three,=,userId,;
clock_three_jiaofen,=,fen,;
return,;
}
throw,new,IllegalArgumentException("record,full!,do,you,forget,new,record?"),;
}
public,final,void,setPai(String,pai,,String,userId)
{
if,(clock_one.equals(""))
{
clock_one,=,userId,;
clock_one_chupai,=,pai,;
return,;
}
else,if,(clock_two.equals(""))
{
clock_two,=,userId,;
clock_two_chupai,=,pai,;
return,;
}
else,if,(clock_three.equals(""))
{
clock_three,=,userId,;
clock_three_chupai,=,pai,;
return,;
}
throw,new,IllegalArgumentException("record,full!,do,you,forget,new,record?"),;
}
public,final,String,toXMLSting()
{
StringBuilder,sb,=,new,StringBuilder(),;
sb.append("<round,id='"),;
sb.append(getId()),;
//
sb.append("',type='"),;
sb.append(type),;
//
sb.append("',ck_1='"),;
sb.append(this.clock_one.toString()),;
sb.append("',ck_1_jf='"),;
sb.append((new,Integer(this.clock_one_jiaofen)).toString()),;
sb.append("',ck_1_cp='"),;
sb.append(this.clock_one_chupai.toString()),;
//
sb.append("',ck_2='"),;
sb.append(this.clock_two.toString()),;
sb.append("',ck_2_jf='"),;
sb.append((new,Integer(this.clock_two_jiaofen)).toString()),;
sb.append("',ck_2_cp='"),;
sb.append(this.clock_two_chupai.toString()),;
//
sb.append("',ck_3='"),;
sb.append(this.clock_three.toString()),;
sb.append("',ck_3_jf='"),;
sb.append((new,Integer(this.clock_three_jiaofen)).toString()),;
sb.append("',ck_3_cp='"),;
sb.append(this.clock_three_chupai.toString()),;
sb.append("',/>"),;
return,sb.toString(),;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,ACER-FX
*/
public,class,RoundTypeByDdz,{
public,final,String,JIAO_FEN,=,"jiao_fen",;
public,final,String,CHU_PAI,=,"chu_pai",;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.core.model.IRuleModel,;
/**
*
*,@author,ACER-FX
*/
public,class,RuleModelByDdz,implements,IRuleModel{
/**,
????????
3??????
*/
private,final,int,_oneRoomChair,=,3,;
/**,
?????????
???,??,,,???
???,???,???
??,???,????3?
*/
private,final,int,_oneRoomLookChair,=,3,;
/**,
@return,
*/
public,final,int,getChairCount()
{
return,_oneRoomChair,;
}
/**,
@return,
*/
public,final,int,getLookChairCount()
{
return,_oneRoomLookChair,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
/**
*
*,@author,FUX
*/
public,class,RvarsStatus,{
public,static,final,int,Success0,=,0,;
/**
*,???????????,
*/
public,static,final,int,OnlyIsIapplyMy1,=,1,;
/**
*,?????
*/
public,static,final,int,NoCard2,=,2,;
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,net.silverfoxserver.core.model.ITabModel,;
/**
*
*,@author,ACER-FX
*/
public,class,TabModelByDdz,implements,ITabModel,{
/**,
????,??
??????tab,navigate,??
*/
private,int,_tab,;
public,final,int,getId()
{
return,_tab,;
}
public,final,int,getTab()
{
return,_tab,;
}
/**
*,
*,
*/
private,String,_tabName,;
public,final,String,getTabName()
{
return,_tabName,;
}
public,final,void,setTabName(String,value)
{
this._tabName,=,value,;
}
/**,
*/
private,int,_roomCount,;
public,final,int,getRoomCount()
{
return,this._roomCount,;
}
public,final,void,setRoomCount(int,value)
{
_roomCount,=,value,;
}
/**,
*/
private,int,_roomG,;
public,final,int,getRoomG()
{
return,this._roomG,;
}
public,final,void,setRoomG(int,value)
{
_roomG,=,value,;
}
/**,
*/
private,int,_roomCarryG,;
public,final,int,getRoomCarryG()
{
return,this._roomCarryG,;
}
public,final,void,setRoomCarryG(int,value)
{
_roomCarryG,=,value,;
}
/**,
*/
private,float,_roomCostG,;
public,final,float,getRoomCostG()
{
return,this._roomCostG,;
}
public,final,void,setRoomCostG(float,value)
{
_roomCostG,=,value,;
}
/**,
???????????
*/
private,int,_tabAutoMatchMode,;
public,final,boolean,getIsTabAutoMatchMode()
{
if,(0,==,this._tabAutoMatchMode)
{
return,false,;
}
return,true,;
}
public,final,void,setTabAutoMatchMode(int,tabAutoMatchMode)
{
this._tabAutoMatchMode,=,tabAutoMatchMode,;
}
/**,
*/
private,int,_tabQuickRoomMode,;
public,final,boolean,getIsTabQuickRoomMode()
{
if,(0,==,this._tabQuickRoomMode)
{
return,false,;
}
return,true,;
}
public,final,void,setQuickMode(int,value)
{
this._tabQuickRoomMode,=,value,;
}
/**,
*/
private,String[],_roomName,;
public,final,String[],getRoomName()
{
if,(null,==,_roomName)
{
_roomName,=,new,String[_roomCount],;
}
if,(_roomName.length,!=,_roomCount)
{
_roomName,=,new,String[_roomCount],;
}
return,_roomName,;
}
public,TabModelByDdz(int,tab_)
{
this._tab,=,tab_,;
}
public,final,int,getTabAutoMatchMode()
{
return,this._tabAutoMatchMode,;
}
public,final,int,getTabQuickRoomMode()
{
return,this._tabQuickRoomMode,;
}
@Override
public,final,String,toXMLString()
{
String,s,=,"<tab,id='",+,String.valueOf(this._tab),+,
"',n='",+,this._tabName,+,
"',dg='",+,String.valueOf(this._roomG),+,//?roomList??????
"',cg='",+,String.valueOf(this._roomCarryG),+,
"',tabAutoMatchMode='",+,String.valueOf(this._tabAutoMatchMode),+,
"',></tab>",;
return,s,;
}
}
/*
*,SilverFoxServer:,massive,multiplayer,game,server,for,Flash,,...
*,VERSION:3.0
*,PUBLISH,DATE:2015-9-2,
*,GITHUB:github.com/wdmir/521266750_qq_com
*,UPDATES,AND,DOCUMENTATION,AT:,http://www.silverfoxserver.net
*,COPYRIGHT,2009-2015,SilverFoxServer.NET.,All,rights,reserved.
*,MAIL:521266750@qq.com
*/
package,net.silverfoxserver.extmodel,;
import,java.time.LocalTime,;
import,net.silverfoxserver.core.model.EUserSex,;
import,net.silverfoxserver.core.model.IUserModel,;
/**
*
*,@author,ACER-FX
*/
public,class,UserModelByDdz,implements,IUserModel{
/**,
?????,????sessionList?userList
*/
private,String,_strIpPort,=,"",;
/**,
???xml????
*/
private,String,_id,=,"",;
/**,
????mssql??
getId?,return,,_id_sql??
*/
private,int,_id_sql,=,0,;
/**
*,
*/
private,int,_vip,=,0,;
public,final,int,getVIP()
{
return,this._vip,;
}
public,final,void,setVIP(int,value)
{
this._vip,=,value,;
}
/**,
???
*/
private,String,_accountName,=,"",;
/**,
??
*/
private,String,_nickName,=,"",;
/**,
?????
*/
private,String,_bbs,=,"",;
/**,
??
*/
private,String,_headIco,=,"",;
/**,
*/
private,String,_sex,=,EUserSex.NoBody,;
/**,
????????volatile
*/
private,volatile,int,_g,=,0,;
/**,
????????volatile
??
*/
private,volatile,int,_heartTime,=,-1,;
/**,
@param,id,????""
@param,id_sql,????0
@param,sex
@param,accountName
@param,nickName
*/
public,UserModelByDdz(String,strIpPort,,String,id,,int,id_sql,,String,sex,,String,accountName,,String,nickName,,String,bbs,,String,headIco)
{
this._strIpPort,=,strIpPort,;
this._id,=,id,;
this._id_sql,=,id_sql,;
this._sex,=,sex,;
this._accountName,=,accountName,;
this._nickName,=,nickName,;
this._g,=,0,;
this._bbs,=,bbs,;
if,(headIco.equals("null"))
{
headIco,=,"",;
}
this._headIco,=,headIco,;
this._heartTime,=,LocalTime.now().getMinute(),;//new,java.util.Date().Minute,;
}
/**,
????user,???????
????????????
*/
public,UserModelByDdz()
{
}
public,final,String,getStrIpPort()
{
return,this._strIpPort,;
}
public,final,String,getstrIpPort()
{
return,this._strIpPort,;
}
public,final,String,getId()
{
return,this._id,;
}
public,final,void,setId(String,id_)
{
this._id,=,id_,;
}
public,final,int,getId_SQL()
{
return,this._id_sql,;
}
public,final,void,setId_SQL(int,id_sql)
{
this._id_sql,=,id_sql,;
}
public,final,int,getG()
{
return,this._g,;
}
public,final,void,setG(int,g)
{
this._g,=,g,;
}
public,final,int,getHeartTime()
{
return,this._heartTime,;
}
public,final,void,setHeartTime(int,value)
{
this._heartTime,=,value,;
}