,,,,,,,,,,,,,,,,,,,
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
#!/usr/bin/env,python
#,ABAP,Markdown
#,(C),2015,-,Guilherme,Maeda
#
#,This,script,generates,the,ABAPUnit,test,classes,(for,unit,testing,the,ZMARKDOWN,class).
#,A,testing,class,is,created,for,each,pair,of,fixture,files,in,the,data,directory.
#
#,Based,on,the,Parsedown,parser,(parsedown.org).
from,os,import,listdir
from,os.path,import,isfile,,join
from,datetime,import,datetime
import,re
#######################################################################
#,,Functions
#######################################################################
#,Creates,ABAP,code,to,assign,content,to,a,variable
def,abap_set_variable_content(,varname,,content,):
#,Check,if,we,can,use,a,direct,assignment
if,content.find("\n"),<,0,and,len(content),<=,90:
return,varname,+,",=,'",+,content.replace("'",,"''"),+,"'."
#,Generate,the,concatenate,command,tokens
tokens,=,[,"concatenate",]
content_lines,=,content.splitlines()
for,line,in,content_lines:
#,break,long,lines,(>90)
chunks,=,[,line[i:i+90],for,i,in,range(0,len(line),90),]
tokens.extend([,"'{0}'".format(c.replace("'",,"''")).replace("\t",,"',%_HORIZONTAL_TAB,'")
for,c,in,chunks,])
tokens.append("%_NEWLINE")
tokens.pop()
tokens.extend([,"into",,varname,,"respecting",,"blanks",])
#,Put,the,tokens,together
code_lines,=,[]
line,=,""
for,token,in,tokens:
if,line,!=,"",and,len(line,+,token),>,90:
code_lines.append(line)
line,=,""
line,+=,token,+,","
line,+=,"."
code_lines.append(line)
return,"\n".join(code_lines)
#######################################################################
#,,Main,code
#######################################################################
#,List,all,the,markdown,files
data_path,=,"data"
md_files,=,[,f,for,f,in,listdir(data_path),if,f.endswith(".md"),]
#,Read,the,code,templates
class_template,=,open("template/zmarkdown_tests.abap").read()
method_template,=,open("template/zmarkdown_tests-method.abap").read()
#,Generate,the,ABAP,code
today,=,datetime.now().date()
method_names,=,[]
class_code,=,class_template.replace("[GENERATED_ON]",,today.isoformat())
method_implementations,=,[]
for,f,in,md_files:
method_name,=,re.sub(r"[-\s\.]",,"_",,f.replace(".md",,""))
method_names.append(method_name),
method_code,=,method_template.replace("[METHOD_NAME]",,method_name)
markdown,=,open("data/",+,f).read()
method_code,=,method_code.replace("[MARKDOWN_LINES]",,\
abap_set_variable_content("lv_markdown",,markdown))
html,=,open("data/",+,f.replace(".md",,".html")).read()
method_code,=,method_code.replace("[EXPECTED_MARKUP_LINES]",,\
abap_set_variable_content("lv_expected_markup",,html))
method_implementations.append(method_code)
class_code,=,class_code.replace("[METHOD_DEFINITIONS]",,\
",for,testing,\n,,,,,,".join(method_names),+,",for,testing.")
class_code,=,class_code.replace("[METHOD_IMPLEMENTATIONS]",,\
"\n\n".join(method_implementations))
#,Save,the,generated,code
with,open("zmarkdown_tests.abap",,"w"),as,f:
f.write(class_code)
print("ABAP,code,successfuly,generated.")
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,Player:
def,__init__(self,,name):
self.name,=,name
self.points,=,0
def,win_point(self):
self.points,+=,1
def,won_with(self,,other_player):
return,self.points,>=,4,and,other_player.points,>=,0,and,\
(self.points,-,other_player.points),>=,2
def,advantage_over(self,,other_player):
return,self.points,>,other_player.points,and,other_player.points,>=,3
class,Translator:
def,__init__(self):
pass
def,translate(self,,score_1,,score_2):
if,score_1,==,score_2,and,score_1,<,3:
return,self.score_to_word(score_1),+,"-All"
if,score_1,==,score_2,and,score_1,>,2:
return,"Deuce"
return,self.score_to_word(score_1),+,"-",+,self.score_to_word(score_2)
def,score_to_word(self,,score):
return,{
0:,"Love",
1:,"Fifteen",
2:,"Thirty",
3:,"Forty"
}[score]
class,TennisGame:
def,__init__(self,,player_1_name,,player_2_name):
self.player_1,=,Player(player_1_name)
self.player_2,=,Player(player_2_name)
self.translator,=,Translator()
def,won_point(self,,player_name):
if,player_name,==,self.player_1.name:
self.player_1.win_point()
else:
self.player_2.win_point()
def,score(self):
if,self.player_1.won_with(self.player_2):
return,"Win,for,",+,self.player_1.name
if,self.player_2.won_with(self.player_1):
return,"Win,for,",+,self.player_2.name
if,self.player_1.advantage_over(self.player_2):
return,"Advantage,",+,self.player_1.name
if,self.player_2.advantage_over(self.player_1):
return,"Advantage,",+,self.player_2.name
return,self.translator.translate(
self.player_1.points,
self.player_2.points)
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),
(4,,6,,'Win,for,player2',,'player1',,'player2'),
(16,,14,,'Win,for,player1',,'player1',,'player2'),
(14,,16,,'Win,for,player2',,'player1',,'player2'),
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main()
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
test_cases,=,[dict(p1Points=0,,p2Points=0,,score="Love-All"),
dict(p1Points=1,,p2Points=1,,score="Fifteen-All"),
dict(p1Points=2,,p2Points=2,,score="Thirty-All"),
dict(p1Points=3,,p2Points=3,,score="Deuce"),
dict(p1Points=4,,p2Points=4,,score="Deuce"),
dict(p1Points=1,,p2Points=0,,score="Fifteen-Love"),
dict(p1Points=0,,p2Points=1,,score="Love-Fifteen"),
dict(p1Points=2,,p2Points=0,,score="Thirty-Love"),
dict(p1Points=0,,p2Points=2,,score="Love-Thirty"),
dict(p1Points=3,,p2Points=0,,score="Forty-Love"),
dict(p1Points=0,,p2Points=3,,score="Love-Forty"),
dict(p1Points=4,,p2Points=0,,score="Win,for,player1"),
dict(p1Points=0,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=2,,p2Points=1,,score="Thirty-Fifteen"),
dict(p1Points=1,,p2Points=2,,score="Fifteen-Thirty"),
dict(p1Points=3,,p2Points=1,,score="Forty-Fifteen"),
dict(p1Points=1,,p2Points=3,,score="Fifteen-Forty"),
dict(p1Points=4,,p2Points=1,,score="Win,for,player1"),
dict(p1Points=1,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=3,,p2Points=2,,score="Forty-Thirty"),
dict(p1Points=2,,p2Points=3,,score="Thirty-Forty"),
dict(p1Points=4,,p2Points=2,,score="Win,for,player1"),
dict(p1Points=2,,p2Points=4,,score="Win,for,player2"),
dict(p1Points=4,,p2Points=3,,score="Advantage,player1"),
dict(p1Points=3,,p2Points=4,,score="Advantage,player2"),
dict(p1Points=5,,p2Points=4,,score="Advantage,player1"),
dict(p1Points=4,,p2Points=5,,score="Advantage,player2"),
dict(p1Points=15,,p2Points=14,,score="Advantage,player1"),
dict(p1Points=14,,p2Points=15,,score="Advantage,player2"),
dict(p1Points=6,,p2Points=4,,score="Win,for,player1"),
dict(p1Points=4,,p2Points=6,,score="Win,for,player2"),
dict(p1Points=16,,p2Points=14,,score="Win,for,player1"),
dict(p1Points=14,,p2Points=16,,score="Win,for,player2"),
]
def,create_testcase_dicts():
testcase_dicts,=,[]
for,test,in,test_cases:
cleaned,=,test["score"]
cleaned,=,cleaned.replace("-",,"")
cleaned,=,cleaned.replace(",",,"")
test["cleaned"],=,cleaned
test["testcase_name"],=,"%(cleaned)s_%(p1Points)s_%(p2Points)s",%,test
testcase_dicts.append(test)
return,testcase_dicts
testcase_dicts,=,create_testcase_dicts()
#,This,is,not,currently,being,used
gtest_template,=,"""\
TEST(TennisTest,,%(testcase_name)s),{
EXPECT_EQ("%(score)s",,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
template,=,"""\
void,test_%(testcase_name)s()
{
assert("%(score)s",==,tennis_score(%(p1Points)s,,%(p2Points)s)),;
}
"""
#,test,cases,for,all_tests.cpp
for,test,in,testcase_dicts:
print,template,%,test
#,test_suite.tests.cpp
for,test,in,testcase_dicts:
print,",,,,test_%(testcase_name)s,",%,test
#,all_tests.hpp
for,test,in,testcase_dicts:
print,"void,test_%(testcase_name)s(),;",%,test#,-*-,coding:,utf-8,-*-
class,TennisGame1:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.p1points,+=,1
else:
self.p2points,+=,1
def,score(self):
result,=,""
tempScore=0
if,(self.p1points==self.p2points):
result,=,{
0,:,"Love-All",
1,:,"Fifteen-All",
2,:,"Thirty-All",
}.get(self.p1points,,"Deuce")
elif,(self.p1points>=4,or,self.p2points>=4):
minusResult,=,self.p1points-self.p2points
if,(minusResult==1):
result,="Advantage,",+,self.player1Name
elif,(minusResult,==-1):
result,="Advantage,",+,self.player2Name
elif,(minusResult>=2):
result,=,"Win,for,",+,self.player1Name
else:
result,="Win,for,",+,self.player2Name
else:
for,i,in,range(1,3):
if,(i==1):
tempScore,=,self.p1points
else:
result+="-"
tempScore,=,self.p2points
result,+=,{
0,:,"Love",
1,:,"Fifteen",
2,:,"Thirty",
3,:,"Forty",
}[tempScore]
return,result
class,TennisGame2:
def,__init__(self,,player1Name,,player2Name):
self.player1Name,=,player1Name
self.player2Name,=,player2Name
self.p1points,=,0
self.p2points,=,0
def,won_point(self,,playerName):
if,playerName,==,self.player1Name:
self.P1Score()
else:
self.P2Score()
def,score(self):
result,=,""
if,(self.p1points,==,self.p2points,and,self.p1points,<,3):
if,(self.p1points==0):
result,=,"Love"
if,(self.p1points==1):
result,=,"Fifteen"
if,(self.p1points==2):
result,=,"Thirty"
result,+=,"-All"
if,(self.p1points==self.p2points,and,self.p1points>2):
result,=,"Deuce"
P1res,=,""
P2res,=,""
if,(self.p1points,>,0,and,self.p2points==0):
if,(self.p1points==1):
P1res,=,"Fifteen"
if,(self.p1points==2):
P1res,=,"Thirty"
if,(self.p1points==3):
P1res,=,"Forty"
P2res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p2points,>,0,and,self.p1points==0):
if,(self.p2points==1):
P2res,=,"Fifteen"
if,(self.p2points==2):
P2res,=,"Thirty"
if,(self.p2points==3):
P2res,=,"Forty"
P1res,=,"Love"
result,=,P1res,+,"-",+,P2res
if,(self.p1points>self.p2points,and,self.p1points,<,4):
if,(self.p1points==2):
P1res="Thirty"
if,(self.p1points==3):
P1res="Forty"
if,(self.p2points==1):
P2res="Fifteen"
if,(self.p2points==2):
P2res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p2points>self.p1points,and,self.p2points,<,4):
if,(self.p2points==2):
P2res="Thirty"
if,(self.p2points==3):
P2res="Forty"
if,(self.p1points==1):
P1res="Fifteen"
if,(self.p1points==2):
P1res="Thirty"
result,=,P1res,+,"-",+,P2res
if,(self.p1points,>,self.p2points,and,self.p2points,>=,3):
result,=,"Advantage,",+,self.player1Name
if,(self.p2points,>,self.p1points,and,self.p1points,>=,3):
result,=,"Advantage,",+,self.player2Name
if,(self.p1points>=4,and,self.p2points>=0,and,(self.p1points-self.p2points)>=2):
result,=,"Win,for,",+,self.player1Name
if,(self.p2points>=4,and,self.p1points>=0,and,(self.p2points-self.p1points)>=2):
result,=,"Win,for,",+,self.player2Name
return,result
def,SetP1Score(self,,number):
for,i,in,range(number):
self.P1Score()
def,SetP2Score(self,,number):
for,i,in,range(number):
self.P2Score()
def,P1Score(self):
self.p1points,+=1
def,P2Score(self):
self.p2points,+=1
class,TennisGame3:
def,__init__(self,,player1Name,,player2Name):
self.p1N,=,player1Name
self.p2N,=,player2Name
self.p1,=,0
self.p2,=,0
def,won_point(self,,n):
if,n,==,self.p1N:
self.p1,+=,1
else:
self.p2,+=,1
def,score(self):
if,(self.p1,<,4,and,self.p2,<,4),and,(self.p1,+,self.p2,<,6):
p,=,["Love",,"Fifteen",,"Thirty",,"Forty"]
s,=,p[self.p1]
return,s,+,"-All",if,(self.p1,==,self.p2),else,s,+,"-",+,p[self.p2]
else:
if,(self.p1,==,self.p2):
return,"Deuce"
s,=,self.p1N,if,self.p1,>,self.p2,else,self.p2N
return,"Advantage,",+,s,if,((self.p1-self.p2)*(self.p1-self.p2),==,1),else,"Win,for,",+,s
#,-*-,coding:,utf-8,-*-
import,pytest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
from,tennis_unittest,import,test_cases,,play_game
class,TestTennis:
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game1(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game2(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
@pytest.mark.parametrize('p1Points,p2Points,score,p1Name,p2Name'.split(),,test_cases)
def,test_get_score_game3(self,,p1Points,,p2Points,,score,,p1Name,,p2Name):
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
assert,score,==,game.score()
#,-*-,coding:,utf-8,-*-
import,unittest
from,tennis,import,TennisGame1,,TennisGame2,,TennisGame3
test_cases,=,[
(0,,0,,"Love-All",,'player1',,'player2'),
(1,,1,,"Fifteen-All",,'player1',,'player2'),
(2,,2,,"Thirty-All",,'player1',,'player2'),
(3,,3,,"Deuce",,'player1',,'player2'),
(4,,4,,"Deuce",,'player1',,'player2'),
(1,,0,,"Fifteen-Love",,'player1',,'player2'),
(0,,1,,"Love-Fifteen",,'player1',,'player2'),
(2,,0,,"Thirty-Love",,'player1',,'player2'),
(0,,2,,"Love-Thirty",,'player1',,'player2'),
(3,,0,,"Forty-Love",,'player1',,'player2'),
(0,,3,,"Love-Forty",,'player1',,'player2'),
(4,,0,,"Win,for,player1",,'player1',,'player2'),
(0,,4,,"Win,for,player2",,'player1',,'player2'),
(2,,1,,"Thirty-Fifteen",,'player1',,'player2'),
(1,,2,,"Fifteen-Thirty",,'player1',,'player2'),
(3,,1,,"Forty-Fifteen",,'player1',,'player2'),
(1,,3,,"Fifteen-Forty",,'player1',,'player2'),
(4,,1,,"Win,for,player1",,'player1',,'player2'),
(1,,4,,"Win,for,player2",,'player1',,'player2'),
(3,,2,,"Forty-Thirty",,'player1',,'player2'),
(2,,3,,"Thirty-Forty",,'player1',,'player2'),
(4,,2,,"Win,for,player1",,'player1',,'player2'),
(2,,4,,"Win,for,player2",,'player1',,'player2'),
(4,,3,,"Advantage,player1",,'player1',,'player2'),
(3,,4,,"Advantage,player2",,'player1',,'player2'),
(5,,4,,"Advantage,player1",,'player1',,'player2'),
(4,,5,,"Advantage,player2",,'player1',,'player2'),
(15,,14,,"Advantage,player1",,'player1',,'player2'),
(14,,15,,"Advantage,player2",,'player1',,'player2'),
(6,,4,,'Win,for,player1',,'player1',,'player2'),,
(4,,6,,'Win,for,player2',,'player1',,'player2'),,
(16,,14,,'Win,for,player1',,'player1',,'player2'),,
(14,,16,,'Win,for,player2',,'player1',,'player2'),,
(6,,4,,'Win,for,One',,'One',,'player2'),
(4,,6,,'Win,for,Two',,'player1',,'Two'),,
(6,,5,,'Advantage,One',,'One',,'player2'),
(5,,6,,'Advantage,Two',,'player1',,'Two'),,
]
def,play_game(TennisGame,,p1Points,,p2Points,,p1Name,,p2Name):
game,=,TennisGame(p1Name,,p2Name)
for,i,in,range(max(p1Points,,p2Points)):
if,i,<,p1Points:
game.won_point(p1Name)
if,i,<,p2Points:
game.won_point(p2Name)
return,game
class,TestTennis(unittest.TestCase):
def,test_Score_Game1(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame1,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game2(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame2,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
def,test_Score_Game3(self):
for,testcase,in,test_cases:
(p1Points,,p2Points,,score,,p1Name,,p2Name),=,testcase
game,=,play_game(TennisGame3,,p1Points,,p2Points,,p1Name,,p2Name)
self.assertEqual(score,,game.score())
if,__name__,==,"__main__":
unittest.main(),
#!/usr/bin/python
import,os,,sys
import,commands
from,xml.dom,import,minidom
#--------------------------------------
BASE_PATH,=,os.path.join(os.path.dirname(__file__),,'asset_library')
ASSET_BASE,=,'/../data/'
ASSET_XML_FILE,=,os.path.join(BASE_PATH,,'../data/assets.xml')
OUTPUT_FILENAME,=,os.path.join(BASE_PATH,,'AssetLibrary.as')
#--------------------------------------
def,main():
sys.stdout.write("building,assets\n")
build_assets()
sys.stdout.write("compiling,swf\n")
build_swf()
def,build_assets():
"""
Build,the,'AssetLibrary',class,file.
"""
#,only,process,if,the,output,file,is,older,than,the,input,xml
if,os.path.exists(OUTPUT_FILENAME):
if,os.path.getmtime(OUTPUT_FILENAME),>,os.path.getmtime(ASSET_XML_FILE):
sys.stdout.write("assets,already,up-to-date\n")
return
#,templates
template,=,open(os.path.join(BASE_PATH,,'AssetLibrary.as.template'),,'r').read()
embed_templates,=,{
'image':,"[Embed(source='%(asset_path)s')],private,var,%(asset_class_name)s:Class,;\n",
'mp3':,"[Embed(source='%(asset_path)s')],private,var,%(asset_class_name)s:Class,;\n",
'xml':,"[Embed(source='%(asset_path)s',,mimeType=\"application/octet-stream\")],private,var,%(asset_class_name)s:Class,;\n"
}
library_element_template,=,"'%(asset_id)s':,%(asset_class_name)s"
#,load+parse,asset,xml
complete_asset_embed_code,=,""
complete_asset_data_code,=,""
asset_dom,=,minidom.parse(ASSET_XML_FILE)
asset_nodes,=,list(asset_dom.getElementsByTagName('asset'))
for,asset_node,in,asset_nodes:
asset_attrs,=,dict(asset_node.attributes.items())
asset_embed_code,=,embed_templates[asset_attrs['type']],%,{
'asset_class_name':,asset_attrs['name'],
'asset_path':,ASSET_BASE,+,asset_attrs['file']
}
complete_asset_embed_code,+=,asset_embed_code
asset_data_code,=,library_element_template,%,{
'asset_id':,asset_attrs['name'],
'asset_class_name':,asset_attrs['name']
}
complete_asset_data_code,+=,asset_data_code
if,asset_nodes.index(asset_node),==,len(asset_nodes),-,1:
complete_asset_data_code,+=,"\n"
else:
complete_asset_data_code,+=,",\n"
#,load+parse,map,files,from,the,'world',object,in,the,game,xml
output,=,template,%,{
'asset_embeds':,complete_asset_embed_code,
'asset_data':,complete_asset_data_code
}
#,render
output_f,=,open(OUTPUT_FILENAME,,'w')
output_f.write(output)
def,build_swf():
if,os.name,==,'posix':
build_command,=,"mxmlc,src/california/Main.as,-source-path=src/,-source-path=asset_library/,-output,output/AHouseInCalifornia.swf,-static-link-runtime-shared-libraries,-default-size,640,340,&&,flashplayer_10,output/AHouseInCalifornia.swf"
elif,os.name,==,'nt':
build_command,=,'mxmlc.exe,src/california/Main.as,-source-path=src/,-output,output/AHouseInCalifornia.swf,-static-link-runtime-shared-libraries,-default-size,640,440,&&,/c/flex4/runtimes/player/10/win/FlashPlayer.exe,output/AHouseInCalifornia.swf'
else:
print,"no,build,command,found,for,OS,",,os.name
return
sys.stdout.write(commands.getoutput(build_command))
print,""
if,__name__,==,'__main__':
main()
"""
Compile,levels,from,tiled's,TMX,format,into,a,JSON,document
with,the,level's,tiles,already,processed,into,a,comma-separated
list,for,flixel.
"""
from,xml.dom,import,minidom
import,simplejson
import,os
SRC_DIR,=,os.path.join(os.path.abspath(os.path.dirname(__file__)),,'../data/')
def,tmx_to_json(source_path,,output_path):
dom,=,minidom.parse(source_path)
#,this,loads,in,the,base,map,element,properties:,width,,height,,tilesize
map_data,=,dict(dom.getElementsByTagName('map')[0].attributes.items())
for,map_prop,in,dom.getElementsByTagName('property'):
map_prop_dict,=,dict(map_prop.attributes.items())
map_data[map_prop_dict['name']],=,map_prop_dict['value']
map_data['layers'],=,[]
for,layer,in,dom.getElementsByTagName('layer'):
layer_dict,=,dict(layer.attributes.items())
width,=,int(layer_dict['width'])
layer_dict['tiles'],=,""
for,i,,tile,in,enumerate(layer.getElementsByTagName('tile')):
gid,=,int(tile.getAttribute('gid'))
#,adjust,for,tiled's,gid,system
if,gid,>,0:
gid,-=,1
layer_dict['tiles'],+=,str(gid)
if,i,>,0,and,i,%,width,==,width,-,1:
layer_dict['tiles'],+=,"\n"
else:
layer_dict['tiles'],+=,","
map_data['layers'].append(layer_dict)
if,os.path.exists(output_path):
os.remove(output_path)
f,=,open(output_path,'w')
f.write(simplejson.dumps(map_data))
f.close()
print,"wrote",,output_path
def,main():
for,filename,in,os.listdir(SRC_DIR):
if,not,filename.endswith('tmx'):
continue
source_path,=,os.path.abspath(os.path.join(SRC_DIR,filename))
output_filename,=,filename.replace('tmx','json')
output_path,=,os.path.abspath(os.path.join(SRC_DIR,output_filename))
#,check,if,an,output,file,already,exists,and,is,newer,than
#,the,source,file,,in,which,case,no,need,to,recompile
if,os.path.exists(output_path):
if,os.path.getmtime(output_path),>,os.path.getmtime(source_path):
print,"--%s,up,to,date",%,output_filename
continue
tmx_to_json(source_path,,output_path)
if,__name__,==,'__main__':
main()
#,Actionscript,3.0,Obfuscator
#
#,Copyright,(c),2008,Erik,Johnson,(shapedbyregret@gmail.com)
#
#,This,program,is,free,software:,you,can,redistribute,it,and/or,modify
#,it,under,the,terms,of,the,GNU,General,Public,License,as,published,by
#,the,Free,Software,Foundation,,either,version,3,of,the,License,,or
#,(at,your,option),any,later,version.
#
#,This,program,is,distributed,in,the,hope,that,it,will,be,useful,
#,but,WITHOUT,ANY,WARRANTY,;,without,even,the,implied,warranty,of
#,MERCHANTABILITY,or,FITNESS,FOR,A,PARTICULAR,PURPOSE.,,See,the
#,GNU,General,Public,License,for,more,details.
#
#,You,should,have,received,a,copy,of,the,GNU,General,Public,License
#,along,with,this,program.,,If,not,,see,<http://www.gnu.org/licenses/>.
#========================================
#,Import,modules
#
#========================================
import,os
import,re
import,random
import,string
import,sys
#========================================
#,Options
#
#========================================
removeComments,=,True
changeVarName,=,True
encodeStrings,=,True
#,Following,options,should,not,be,changed.
#,They,are,either,incomplete,or,incorrectly,implemented.
removeWhitespace,=,False
changeFileName,=,True
#========================================
#,Declare,Variables
#
#========================================
blockCommentFound,=,False
varDeclareFound,=,False
varsFound,=,[]
varsNew,=,[]
varLength,=,5
varCharSet,=,string.ascii_uppercase,+,string.ascii_lowercase,+,string.digits
#========================================
#,Function,declarations
#
#========================================
#========================================
#,strip_white_space(String)
#,First,replaces,each,newline,with,an,empty,string,,then,splits,at,each
#,tab,,and,then,joins,it,all,back,together,before,returning.
def,strip_white_space(someText):
tmpLine,=,someText.replace("\n",,"",,1)
tmpList,=,tmpLine.split("\t")
tmpLine,=,"".join(["%s",%,k,for,k,in,tmpList])
return,tmpLine
#========================================
#,string_to_hex(String)
#,Iterates,over,each,character,in,oldString,and,converts,it,first,to,an
#,int,,and,then,to,a,hex,string.,All,"0",chars,are,replaced,with,"\"
#,and,added,to,newString.
def,string_to_hex(oldString):
newString,=,""
for,char,in,oldString:
tmpString,=,hex(ord(char))
tmpString,=,tmpString.replace("0",,"\\",,1)
newString,+=,tmpString
return,newString
#========================================
#,Handle,arguments
#
#========================================
#,Check,if,arguments,given
if,len(sys.argv)>1:
filePath,=,sys.argv[1]
fullFileName,=,os.path.split(filePath)[1]
fileName,=,fullFileName.rsplit(".",,1)[0]
if,len(sys.argv)>2:
newFilePath,=,sys.argv[2]
newFullFileName,=,newFilePath.rsplit("/",,1)[1]
newFileName,=,newFullFileName.rsplit(".",,1)[0]
else:
#,Create,new,file,path
tmpList,=,filePath.rsplit(".",,1)
if,len(tmpList)>1:,#,Check,if,there,is,a,file,extension
newFilePath,=,tmpList[0],+,"_Obfs.",+,tmpList[1]
else:
newFilePath,=,fileName,+,"_Obfs"
#,Create,new,file,name
tmpList,=,fullFileName.rsplit(".",,1)
if,len(tmpList)>1:
newFullFileName,=,tmpList[0],+,"_Obfs.",+,tmpList[1]
else:
newFullFileName,=,fileName,+,"_Obfs"
newFileName,=,fileName,+,"_Obfs"
else:
print,"Filename,not,provided."
exit()
#========================================
#,Open,File
#
#========================================
fileToChange,=,open(filePath,,"r")
listLines,=,fileToChange.readlines(),#,Store,fileToChange,to,memory,in,a,list
fileToChange.close(),#,Close,file
#========================================
#,Iterate,over,file,,one,line,at,a,time
#
#========================================
linenum,=,0
for,line,in,listLines:
newLine,=,line
#========================================
#,Remove,comments
if,removeComments:
	
#========================================
#,Remove,and,delete,all,inline,block,comments
#,Replaces,everything,between,"/*",and,"*/",with,an,empty,string.
tmpLine,=,re.sub(r"(/\*).*?(\*/)",,"",,newLine)
if,tmpLine,!=,"":
newLine,=,tmpLine
#========================================
#,Remove,all,other,block,comments.
#,Attempts,to,find,beginning,of,block,comment,statement.
if,newLine.find("/*"),!=,-1:
blockCommentFound,=,True
#,If,we,find,the,end,of,the,block,comment,,then,we,will,store
#,everything,past,it,,otherwise,simply,replace,entire,line,with
#,a,newline,,which,helps,to,preserve,code,structure.
if,blockCommentFound:
if,newLine.find("*/"),!=,-1:
tmpLine,=,newLine.rsplit("*/")
newLine,=,tmpLine[1]
blockCommentFound,=,False
else:
newLine,=,"%s",%,os.linesep
#========================================
#,Remove,single,line,comments,i.e.,all,text,following,"//"
#,Find,last,instance,of,"//",and,determine,if,it,is,after,semicolon.
#,If,so,then,it,is,safe,to,delete.,Which,we,do,by,splitting,at,the
#,last,instance,of,found,"//",,appending,a,"\n",or,"\r",and,storing,it.
#,Note:,The,following,relies,on,the,assumption,that,the,code,being
#,,,,,,,read,uses,semicolons,to,end,statements.
tmpLine,=,re.sub("//(?<=//)[^%s]*",%,os.linesep,,"",,newLine)
if,tmpLine,!=,"":
newLine,=,tmpLine
#========================================
#,Collect,variable,names
if,changeVarName:
tmpList,=,[]
#,Determine,if,any,of,the,keywords,were,found,in,newLine.
keys,=,['var',,'function',,'const']
if,any(x,in,newLine,for,x,in,keys):
varDeclareFound,=,True
#,If,"function",was,found,,then,we,make,a,list,of,all,words,preceding
#,a,":",or,"(".,Otherwise,only,store,words,preceding,":".
#,After,we've,found,our,words,we,add,them,to,varsFound,and,create,a
#,jumbled,replacement,name,for,each,one.
if,varDeclareFound:
tmpList,=,re.findall("(?<=var.)\w+|(?<=function.)\w+|(?<=const.)\w+",,newLine)
for,tmpLine,in,tmpList:
#,Skip,over,constructor,name
if,tmpLine.find(fileName),==,-1:
varsFound.append(tmpLine)
				
#,Create,new,variable,name.
#,Keep,searching,until,find,a,unique,name,consisting,of,an
#,underscore,preceding,a,random,number,from,1-5000.
newVarName,=,""
foundNewName,=,False
while,not,foundNewName:
#newVarName,=,"_",+,str(random.randrange(1,5000))
newVarName,=,"_"
newVarName,+=,"".join(random.choice(varCharSet),for,x,in,range(varLength))
if,newVarName,not,in,varsNew:
foundNewName,=,True
varsNew.append(newVarName)
#,Reached,a,semicolon,or,open,bracket,and,presumably,end,of
#,var/function/const,declaration.
if,newLine.find(",;"),!=,-1,or,newLine.find("{"),!=,-1:
varDeclareFound,=,False
#========================================
#,Encode,strings
#,Iterates,over,each,character,in,string,until,a,single,or,double
#,quote,is,found.,If,quote,has,not,been,escaped,,then,convert
#,following,chars,to,their,hex,string,equivalent,until,another,quote
#,is,found.
if,encodeStrings:
tmpLine,=,""
inSingleQuote,=,False
inDoubleQuote,=,False
for,x,in,range(0,,len(newLine)):
if,newLine[x]=="\"",and,not,inSingleQuote:
if,x>0,and,newLine[x-1]!="\\":
if,inDoubleQuote:
inDoubleQuote,=,False
else:
inDoubleQuote,=,True
tmpLine,+=,newLine[x]
else:
tmpLine,+=,string_to_hex(,newLine[x],)
elif,newLine[x]=="\'",and,not,inDoubleQuote:
if,x>0,and,newLine[x-1]!="\\":
if,inSingleQuote:
inSingleQuote,=,False
else:
inSingleQuote,=,True
tmpLine,+=,newLine[x]
else:
tmpLine,+=,string_to_hex(,newLine[x],)
else:
if,inDoubleQuote,or,inSingleQuote:
tmpLine,+=,string_to_hex(,newLine[x],)
else:
tmpLine,+=,newLine[x]
			
newLine,=,tmpLine
#========================================
#,Remove,newlines,and,tabs
if,removeWhitespace:
newLine,=,strip_white_space(newLine)
#========================================
#,Change,constructor,to,match,new,file,name
if,changeFileName:
tmpLine,=,re.sub(fileName,,newFileName,,newLine)
if,tmpLine,!=,"":
newLine,=,tmpLine
#========================================
#,Replace,line
listLines[linenum],=,newLine
linenum,+=,1
#========================================
#,Change,Variable,names
#,Iterates,over,file,again,and,attempts,to,replace,all,instances,of
#,variables,previously,found.
#,TODO:,Find,less,expensive,way,to,implement.
if,changeVarName:
for,line,in,listLines:
newLine,=,line	
#,Attempt,to,find,import,at,beginning,of,line
tmpLine,=,strip_white_space(newLine)
tmpIndex,=,tmpLine.find("import")
if,tmpIndex,!=,0:
for,j,in,range(0,,len(varsFound)):
newLine,=,re.sub(r"\b"+varsFound[j]+r"\b",,varsNew[j],,newLine)
lineIndex,=,listLines.index(line)
listLines.remove(line)
listLines.insert(lineIndex,,newLine)
#========================================
#,Write,to,file
#
#========================================
if,changeFileName:
fileToWrite,=,open(newFilePath,,"w")
else:
fileToWrite,=,open(filePath,,"w")
for,line,in,listLines:
fileToWrite.write(line)
#,Close,file,after,writing
fileToWrite.close()
#!,/usr/bin/env,python
#,coding:,utf-8
"""
Adds,the,correct,license,headers,to,hydrax,source,files.
"""
import,os
import,sys
root,=,"/Users/dion/storage/projects/hydrax"
fileList,=,[]#"/Users/dion/storage/projects/hydrax/src/test.hx"]
filesAccountedFor,=,[]
rootdir,=,root,+,"/src"
for,root,,subFolders,,files,in,os.walk(rootdir):
	for,file,in,files:
		if,file.endswith(".hx"):
			fileList.append(os.path.join(root,file))
#,print,fileList
headers,=,{}
licensedFiles,=,{}
licensedFiles["pbe"],=,["com.pblabs.engine.core.PBContext",,,"com.pblabs.engine.core.Entity",,,"com.pblabs.engine.core.EntityComponent",,,"com.pblabs.engine.core.IEntity",,,"com.pblabs.engine.core.IEntityComponent",,"com.pblabs.engine.core.IPBContext",,,"com.pblabs.engine.core.IPBManager",,,"com.pblabs.engine.core.IPBObject",,,"com.pblabs.engine.core.IPropertyBag",,,"com.pblabs.engine.core.NameManager",,,"com.pblabs.engine.core.PBGame",,,"com.pblabs.engine.core.PBGame",,,"com.pblabs.engine.core.PBGroup",,,"com.pblabs.engine.core.PBObject",,,"com.pblabs.engine.core.PBSet",,,"com.pblabs.engine.core.PropertyReference",,,"com.pblabs.engine.debug.Profiler",,,"com.pblabs.engine.input.InputKey",,,"com.pblabs.engine.resource.flash.DataResource",,,"com.pblabs.engine.resource.flash.ImageResource",,,"com.pblabs.engine.resource.flash.MP3Resource",,,"com.pblabs.engine.resource.flash.Resource",,,"com.pblabs.engine.resource.flash.ResourceBundle",,,"com.pblabs.engine.resource.flash.ResourceEvent",,,"com.pblabs.engine.resource.flash.ResourceManager",,,"com.pblabs.engine.resource.flash.SoundResource",,,"com.pblabs.engine.resource.flash.SWFResource",,,"com.pblabs.engine.resource.flash.XMLResource",,,"com.pblabs.engine.resource.flash.provider.BulkLoaderResourceProvider",,,"com.pblabs.engine.resource.flash.provider.EmbeddedResourceProvider",,,"com.pblabs.engine.resource.flash.provider.FallbackResourceProvider",,,"com.pblabs.engine.resource.flash.provider.IResourceProvider",,,"com.pblabs.engine.resource.flash.provider.ResourceProviderBase",,,"com.pblabs.engine.serialization.ISerializable",,,"com.pblabs.engine.serialization.LevelContext",,,"com.pblabs.engine.serialization.SchemaGenerator",,,"com.pblabs.engine.serialization.Serializer",,,"com.pblabs.engine.serialization.TemplateEvent",,,"com.pblabs.engine.serialization.TemplateManager",,,"com.pblabs.engine.serialization.TestForMetadata",,,"com.pblabs.engine.serialization.TypeUtility",,,"com.pblabs.engine.time.IAnimatedObject",,,"com.pblabs.engine.time.IProcessManager",,,"com.pblabs.engine.time.IQueuedObject",,,"com.pblabs.engine.time.ITickedObject",,,"com.pblabs.engine.time.ProcessManager",,,"com.pblabs.engine.time.ScheduleObject",,,"com.pblabs.engine.time.ThinkingComponent",,,,"com.pblabs.engine.time.Timer",,,"com.pblabs.engine.util.IPrioritizable",,"com.pblabs.components.spatial.ISpatialManager2D",,"com.pblabs.components.spatial.ISpatialObject2D",,"com.pblabs.components.spatial.RayHitInfo",,"com.pblabs.engine.core.ObjectType",,"com.pblabs.engine.core.ObjectTypeManager",,]
licensedFiles["flashbang"],=,["com.pblabs.components.tasks.FunctionTask",,,"com.pblabs.components.tasks.GoToFrameTask",,,"com.pblabs.components.tasks.LocationTask",,,"com.pblabs.components.tasks.ParallelTask",,,"com.pblabs.components.tasks.RepeatingTask",,,"com.pblabs.components.tasks.SelfDestructTask",,,"com.pblabs.components.tasks.SerialTask",,,"com.pblabs.components.tasks.TaskContainer",,,"com.pblabs.components.tasks.TimedTask",,,"com.pblabs.components.tasks.VisibleTask",,,"org.transition9.util.Rand"]
licensedFiles["aspirin"],=,["org.transition9.ds.maps.MapBuilder",,"org.transition9.util.Random",,"org.transition9.util.Comparable",,,"org.transition9.util.Comparators",,,"org.transition9.util.Equalable",,,,"org.transition9.util.LogTarget",,,"org.transition9.util.Predicates",,"org.transition9.util.StringUtil",,"org.transition9.ds.maps.DefaultValueMap",,,"org.transition9.ds.maps.ExpiringEntry",,,"org.transition9.ds.maps.ExpiringMap",,,"org.transition9.ds.maps.ForeachingMap",,,"org.transition9.ds.maps.LinkedEntry",,,"org.transition9.ds.maps.LinkedMap",,,"org.transition9.ds.maps.LRMap",,,"org.transition9.ds.maps.ValueComputingMap"]
licensedFiles["non_derived"],=,["org.transition9.util.Log",,"org.transition9.util.MetaUtil",,"com.pblabs.components.scene2D.SceneUtil",,"AllClasses",,"com.pblabs.components.base.AlphaComponent",,,"com.pblabs.components.base.AngleComponent",,,"com.pblabs.components.base.BoundedComponent",,,"com.pblabs.components.base.DisplayComponent",,,"com.pblabs.components.base.HealthComponent",,,"com.pblabs.components.base.LocationComponent",,,"com.pblabs.components.base.NotifyingValueComponent",,,"com.pblabs.components.debug.BlobDisplayComponent",,,"com.pblabs.components.debug.RectDisplayComponent",,,"com.pblabs.components.debug.ValueComponent",,,"com.pblabs.components.manager.NodeComponent",,"com.pblabs.components.scene2D.SceneComponent",,"com.pblabs.components.scene2D.SceneManager",,,"com.pblabs.components.scene2D.SceneAlignment",,,"com.pblabs.components.scene2D.SceneLayer",,,"com.pblabs.components.scene2D.SceneLayerYOrdering",,,"com.pblabs.components.scene2D.SceneView",,,"com.pblabs.components.scene2D.js.SceneComponent",,,"com.pblabs.components.scene2D.js.SceneLayer",,,"com.pblabs.components.scene2D.js.SceneManager",,,"com.pblabs.components.scene2D.js.CircleSprite",,,"com.pblabs.components.scene2D.js.FilledSprite",,,"com.pblabs.components.scene2D.js.ImageSprite",,"com.pblabs.components.tasks.AngleTask",,,"com.pblabs.components.tasks.AnimatePropertyTask",,,"com.pblabs.components.tasks.AnimateValueTask",,,"com.pblabs.components.tasks.DelayTicksTask",,,"com.pblabs.components.tasks.IEntityTask",,,"com.pblabs.components.tasks.InterpolatingTask",,,"com.pblabs.components.tasks.TaskComponent",,,"com.pblabs.components.tasks.TaskUtil",,,"com.pblabs.components.ui.BarDisplayComponent",,,"com.pblabs.components.input.MouseInputComponent",,,"com.pblabs.components.util.DataComponent",,,"com.pblabs.engine.core.IPBGroup",,,"com.pblabs.engine.core.SetManager",,,"com.pblabs.engine.core.SignalBondManager",,,"com.pblabs.engine.debug.Log",,,"com.pblabs.components.input.InputManager",,,"com.pblabs.engine.resource.IResource",,,"com.pblabs.engine.resource.IResourceManager",,,"com.pblabs.engine.resource.ResourcesBase",,,"com.pblabs.engine.resource.ResourceManager",,,"com.pblabs.engine.resource.XMLResource",,,"com.pblabs.engine.injection.Attributes",,,"com.pblabs.engine.injection.ComponentInjector",,,"com.pblabs.engine.injection.Injector",,,"com.pblabs.engine.resource.flash.RessyResource",,,"com.pblabs.engine.resource.js.ImageResources",,"com.pblabs.engine.util.PBUtil",,,,"org.transition9.geom.Circle",,,"org.transition9.geom.CircleUtil",,,"org.transition9.geom.Geometry",,,"org.transition9.geom.LineSegment",,,"org.transition9.geom.LineSegmentTools",,,"org.transition9.geom.Polygon",,,"org.transition9.geom.PolygonTools",,,"org.transition9.geom.Rectangle",,,"org.transition9.geom.RectangleTools",,,"Vec2",,,"Vec2Tools",,,"org.transition9.geom.bounds.AbstractBounds",,,"org.transition9.geom.bounds.BoundsCircle",,,"org.transition9.geom.bounds.BoundsDisplayObject",,,"org.transition9.geom.bounds.BoundsForwarding",,,"org.transition9.geom.bounds.BoundsHighLowRes",,,"org.transition9.geom.bounds.BoundsLine",,,"org.transition9.geom.bounds.BoundsNone",,,"org.transition9.geom.bounds.BoundsPoint",,,"org.transition9.geom.bounds.BoundsPolygon",,,"org.transition9.geom.bounds.BoundsRectangle",,,"org.transition9.geom.bounds.BoundsUtil",,,"org.transition9.geom.bounds.IBounds",,,"org.transition9.geom.debug.GeometryTests",,,"org.transition9.util.ArrayUtil",,,"org.transition9.util.Assert",,,"org.transition9.util.Cloneable",,,"org.transition9.util.DisplayUtils",,,"org.transition9.util.Enumerable",,,"org.transition9.util.EqualableUtil",,,"org.transition9.util.EventDispatcherUtil",,,"org.transition9.util.GraphicsUtil",,,"org.transition9.util.IterUtil",,,"org.transition9.util.NumberUtil",,,"org.transition9.util.Macros",,,"org.transition9.util.Preconditions",,,"org.transition9.util.ReflectUtil",,,"org.transition9.util.SignallingVar",,,"org.transition9.util.XmlTools",,,"org.transition9.ds.Hashable",,,"org.transition9.ds.Map",,,"org.transition9.ds.Maps",,,"org.transition9.ds.MapUtil",,,"org.transition9.ds.MultiMap",,,"org.transition9.ds.MultiSet",,,"org.transition9.ds.Set",,,"org.transition9.ds.Sets",,,"org.transition9.ds.Triple",,,"org.transition9.ds.Tuple",,,"org.transition9.ds.maps.AbstractMap",,,"org.transition9.ds.maps.BiMap",,,"org.transition9.ds.maps.DynamicMap",,,"org.transition9.ds.maps.ForwardingMap",,,"org.transition9.ds.maps.HashableMap",,,"org.transition9.ds.maps.ImmutableMap",,,"org.transition9.ds.maps.KeyListMap",,,"org.transition9.ds.maps.SortedMap",,,"org.transition9.ds.maps.StringMap",,,"org.transition9.ds.multimaps.AbstractMultiMap",,,"org.transition9.ds.multimaps.ArrayMultiMap",,,"org.transition9.ds.multimaps.ListMultiMap",,,"org.transition9.ds.multimaps.SetMultiMap",,,"org.transition9.ds.sets.MapSet",,,"org.transition9.ds.sets.MultiMapSet",,,"haxe.remoting.NodeJSHTMLConnection",,"com.pblabs.components.base.ScaleComponent",,,"com.pblabs.components.debug.XBlobDisplayComponent",,,"com.pblabs.components.input.BaseInputManager",,,"com.pblabs.components.input.GestureData",,,"com.pblabs.components.input.GestureInputManager",,,"com.pblabs.components.input.IInteractiveComponent",,,"com.pblabs.components.input.InputData",,,"com.pblabs.components.input.InputUtil",,,"com.pblabs.components.input.MouseInputManager",,,"com.pblabs.components.input.TouchInputManager",,,"com.pblabs.components.scene2D.BaseSceneComponent",,,"com.pblabs.components.scene2D.BaseSceneLayer",,,"com.pblabs.components.scene2D.BaseSceneManager",,,"com.pblabs.components.scene2D.IScene2D",,,"com.pblabs.components.scene2D.flash.SceneComponent",,,"com.pblabs.components.scene2D.flash.SceneManager",,,"com.pblabs.components.scene2D.flash.SceneLayer",,,"com.pblabs.components.scene2D.js.JSLayer",,,"com.pblabs.components.scene2D.js.JSSceneManager",,,"com.pblabs.components.scene2D.js.canvas.SceneComponent",,,"com.pblabs.components.scene2D.js.canvas.SceneLayer",,,"com.pblabs.components.scene2D.js.canvas.SceneManager",,,"com.pblabs.engine.debug.LogTarget",,,"com.pblabs.engine.resource.EmbeddedResource",,,"com.pblabs.engine.resource.ImageResource",,,"com.pblabs.engine.resource.Source",,,"org.transition9.util.DebugUtil",,,"org.transition9.util.SignalVar",,,"org.transition9.util.SignalVarAdvanced",,,"org.transition9.ds.Collection",,,"org.transition9.ds.maps.TransformKeyMap",,,"org.transition9.ds.maps.VariableExpiringMap",,"com.pblabs.components.scene2D.CircleShape",,,"com.pblabs.components.scene2D.ImageComponent",,,"com.pblabs.components.scene2D.RectangleShape",,,"com.pblabs.components.scene2D.ShapeComponent",,,"com.pblabs.components.scene2D.js.css.SceneComponent",,,"com.pblabs.components.scene2D.js.css.Circle",,,"com.pblabs.components.scene2D.js.css.ImageComponent",,,"com.pblabs.components.scene2D.js.css.Rectangle",,,"com.pblabs.components.scene2D.js.css.SceneLayer",,,"com.pblabs.components.scene2D.js.css.SceneManager",,"com.pblabs.components.Constants",,"com.pblabs.components.input.IInputData",,"com.pblabs.components.manager.INode",,"com.pblabs.components.manager.INodeChild",,"com.pblabs.components.scene2D.SceneManagerList",,"com.pblabs.components.scene2D.flash.TextComponent",,"com.pblabs.components.spatial.BasicSpatialManager2D",,"com.pblabs.components.spatial.SpatialComponent",,"com.pblabs.components.tasks.TaskComponentTicked",,"com.pblabs.editor.CreationPanel",,"com.pblabs.editor.CustomEditorPanelComponent",,"com.pblabs.editor.Editor",,"com.pblabs.editor.EntityPanel",,"com.pblabs.editor.TemplatePanel",,"com.pblabs.editor.TimePanel",,"com.pblabs.engine.core.PBManagerBase",,"com.pblabs.engine.pooling.IObjectPool",,"com.pblabs.engine.pooling.ObjectPool",,"com.pblabs.engine.pooling.ObjectPoolMgr",,"com.pblabs.engine.pooling.SpritePool",,"com.pblabs.engine.resource.BitmapCacheResource",,"com.pblabs.engine.resource.ResourceToken",,"com.pblabs.engine.resource.SVGResource",,"com.pblabs.engine.resource.flash.SwfResource",,"org.transition9.util.HashUtil",,"org.transition9.ds.Pair",,"hsl.js.data.Touch",,"hsl.js.translation.touch.GestureTranslator",,"hsl.js.translation.touch.TouchTranslator",,"com.pblabs.components.input.DragManager",,,"com.pblabs.components.scene2D.SVGComponent",,,"com.pblabs.components.spatial.IBounded",,,"com.pblabs.components.tasks.SetFieldTask",,,"com.pblabs.components.tasks.Tasks",,,"com.pblabs.components.ui.UIUtil",,,"com.pblabs.engine.time.ProcessManagerSubordinate",,,"com.pblabs.engine.util.Predicates",,,"org.transition9.util.BytesUtil",,,"org.transition9.util.F",,,"org.transition9.util.StateChange",,,"org.transition9.ds.maps.KeyedObjectMap",,,"org.transition9.ds.sets.ArraySet"]
licensedFiles["easel"],=,["com.pblabs.components.scene2D.js.Sprite",,"easel.display.Canvas",,"easel.display.Context2d"]
licensedFiles["sprintf"],=,["org.transition9.util.Sprintf"]
licensedFiles["haxe"],=,["org.transition9.ds.maps.IntHashMap",,,"org.transition9.ds.maps.HashMap"]
licensedFiles["polygonal"],=,["org.transition9.util.MathUtil"]
#,licensedFiles["mathx"],=,["mathx.Limits",,"mathx.MersenneTwister",,"mathx.RandomGenerator"]
hydrax_preamble,=,"""/*******************************************************************************
*,Hydrax:,haXe,port,of,the,PushButton,Engine
*,Copyright,(C),2010,Dion,Amago
*,For,more,information,see,http://github.com/dionjwa/Hydrax"""
headers["non_derived"],=,hydrax_preamble,+,"""
*
*,This,file,is,licensed,under,the,terms,of,the,MIT,license,,which,is,included
*,in,the,License.html,file,at,the,root,directory,of,this,SDK.
******************************************************************************/"""
headers["pbe"],=,hydrax_preamble,+,"""
*
*,This,file,was,derived,from,the,equivalent,actionscript,PushButton,Engine,
*,source,file:
*,http://code.google.com/p/pushbuttonengine/
*
*,This,file,is,licensed,under,the,terms,of,the,MIT,license,,which,is,included
*,in,the,License.html,file,at,the,root,directory,of,this,SDK.
******************************************************************************/"""
headers["flashbang"],=,hydrax_preamble,+,"""
*
*,This,source,file,was,derived,from,the,actionscript,Flashbang,library.
*,A,copy,of,the,LGPL,license,is,located,at,the,root,of,the,SDK.
*
*,The,original,file,source,header,(required,by,the,LGPL,license):
*
*,Flashbang,-,a,framework,for,creating,Flash,games
*,Copyright,(C),2008-2010,Three,Rings,Design,,Inc.,,All,Rights,Reserved
*,http://code.google.com/p/flashbang/
*,
*,This,library,is,free,software:,you,can,redistribute,it,and/or,modify
*,it,under,the,terms,of,the,GNU,Lesser,General,Public,License,as,published,by
*,the,Free,Software,Foundation,,either,version,3,of,the,License,,or
*,(at,your,option),any,later,version.
*,
*,This,library,is,distributed,in,the,hope,that,it,will,be,useful,
*,but,WITHOUT,ANY,WARRANTY,;,without,even,the,implied,warranty,of
*,MERCHANTABILITY,or,FITNESS,FOR,A,PARTICULAR,PURPOSE.,,See,the
*,GNU,Lesser,General,Public,License,for,more,details.
*,
*,You,should,have,received,a,copy,of,the,GNU,Lesser,General,Public,License
*,along,with,this,library.,,If,not,,see,<http://www.gnu.org/licenses/>.
*/"""
aspirin_derived_header,=,headers["flashbang"].replace("Flashbang,-,a,framework,for,creating,Flash,games",,"aspirin,library,-,Taking,some,of,the,pain,out,of,Actionscript,development.")
aspirin_derived_header,=,aspirin_derived_header.replace("Copyright,(C),2008-2010,Three,Rings,Design,,Inc.,,All,Rights,Reserved",,"Copyright,(C),2007-2010,Three,Rings,Design,,Inc.,,All,Rights,Reserved")
aspirin_derived_header,=,aspirin_derived_header.replace("http://code.google.com/p/flashbang/",,"http://code.google.com/p/ooo-aspirin/")
aspirin_derived_header,=,aspirin_derived_header.replace("This,source,file,was,derived,from,the,actionscript,Flashbang,library.",,"This,source,file,was,derived,from,the,actionscript,aspirin,library."),;
headers["aspirin"],=,aspirin_derived_header
headers["easel"],=,hydrax_preamble,+,"""
*
*,This,file,was,derived,from,source,code,from,the,easel,library:
*,http://github.com/aduros/easel
*,Copyright,(C),2010,Bruno,Garcia
*
*,Currently,no,license,is,listed,for,the,easel,library,,so,for,now,,this,
*,code,takes,on,the,project,default,license.
*
*,This,file,is,licensed,under,the,terms,of,the,MIT,license,,which,is,included
*,in,the,License.html,file,at,the,root,directory,of,this,SDK.
******************************************************************************/"""
headers["sprintf"],=,hydrax_preamble,+,"""
*
*,This,file,was,derived,from,a,sprintf,function,by,Manish,Jethani.
*,Original,copyright,notice:
*
*,,Author:,,Manish,Jethani,(manish.jethani@gmail.com)
*,,Date:	April,3,,2006
*,,Version:,0.1
*
*,,Copyright,(c),2006,Manish,Jethani
*
*,,Permission,is,hereby,granted,,free,of,charge,,to,any,person,obtaining,a
*,,copy,of,this,software,and,associated,documentation,files,(the,"Software"),
*,,to,deal,in,the,Software,without,restriction,,including,without,limitation
*,,the,rights,to,use,,copy,,modify,,merge,,publish,,distribute,,sublicense,
*,,and/or,sell,copies,of,the,Software,,and,to,permit,persons,to,whom,the
*,,Software,is,furnished,to,do,so,,subject,to,the,following,conditions:
*
*,,The,above,copyright,notice,and,this,permission,notice,shall,be,included,in
*,,all,copies,or,substantial,portions,of,the,Software.
*
*,,THE,SOFTWARE,IS,PROVIDED,"AS,IS",,WITHOUT,WARRANTY,OF,ANY,KIND,,EXPRESS,OR
*,,IMPLIED,,INCLUDING,BUT,NOT,LIMITED,TO,THE,WARRANTIES,OF,MERCHANTABILITY,
*,,FITNESS,FOR,A,PARTICULAR,PURPOSE,AND,NONINFRINGEMENT.,IN,NO,EVENT,SHALL,THE
*,,AUTHORS,OR,COPYRIGHT,HOLDERS,BE,LIABLE,FOR,ANY,CLAIM,,DAMAGES,OR,OTHER
*,,LIABILITY,,WHETHER,IN,AN,ACTION,OF,CONTRACT,,TORT,OR,OTHERWISE,,ARISING
*,,FROM,,OUT,OF,OR,IN,CONNECTION,WITH,THE,SOFTWARE,OR,THE,USE,OR,OTHER
*,,DEALINGS,IN,THE,SOFTWARE.,,
******************************************************************************/"""
headers["haxe"],=,hydrax_preamble,+,"""
*
*,Portions,derived,from,Haxe,std,code.,,Haxe,std,library,license,and,copyright:
*
*,Copyright,(c),2005,,The,haXe,Project,Contributors
*,All,rights,reserved.
*,Redistribution,and,use,in,source,and,binary,forms,,with,or,without
*,modification,,are,permitted,provided,that,the,following,conditions,are,met:
*
*,,,-,Redistributions,of,source,code,must,retain,the,above,copyright
*	,notice,,this,list,of,conditions,and,the,following,disclaimer.
*,,,-,Redistributions,in,binary,form,must,reproduce,the,above,copyright
*	,notice,,this,list,of,conditions,and,the,following,disclaimer,in,the
*	,documentation,and/or,other,materials,provided,with,the,distribution.
*
*,THIS,SOFTWARE,IS,PROVIDED,BY,THE,HAXE,PROJECT,CONTRIBUTORS,"AS,IS",AND,ANY
*,EXPRESS,OR,IMPLIED,WARRANTIES,,INCLUDING,,BUT,NOT,LIMITED,TO,,THE,IMPLIED
*,WARRANTIES,OF,MERCHANTABILITY,AND,FITNESS,FOR,A,PARTICULAR,PURPOSE,ARE
*,DISCLAIMED.,IN,NO,EVENT,SHALL,THE,HAXE,PROJECT,CONTRIBUTORS,BE,LIABLE,FOR
*,ANY,DIRECT,,INDIRECT,,INCIDENTAL,,SPECIAL,,EXEMPLARY,,OR,CONSEQUENTIAL
*,DAMAGES,(INCLUDING,,BUT,NOT,LIMITED,TO,,PROCUREMENT,OF,SUBSTITUTE,GOODS,OR
*,SERVICES,;,LOSS,OF,USE,,DATA,,OR,PROFITS,;,OR,BUSINESS,INTERRUPTION),HOWEVER
*,CAUSED,AND,ON,ANY,THEORY,OF,LIABILITY,,WHETHER,IN,CONTRACT,,STRICT
*,LIABILITY,,OR,TORT,(INCLUDING,NEGLIGENCE,OR,OTHERWISE),ARISING,IN,ANY,WAY
*,OUT,OF,THE,USE,OF,THIS,SOFTWARE,,EVEN,IF,ADVISED,OF,THE,POSSIBILITY,OF,SUCH
*,DAMAGE.
******************************************************************************/"""
headers["polygonal"],=,hydrax_preamble,+,"""
*
*,Portions,derived,from,polygonal,code.,,Polygonal,license,and,copyright:
*
*							_/										,,_/,,,
*	,,,_/_/_/	,,_/_/	_/,,_/	_/	_/_/_/	_/_/	_/_/_/	_/	
*	,,_/	_/,,_/	_/,,_/,,_/	_/,,_/	_/,,_/	_/,,_/	_/,,_/	,
*	,_/	_/,,_/	_/,,_/,,_/	_/,,_/	_/,,_/	_/,,_/	_/,,_/	,,
*	_/_/_/	,,_/_/	_/	_/_/_/	_/_/_/	_/_/	_/	_/,,_/	,,,
*,,,_/							_/		_/								
*,,_/						_/_/	,,_/_/
*
*,POLYGONAL,-,A,HAXE,LIBRARY,FOR,GAME,DEVELOPERS
*,Copyright,(c),2009-2010,Michael,Baczynski,,http://www.polygonal.de
*
*,Permission,is,hereby,granted,,free,of,charge,,to,any,person,obtaining
*,a,copy,of,this,software,and,associated,documentation,files,(the
*,"Software"),,to,deal,in,the,Software,without,restriction,,including
*,without,limitation,the,rights,to,use,,copy,,modify,,merge,,publish,
*,distribute,,sublicense,,and/or,sell,copies,of,the,Software,,and,to
*,permit,persons,to,whom,the,Software,is,furnished,to,do,so,,subject,to
*,the,following,conditions:
*,The,above,copyright,notice,and,this,permission,notice,shall,be
*,included,in,all,copies,or,substantial,portions,of,the,Software.
*,THE,SOFTWARE,IS,PROVIDED,"AS,IS",,WITHOUT,WARRANTY,OF,ANY,KIND,
*,EXPRESS,OR,IMPLIED,,INCLUDING,BUT,NOT,LIMITED,TO,THE,WARRANTIES,OF
*,MERCHANTABILITY,,FITNESS,FOR,A,PARTICULAR,PURPOSE,AND
*,NONINFRINGEMENT.,IN,NO,EVENT,SHALL,THE,AUTHORS,OR,COPYRIGHT,HOLDERS,BE
*,LIABLE,FOR,ANY,CLAIM,,DAMAGES,OR,OTHER,LIABILITY,,WHETHER,IN,AN,ACTION
*,OF,CONTRACT,,TORT,OR,OTHERWISE,,ARISING,FROM,,OUT,OF,OR,IN,CONNECTION
*,WITH,THE,SOFTWARE,OR,THE,USE,OR,OTHER,DEALINGS,IN,THE,SOFTWARE.
******************************************************************************/"""
headers["mathx"],=,"""/*,<license>
*,This,file,is,part,of,the,dis-Emi-A,HaXe,Library.,Copyright,,edA-qa,mort-ora-y
*,For,full,copyright,and,license,information,please,refer,to,doc/license.txt.
*,</license>,
*/"""
#Add/replace,the,license
def,replaceLicense,(f,,header):
	newLines,=,[]
	file,=,open(f)
	found_license,=,False
	in_license,=,False
	for,line,in,file:
		if,in_license,and,line.find("*/"),>,-1:
			found_license,=,True
			in_license,=,False
		elif,found_license:
			newLines.append(line,+,"\n")
		elif,line.find("package"),>,-1:
			found_license,=,True
			newLines.append(line)
		elif,not,found_license,and,line.find("/**"),>,-1:
			in_license,=,True
			
	file.close()
	file,=,open(f,,'w')
	file.write(header,+,"\n")
	for,line,in,newLines:
		file.write(line[0:-1])
	file.close()
	
def,getFullPackageName(f):
	return,f.split("src/")[-1].replace("/",,".").replace(".hx",,"")
def,addLicensesToClasses,(classes,,header):
	for,f,in,fileList:
		fileEquivalent,=,getFullPackageName(f)
		if,classes.count(fileEquivalent),>,0:
			if,filesAccountedFor.count(f),>,0:
				print,"Warning,,",+,str(f),,+,",is,already,accounted,for"
			else:
				#,print,"Replacing,header,for,",+,str(f)
				replaceLicense(f,,header)
				filesAccountedFor.append(f)
		
#Add,all,the,licenses
for,item,in,licensedFiles.iteritems():
	libkey,=,item[0]
	files,=,item[1]
	if,libkey,not,in,headers:
		print,"No,licence,for,",+,libkey,+,",,using,default"
		addLicensesToClasses(files,,headers["non_derived"])
	else:
		addLicensesToClasses(files,,headers[libkey])
	#,print,item
#Notify,classes,with,no,licence,asssignment
print,"No,license,assignment,for,"
for,f,in,fileList:
	if,filesAccountedFor.count(f),==,0:
		print,getFullPackageName(f)
#,for,f,in,filesAccountedFor:
#	,print,getFullPackageName(f)
#!/usr/bin/env,python
#Copies,the,minimum,classes,needed,for,rendering,SVGs
import,os,,os.path,,string,,sys,,shutil,,re
libd,=,"/Users/dion/storage/projects/libdamago"
hydrax,=,"/Users/dion/storage/projects/hydrax"
os.system("mkdir,-p,",+,os.path.join(hydrax,,"src",,"gm2d"))
classes,=,[
	"gm2d.svg.PathParser",
	"gm2d.svg.PathSegment",
	"gm2d.svg.SVG2Gfx",
	"gm2d.svg.RenderContext",
	"gm2d.geom.Rectangle",
	"gm2d.geom.Matrix",
	"gm2d.geom.Point",
	"gm2d.display.Graphics",
	"gm2d.display.BitmapData",
	"gm2d.display.Shape",
	"gm2d.RGB",
	
]
for,c,in,classes:
	source,=,os.path.join(libd,,"lib",,"gm2d",,c.replace(".",,"/")),+,".hx"
	dest,=,os.path.join(hydrax,,"src",,c.replace(".",,"/")),+,".hx"
	if,not,os.path.exists(os.path.dirname(dest)):
		os.system("mkdir,-p,",+,os.path.dirname(dest))
	print,source,,",->,",,dest
	shutil.copyfile(source,,dest)
#!/usr/bin/env,python
#Create,a,class,that,imports,all,project,classes
import,os,,os.path,,string,,sys,,shutil
if,len(sys.argv),<=,1:
	print,"Usage:,createImportAllForJs.py,<src,folders>,output.hx"
	sys.exit()
args,=,sys.argv[1:]
hxoutput,=,args[-1]
srcfolders,=,args[0:-1]
print,"srcfolders:,",,srcfolders
print,"hxoutput:,",,hxoutput
fileList,=[]
filetypes,=,["hx"]
fileList,=,[]
for,srcfolder,in,srcfolders:
	print,"srcfolder,",+,srcfolder
	for,root,,subFolders,,files,in,os.walk(srcfolder):
		if,root.find("flash"),>,-1:
			print,"excluding,",+,root
			continue
		for,file,in,files:
			for,filetype,in,filetypes:
				if,file.endswith(".",+,filetype):
					f,=,os.path.join(root,file)
					f,=,f[:f.rfind(".")]
					f,=,f[f.find("/"),+,1:]
					f,=,f.replace("/",,".")
					if,f.find(".flash."),>,-1:
						break,;
					f,=,"import,",+,f,+,",;"
					if,f.find("."),>,-1:
						fileList.append(f)
					break
		
swffile,=,open(hxoutput,,'w')
classname,=,hxoutput[:-3]
classname,=,classname[classname.rfind("/"),+,1:]
swffile.write("""
package,;
""")
for,f,in,fileList:
	swffile.write(f,+,"\n")
swffile.write("""
class,""",+,classname,+,"""
{
""")
swffile.write("""
	public,function,new()
	{
		super(),;
	}
	public,static,function,main(),
	{
		new,""",+,classname,+,"""(),;
	}
}
"""),;
swffile.close(),;
#!/usr/bin/env,python
#Create,a,class,that,imports,all,project,classes
import,os,,os.path,,string,,sys,,shutil
if,len(sys.argv),<=,1:
	print,"Usage:,createImportAllForSwc.py,<src,folders>,output.hx"
	sys.exit()
args,=,sys.argv[1:]
hxoutput,=,args[-1]
srcfolders,=,args[0:-1]
print,"srcfolders:,",,srcfolders
print,"hxoutput:,",,hxoutput
fileList,=[]
filetypes,=,["hx"]
fileList,=,[]
for,srcfolder,in,srcfolders:
	print,"srcfolder,",+,srcfolder
	for,root,,subFolders,,files,in,os.walk(srcfolder):
		if,root.find("js"),>,-1,or,root.find("JS"),>,-1,or,root.find("jeash"),>,-1:
			print,"excluding,",+,root
			continue
		for,file,in,files:
			for,filetype,in,filetypes:
				if,file.endswith(".",+,filetype):
					f,=,os.path.join(root,file)
					f,=,f[:f.rfind(".")]
					f,=,f[f.find("/"),+,1:]
					f,=,f.replace("/",,".")
					if,f.find(".js."),>,-1:
						break,;
					f,=,"import,",+,f,+,",;"
					if,f.find("."),>,-1:
						fileList.append(f)
					#,fileList.append(file)
					break
		
swffile,=,open(hxoutput,,'w')
classname,=,hxoutput[:-3]
classname,=,classname[classname.rfind("/"),+,1:]
swffile.write("""
package,;
import,flash.display.Sprite,;
""")
for,f,in,fileList:
	swffile.write(f,+,"\n")
swffile.write("""
class,""",+,classname,+,""",extends,Sprite
{
""")
swffile.write("""
	public,function,new()
	{
		super(),;
	}
	public,static,function,main(),
	{
		new,""",+,classname,+,"""(),;
	}
}
"""),;
swffile.close(),;
#!,/usr/bin/env,python
#,Inlines,svg,files,into,a,xhtml,template.,,The,svg,elements,will,be,inserted
#,after,the,<div,id="resources">,tag.
import,sys
import,os
import,fnmatch
import,re
if,len(sys.argv),<,3:
	print,"usage:,genHydraxXHTML.py,<xhtml,template>,<svg,root,folder>,[output.xhtml]"
xhtmlTmpl,=,sys.argv[1],;
svgRootFolder,=,sys.argv[2],;
outputFileName,=,None
if,len(sys.argv),>=,4:
	outputFileName,=,sys.argv[3]
	
svgs,=,[]
for,root,,dirnames,,filenames,in,os.walk(svgRootFolder):
for,filename,in,fnmatch.filter(filenames,,"*.svg"):
	,,svgs.append(os.path.join(root,,filename))
#Begin,the,xhtml,template
tmpl,=,open(xhtmlTmpl)
for,line,in,tmpl.readlines():
	print,line,
	if,re.match("<div,id=\"resources\",",,line):
		for,svg,in,svgs:
			svgfile,=,open(svg)
			id,=,os.path.basename(svg)[:-4]
			insvgtag,=,False
			for,line,in,svgfile.readlines():
				
				if,not,insvgtag,and,re.match("<svg,",,line):,
					insvgtag,=,True
					if,line.find("id="),==,-1:
						print,re.sub("<svg,",,"<svg,,id=\"",+,id,+,"\",",,line)
					else:		
						print,re.sub(",id=[\"'][A-Za-z0-9_]+[\"'],",,",id=\"",+,id,+,"\",",,line)
				elif,insvgtag:
					print,line,
			
			svgfile.close()
tmpl.close()
#!/usr/bin/env,python
#Create,the,rsrc/audio.swf,containing,all,mp3s,in,the,rsrc,folder
import,os,,os.path,,string,,sys,,shutil
print,"Testing,Flash"
os.system("bin/createImportAllForSwc.py,src,src/TestHydraxCompilation.hx")
os.system("haxe,-main,TestHydraxCompilation,-cp,src,-swf,build/delete.swf,-lib,polygonal,-lib,feffects,-lib,hsl-1,-lib,gm2d")
print,"Testing,javascript"
os.system("bin/createImportAllForJs.py,src,src/TestHydraxCompilation.hx")
os.system("haxe,-main,TestHydraxCompilation,-cp,src,-js,build/test.js,-cp,../libdamago/lib/bdog-redis,-cp,../libdamago/lib/bdog-core,--remap,flash:jeash,-lib,polygonal,-lib,feffects,,-lib,hsl-1,-lib,html5,-lib,jQueryExtern,-lib,gm2d,-lib,nodejs,-lib,nodejs_externs")
filesToDelete,=,["build/delete.swf",,"src/TestHydraxCompilation.hx","build/test.js"]
for,f,in,filesToDelete:
	if,os.path.exists(f):
		os.remove(f)
#!/usr/bin/env,python
#,calls,haxe,<build,file>,on,all,build,files,in,the,root,demo,directories
import,os,,os.path,,sys,,re
os.chdir(os.path.dirname(__file__))
root,=,os.getcwd()
for,f,in,os.listdir(root):
	if,os.path.isdir(os.path.join(root,,f)):
		print,"Project,",+,f
		
		for,projectFile,in,os.listdir(os.path.join(root,,f)):
			os.chdir(os.path.join(root,,f))
			
			if,projectFile.endswith(".hxml"),and,projectFile.find("cpp"),==,-1:
				print,",,,",+,projectFile
				os.system("haxe,",+,projectFile)
#!/usr/bin/python
import,glob
import,os
import,re
import,sys
for,filename,in,glob.glob("../htmlObjectHarness/*.html"):
#,used,to,test,the,first,file
#if,filename,!=,"../htmlObjectHarness/full-color-prof-01-f.html":
#,,,,continue
if,filename,==,"../htmlObjectHarness/tiny-index.html":
continue
if,filename,==,"../htmlObjectHarness/basic-index.html":
continue
if,filename,==,"../htmlObjectHarness/full-index.html":
continue
infile,=,open,(filename,,"r")
outfile,=,open,(filename,+,".new",,"w")
content,=,infile.read()
svgfilename,=,re.sub("\.html",,".svg",,filename)
svgfilename,=,re.sub("../htmlObjectHarness/full-",,"",,svgfilename)
svgfilename,=,re.sub("../htmlObjectHarness/tiny-",,"",,svgfilename)
svgfilename,=,re.sub("../htmlObjectHarness/basic-",,"",,svgfilename)
svgfilename,=,'../svggen/',+,svgfilename
content,=,re.sub(r'<!--\[if,IE\]>\n<object,src="([^"]*)",classid="image/svg\+xml"\n.*\n.*\n.*\n.*\n.*\n.*\n.*\n',,
r'\t\t\t\t\t\t<!--[if,!IE]>-->\n',+,
'\t\t\t\t\t\t,,<object,data="\\1",type="image/svg+xml"\n',+,
'\t\t\t\t\t\t,,,,,,,,,,width="480",height="360">,<!--<![endif]-->\n',+,
'\t\t\t\t\t\t<!--[if,lt,IE,9]>\n',+
'\t\t\t\t\t\t,,<object,src="\\1",classid="image/svg+xml"\n',+
'\t\t\t\t\t\t,,,,,,,,,,width="480",height="360">,<![endif]-->\n',+,
'\t\t\t\t\t\t<!--[if,gte,IE,9]>\n',+
'\t\t\t\t\t\t,,<object,data="\\1",type="image/svg+xml"\n',+,
'\t\t\t\t\t\t,,,,,,,,,,width="480",height="360">,<![endif]-->\n',+,
'\t\t\t\t\t\t,,</object>\n\n',
content)
outfile.write(content)
outfile.close()
infile.close()
os.rename(filename,+".new",,filename)
import,os
hype,=,[]
for,path,,dirs,,files,in,os.walk('../src/hype/'):
	for,name,in,files:
		if,name[-3:],==,".as":
			hype.append(path[7:].replace("/",,"."),+,".",+,name[:-3])
command,=,"compc,-target-player,10,-output,../hype.swc,-source-path,../src/,-include-classes,"
command,=,command,+,",".join(hype)
os.system(command),;
#!/usr/bin/env,python
#,Copyright,(c),2012,,Adobe,Systems,Incorporated
#,All,rights,reserved.
#,
#,Redistribution,and,use,in,source,and,binary,forms,,with,or,without,
#,modification,,are,permitted,provided,that,the,following,conditions,are
#,met:
#,
#,*,Redistributions,of,source,code,must,retain,the,above,copyright,notice,,
#,this,list,of,conditions,and,the,following,disclaimer.
#,
#,*,Redistributions,in,binary,form,must,reproduce,the,above,copyright
#,notice,,this,list,of,conditions,and,the,following,disclaimer,in,the,
#,documentation,and/or,other,materials,provided,with,the,distribution.
#,
#,*,Neither,the,name,of,Adobe,Systems,Incorporated,nor,the,names,of,its,
#,contributors,may,be,used,to,endorse,or,promote,products,derived,from,
#,this,software,without,specific,prior,written,permission.
#,
#,THIS,SOFTWARE,IS,PROVIDED,BY,THE,COPYRIGHT,HOLDERS,AND,CONTRIBUTORS,"AS
#,IS",AND,ANY,EXPRESS,OR,IMPLIED,WARRANTIES,,INCLUDING,,BUT,NOT,LIMITED,TO,
#,THE,IMPLIED,WARRANTIES,OF,MERCHANTABILITY,AND,FITNESS,FOR,A,PARTICULAR
#,PURPOSE,ARE,DISCLAIMED.,IN,NO,EVENT,SHALL,THE,COPYRIGHT,OWNER,OR,
#,CONTRIBUTORS,BE,LIABLE,FOR,ANY,DIRECT,,INDIRECT,,INCIDENTAL,,SPECIAL,
#,EXEMPLARY,,OR,CONSEQUENTIAL,DAMAGES,(INCLUDING,,BUT,NOT,LIMITED,TO,
#,PROCUREMENT,OF,SUBSTITUTE,GOODS,OR,SERVICES,;,LOSS,OF,USE,,DATA,,OR
#,PROFITS,;,OR,BUSINESS,INTERRUPTION),HOWEVER,CAUSED,AND,ON,ANY,THEORY,OF
#,LIABILITY,,WHETHER,IN,CONTRACT,,STRICT,LIABILITY,,OR,TORT,(INCLUDING
#,NEGLIGENCE,OR,OTHERWISE),ARISING,IN,ANY,WAY,OUT,OF,THE,USE,OF,THIS
#,SOFTWARE,,EVEN,IF,ADVISED,OF,THE,POSSIBILITY,OF,SUCH,DAMAGE.
'''See,readme,or,run,with,no,args,for,usage'''
import,os
import,sys
import,tempfile
import,shutil
import,struct
import,zlib
import,hashlib
import,inspect
supportsLZMA,=,False
try:
import,pylzma
supportsLZMA,=,True
except:
pass
####################################
#,Helpers
####################################
class,stringFile(object):
def,__init__(self,,data):
self.data,=,data
def,read(self,,num=-1):
result,=,self.data[:num]
self.data,=,self.data[num:]
return,result
def,close(self):
self.data,=,None
def,flush(self):
pass
def,consumeSwfTag(f):
tagBytes,=,""
recordHeaderRaw,=,f.read(2)
tagBytes,+=,recordHeaderRaw
if,recordHeaderRaw,==,"":
raise,Exception("Bad,SWF:,Unexpected,end,of,file")
recordHeader,=,struct.unpack("BB",,recordHeaderRaw)
tagCode,=,((recordHeader[1],&,0xff),<<,8),|,(recordHeader[0],&,0xff)
tagType,=,(tagCode,>>,6)
tagLength,=,tagCode,&,0x3f
if,tagLength,==,0x3f:
ll,=,f.read(4)
longlength,=,struct.unpack("BBBB",,ll)
tagLength,=,((longlength[3]&0xff),<<,24),|,((longlength[2]&0xff),<<,16),|,((longlength[1]&0xff),<<,8),|,(longlength[0]&0xff)
tagBytes,+=,ll
tagBytes,+=,f.read(tagLength)
return,(tagType,,tagBytes)
def,outputInt(o,,i):
o.write(struct.pack('I',,i))
def,outputTelemetryTag(o,,passwordClear):
lengthBytes,=,2,#,reserve
if,passwordClear:
sha,=,hashlib.sha256()
sha.update(passwordClear)
passwordDigest,=,sha.digest()
lengthBytes,+=,len(passwordDigest)
#,Record,header
code,=,93
if,lengthBytes,>=,63:
o.write(struct.pack('<HI',,code,<<,6,|,0x3f,,lengthBytes))
else:
o.write(struct.pack('<H',,code,<<,6,|,lengthBytes))
#,Reserve
o.write(struct.pack('<H',,0))
#,Password
if,passwordClear:
o.write(passwordDigest)
####################################
#,main()
####################################
if,__name__,==,"__main__":
####################################
#,Parse,command,line
####################################
if,len(sys.argv),<,2:
print("Usage:,%s,SWF_FILE,[PASSWORD]",%,os.path.basename(inspect.getfile(inspect.currentframe())))
	print("\nIf,PASSWORD,is,provided,,then,a,password,will,be,required,to,view,advanced,telemetry,in,Adobe,'Monocle'.")
sys.exit(-1)
infile,=,sys.argv[1]
passwordClear,=,sys.argv[2],if,len(sys.argv),>=,3,else,None
####################################
#,Process,SWF,header
####################################
swfFH,=,open(infile,,'rb')
signature,=,swfFH.read(3)
swfVersion,=,swfFH.read(1)
struct.unpack("<I",,swfFH.read(4))[0],#,uncompressed,length,of,file
if,signature,==,"FWS":
pass
elif,signature,==,"CWS":
decompressedFH,=,stringFile(zlib.decompressobj().decompress(swfFH.read()))
swfFH.close()
swfFH,=,decompressedFH
elif,signature,==,"ZWS":
if,not,supportsLZMA:
raise,Exception("You,need,the,PyLZMA,package,to,use,this,script,on,\
LZMA-compressed,SWFs.,http://www.joachim-bauch.de/projects/pylzma/")
swfFH.read(4),#,compressed,length
decompressedFH,=,stringFile(pylzma.decompress(swfFH.read()))
swfFH.close()
swfFH,=,decompressedFH
else:
raise,Exception("Bad,SWF:,Unrecognized,signature:,%s",%,signature)
f,=,swfFH
o,=,tempfile.TemporaryFile()
o.write(signature)
o.write(swfVersion)
outputInt(o,,,0),#,FileLength,-,we'll,fix,this,up,later
#,FrameSize,-,this,is,nasty,to,read,because,its,size,can,vary
rs,=,f.read(1)
r,=,struct.unpack("B",,rs)
rbits,=,(r[0],&,0xff),>>,3
rrbytes,=,(7,+,(rbits*4),-,3),/,8,;
o.write(rs)
o.write(f.read((int)(rrbytes)))
o.write(f.read(4)),#,FrameRate,and,FrameCount
####################################
#,Process,each,SWF,tag
####################################
while,True:
(tagType,,tagBytes),=,consumeSwfTag(f)
if,tagType,==,93:
raise,Exception("Bad,SWF:,already,has,EnableTelemetry,tag")
elif,tagType,==,92:
raise,Exception("Bad,SWF:,Signed,SWFs,are,not,supported")
elif,tagType,==,69:
#,FileAttributes,tag
o.write(tagBytes)
#,Look,ahead,for,Metadata,tag.,If,present,,put,our,tag,after,it
(nextTagType,,nextTagBytes),=,consumeSwfTag(f)
writeAfterNextTag,=,nextTagType,==,77
if,writeAfterNextTag:
o.write(nextTagBytes)
outputTelemetryTag(o,,passwordClear)
#,If,there,was,no,Metadata,tag,,we,still,need,to,write,that,tag,out
if,not,writeAfterNextTag:
o.write(nextTagBytes)
(tagType,,tagBytes),=,consumeSwfTag(f)
o.write(tagBytes)
if,tagType,==,0:
break
####################################
#,Finish,up
####################################
#,Fix,the,FileLength,header
uncompressedLength,=,o.tell()
o.seek(4)
o.write(struct.pack("I",,uncompressedLength)),,,
o.flush()
o.seek(0)
#,Copy,the,temp,file,to,the,outFile,,compressing,if,necessary
outFile,=,open(infile,,"wb")
if,signature,==,"FWS":,,,,
shutil.copyfileobj(o,,outFile)
else:
outFile.write(o.read(8)),#,File,is,compressed,after,header
if,signature,==,"CWS":
outFile.write(zlib.compress(o.read()))
elif,signature,==,"ZWS":
compressed,=,pylzma.compress(o.read())
outputInt(outFile,,len(compressed)-5),#,LZMA,SWF,has,CompressedLength,header,field
outFile.write(compressed)
else:
assert(false)
outFile.close()
if,passwordClear:
print("Added,opt-in,flag,with,encrypted,password,",+,passwordClear)
else:
print("Added,opt-in,flag,with,no,password")
#!/usr/bin/python
import,os,,sys
from,xml.dom,import,minidom
#--------------------------------------
BASE_PATH,=,os.path.dirname(__file__)
MAP_SRC_DIR,=,os.path.join(BASE_PATH,,'assets/levels')
MAP_COMPILED_DIR,=,os.path.join(BASE_PATH,,'assets/levels/compiled')
TILE_LAYER_NAMES,=,["ground"]
#--------------------------------------
def,compile_levels():
"""
Flatten,OGMO's,XML,tilemaps,into,comma-separated,strings.,This,is
done,in,order,to,cut,down,processing,at,runtime,-,parsing,tilemap
data,from,a,list,of,xml,nodes,into,a,CSV,is,too,costly,to,do,at
runtime,without,noticeable,lag.
"""
for,ogmo_filename,in,[x,for,x,in,os.listdir(MAP_SRC_DIR),if,x.endswith('.oel')]:
ogmo_path,=,os.path.join(MAP_SRC_DIR,,ogmo_filename)
ogmo_flattened_path,=,os.path.join(MAP_COMPILED_DIR,,ogmo_filename)
if,os.path.exists(ogmo_flattened_path):
if,os.path.getmtime(ogmo_flattened_path),>,os.path.getmtime(ogmo_path):
sys.stdout.write("--%s,up,to,date\n",%,ogmo_flattened_path)
continue
flatten_ogmo_tilemaps(ogmo_path,,ogmo_flattened_path)
def,flatten_ogmo_tilemaps(ogmo_path,,ogmo_flattened_path):
ogmo_dom,=,minidom.parse(ogmo_path)
map_data,=,dict(ogmo_dom.getElementsByTagName('level')[0].attributes.items())
map_data['width'],=,ogmo_dom.getElementsByTagName('width')[0].firstChild.data
map_data['height'],=,ogmo_dom.getElementsByTagName('height')[0].firstChild.data
#,load,tiles
for,tile_layer_name,in,TILE_LAYER_NAMES:
map_data[tile_layer_name],=,dict(ogmo_dom.getElementsByTagName(tile_layer_name)[0].attributes.items())
map_data[tile_layer_name]['tiles'],=,''
tileWidth,=,int(map_data[tile_layer_name]['tileWidth'])
tileHeight,=,int(map_data[tile_layer_name]['tileHeight'])
widthInTiles,=,int(map_data['width']),/,tileWidth
heightInTiles,=,int(map_data['height']),/,tileHeight
tiles,=,{}
for,tileNode,in,ogmo_dom.getElementsByTagName(tile_layer_name)[0].getElementsByTagName('tile'):
tileId,=,tileNode.getAttribute('id')
tileX,=,int(tileNode.getAttribute('x')),/,tileWidth
tileY,=,int(tileNode.getAttribute('y')),/,tileHeight
tiles[str(tileX),+,'@',+,str(tileY)],=,tileId
for,y,in,range(0,,heightInTiles):
for,x,in,range(0,,widthInTiles):
tileId,=,tiles.get(str(x),+,'@',+,str(y),,'0')
map_data[tile_layer_name]['tiles'],+=,tileId
map_data[tile_layer_name]['tiles'],+=,","
map_data[tile_layer_name]['tiles'],+=,"\n"
#,clear,out,old,tiles,node,&,add,a,new,flattened,one
ogmo_dom.getElementsByTagName(tile_layer_name)[0].childNodes[:],=,[],#,shorcut,to,clear,all,child,nodes
flattenedTextNode,=,ogmo_dom.createTextNode(map_data[tile_layer_name]['tiles'])
ogmo_dom.getElementsByTagName(tile_layer_name)[0].appendChild(flattenedTextNode)
f,=,open(ogmo_flattened_path,,'w')
f.write(ogmo_dom.toxml())
f.close()
if,__name__,==,'__main__':
compile_levels()#!,/usr/bin/env,python
import,json
import,re
WEATHER_RX,=,r'public,static,const,([A-Z_]*):Object,=,({[^\}]*})'
PROP_RX,=,r':([^,\n]*)([,\n])'
#,weatherfile,=,open('Weather.as').read()
#,jsonfile,=,open("weathers.json",'w')
#,weathers,=,{}
#,for,a,in,re.findall(WEATHER_RX,,weatherfile,,re.DOTALL):
#,,,,,print,a[0]
#,,,,,w,=,re.sub(PROP_RX,,r':"\1"\2',,a[1])
#,,,,,w,=,w.replace("'",'"')
#,,,,,weathers[a[0]],=,json.loads(w)
#,,,,,
#,json.dump(weathers,,jsonfile,,indent=2)
#,
presets,=,open('WeatherPresets.as',,'w')
presets.write("//,THIS,FILE,IS,AUTOGENERATED,,MODIFY,weathers.json,IN,STEAD.\n\n")
presets.write("package,{\n")
presets.write("public,class,WeatherPresets,extends,Object{\n")
weathers,=,json.load(open('weathers.json'))
print,"Found:,\n-,",+,'\n-,'.join(sorted(weathers.keys()))
for,weather,,content,in,weathers.items():
presets.write("\tpublic,static,const,%s:Object,=,{\n",%,(weather))
presets.write(',\n'.join(["\t\t'%s':,%s",%,(key,val),for,key,,val,in,content.items()]))
presets.write('\n\t}\n')
presets.write("}\n}")import,os
import,stat
import,fnmatch
import,re
asFile,=,fnmatch.translate('*.as')
def,checkdir(d,,prefix):
map,=,dict()
for,f,in,os.listdir(d):
if,re.match(asFile,,f):
map[f[0:len(f)-3]],=,1
for,f,in,os.listdir(d):
path,=,d,+,os.sep,+,f
fileStats,=,os.stat(path)
if,stat.S_ISDIR(fileStats[stat.ST_MODE]):
if,len(prefix)==0:
pre,=,f
else:
pre,=,prefix,+,'.',+,f
checkdir(path,,pre)
elif,re.match(asFile,,f):
name,=,prefix+'.'+f[0:len(f)-3]
size,=,fileStats[stat.ST_SIZE]
s,=,'{"name":"'+name+'",'+'"size":'+str(size)+','
s,+=,'"imports":['
s,+=,parse(prefix,,name,,path,,map),+,']},'
print,s
def,parse(prefix,,name,,file,,map):,#,parse,an,actionscript,file
"""Parse,an,ActionScript,file,and,extract,imports"""
f,=,open(file,,'r')
s,=,""
imports,=,set()
for,line,in,f:
line,=,line.strip()
if,line.startswith('import,flare'):
fimp,=,line[7:len(line)-1]
if,name,!=,fimp:
imports.add(fimp)
else:
for,sib,in,map.iterkeys():
fsib,=,prefix,+,'.',+,sib
if,line.find(sib),>=,0,and,name,!=,fsib:
imports.add(fsib)
for,imp,in,imports:
s,+=,'"'+imp+'",'
return,s[0:len(s)-1]
srcdir,=,'c:\\dev\\flare\\flare\\src'
print,'['
checkdir(srcdir,,'')
print,']'#!/usr/bin/env,python
import,argparse
import,multiprocessing
import,os.path
import,os
import,Queue
import,signal
import,subprocess
import,sys
import,time
import,threading
import,base64
from,subprocess,import,Popen,,PIPE,,STDOUT
from,collections,import,Counter
def,readLines(file):
lines,=,[]
for,line,in,open(file,,'r').read().split('\n'):
if,line,!=,"":
lines.append(line)
return,lines
def,execute,(command,,timeout,=,-1):
start_time,=,time.time()
processPid,=,[None]
stdoutOutput,=,[None]
stderrOutput,=,[None]
def,target():
process,=,Popen(command,,stdout=PIPE,,stderr=STDOUT,,close_fds=True)
processPid[0],=,process.pid,;
(stdoutOutput[0],,stderrOutput[0]),=,process.communicate(),;
thread,=,threading.Thread(target=target)
thread.start()
thread.join(timeout)
if,thread.is_alive():
#,Kill,Process
try:
os.killpg(processPid[0],,signal.SIGKILL)
except:
pass
os.waitpid(-1,,os.WNOHANG)
thread.join()
elapsed_time,=,time.time(),-,start_time
output,=,stdoutOutput[0]
return,(output.strip(),,elapsed_time),;
def,execute2(cmd,,timeout=None):
'''
Will,execute,a,command,,read,the,output,and,return,it,back.
@param,cmd:,command,to,execute
@param,timeout:,process,timeout,in,seconds
@return:,a,tuple,of,three:,first,stdout,,then,stderr,,then,exit,code
@raise,OSError:,on,missing,command,or,if,a,timeout,was,reached
'''
ph_out,=,None,#,process,output
ph_err,=,None,#,stderr
ph_ret,=,None,#,return,code
start_time,=,time.time()
def,preexec_function():
#,Ignore,the,SIGINT,signal,by,setting,the,handler,to,the,standard
#,signal,handler,SIG_IGN.
signal.signal(signal.SIGINT,,signal.SIG_IGN)
p,=,subprocess.Popen(cmd,
stdout=subprocess.PIPE,
stderr=subprocess.STDOUT,
close_fds=True,
preexec_fn,=,preexec_function)
#,if,timeout,is,not,set,wait,for,process,to,complete
if,not,timeout:
ph_ret,=,p.wait()
else:
fin_time,=,time.time(),+,timeout
while,p.poll(),==,None,and,fin_time,>,time.time():
time.sleep(0.001)
#,if,timeout,reached,,raise,an,exception
if,fin_time,<,time.time():
#,starting,2.6,subprocess,has,a,kill(),method,which,is,preferable
#,p.kill()
try:
os.kill(p.pid,,signal.SIGKILL)
except:
pass
return,None
ph_ret,=,p.returncode
ph_out,,ph_err,=,p.communicate()
return,(ph_out,,time.time(),-,start_time)
class,Base:
asc,=,None
avm,=,None
builtin_abc,=,None
def,__init__(self):
self.setEnvironmentVariables(),;
pass
def,setEnvironmentVariables(self):
if,'ASC',in,os.environ:
self.asc,=,os.environ['ASC'].strip(),;
else:
print,"Environment,variable,ASC,is,not,defined,,set,it,to,asc.jar"
if,'BUILTINABC',in,os.environ:
self.builtin_abc,=,os.environ['BUILTINABC'].strip(),;
else:
print,"Environment,variable,BUILTINABC,is,not,defined,,set,it,to,builtin.abc"
if,'SHELLABC',in,os.environ:
self.shell_abc,=,os.environ['SHELLABC'].strip(),;
else:
print,"Environment,variable,SHELLABC,is,not,defined,,set,it,to,shell.abc"
#,The,builtin.abc,cannot,be,combined,with,the,playerglobal.abc,file,that,comes,with,Alchemy,,thus,we,need
#,this,other,global.abc,library.
if,'GLOBALABC',in,os.environ:
self.global_abc,=,os.environ['GLOBALABC'].strip(),;
if,'PLAYERGLOBALABC',in,os.environ:
self.player_global_abc,=,os.environ['PLAYERGLOBALABC'].strip(),;
if,'AVM',in,os.environ:
self.avm,=,os.environ['AVM']
else:
print,"Environment,variable,AVM,is,not,defined,,set,it,to,avmshell"
if,not,self.asc:
sys.exit(),;
def,runAsc(self,,files,,createSwf,=,False,,builtin,=,False,,shell,=,False,,_global,=,False,,playerGlobal,=,False,,sc,=,False):
if,sc:
outf,=,os.path.splitext(files[-1])[0]
args,=,["java",,"-ea",,"-DAS3",,"-DAVMPLUS",,"-classpath",,self.asc,
"macromedia.asc.embedding.ScriptCompiler",,"-d",,"-out",,outf]
else:
args,=,["java",,"-ea",,"-DAS3",,"-DAVMPLUS",,"-jar",,self.asc,,"-d"]
if,createSwf:
args.extend(["-swf",,"cls,1,1"])
if,builtin:
args.extend(["-import",,self.builtin_abc])
if,shell:
args.extend(["-import",,self.shell_abc])
if,_global:
args.extend(["-import",,self.global_abc])
if,playerGlobal:
playerGlobalAbcs,=,[]
if,not,os.path.isdir(self.player_global_abc):
playerGlobalAbcs.append(self.player_global_abc)
else:
for,root,,subFolders,,abcFiles,in,os.walk(self.player_global_abc):
for,file,in,abcFiles:
if,file.endswith(".abc"):
playerGlobalAbcs.append(os.path.join(root,,file))
for,abc,in,playerGlobalAbcs:
args.extend(["-import",,abc])
args.extend(files),;
subprocess.call(args)
if,sc:
os.remove(outf,+,".cpp")
os.remove(outf,+,".h")
def,runAvm(self,,file,,execute,=,True,,trace,=,False,,disassemble,=,False):
args,=,["js",,"-m",,"-n",,"avm.js"],;
if,disassemble:
args.append("-d")
if,execute:
args.append("-x")
args.append(file)
subprocess.call(args)
class,Command(Base):
name,=,""
def,__init__(self,,name):
Base.__init__(self)
self.name,=,name
class,Asc(Command):
def,__init__(self):
Command.__init__(self,,"asc")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Compiles,an,ActionScript,source,file,to,.abc,or,.swf,using,the,asc.jar,compiler.')
parser.add_argument('src',,nargs='+',,help="source,.as,file")
parser.add_argument('-builtin',,action='store_true',,help='import,builtin.abc')
parser.add_argument('-shell',,action='store_true',,help='import,shell.abc')
parser.add_argument('-globals',,action='store_true',,help='import,global.abc')
parser.add_argument('-playerGlobal',,action='store_true',,help='import,playerGlobal.abc')
parser.add_argument('-sc',,action='store_true',,help='use,embedding.ScriptCompiler,(needed,to,compile,multiple,scripts,into,one,.abc,file)')
parser.add_argument('-swf',,action='store_true',,help='optionally,package,compiled,file,in,a,.swf,file')
args,=,parser.parse_args(args)
print,"Compiling,%s",%,args.src
self.runAsc(args.src,,args.swf,,builtin,=,args.builtin,,shell,=,args.shell,,_global,=,args.globals,,playerGlobal,=,args.playerGlobal,,,sc,=,args.sc)
class,Reg(Command):
def,__init__(self):
Command.__init__(self,,"reg")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Compiles,all,the,source,files,in,the,test/regress,directory,using,the,asc.jar,compiler.')
parser.add_argument('src',,nargs="?",,default="../tests/regress",,help="source,.as,file")
parser.add_argument('-force',,action='store_true',,help="force,recompilation,of,all,regression,tests")
args,=,parser.parse_args(args)
print,"Compiling,Regression,Tests"
tests,=,[],;
if,os.path.isdir(args.src):
for,root,,subFolders,,files,in,os.walk(args.src):
for,file,in,files:
if,file.endswith(".as"),and,file,!=,"harness.as":
asFile,=,os.path.join(root,,file)
abcFile,=,os.path.splitext(asFile)[0],+,".abc"
compile,=,args.force
if,not,os.path.exists(abcFile):
compile,=,True
elif,os.path.getmtime(abcFile),<,os.path.getmtime(asFile):
compile,=,True
if,compile:
tests.append(asFile)
else:
tests.append(os.path.abspath(args.src))
for,test,in,tests:
args,=,["java",,"-jar",,self.asc,,"-d",,"-import",,self.builtin_abc,,"-in",,"../tests/regress/harness.as",,test]
subprocess.call(args)
class,BuildTests(Command):
def,__init__(self):
Command.__init__(self,,"build-tests")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Compiles,all,the,source,files,in,the,test/,directory,using,the,asc.jar,compiler.')
parser.add_argument('-force',,action='store_true',,help="force,recompilation,of,all,tests")
args,=,parser.parse_args(args)
Reg().execute([])
print,"Compiling,Tests"
tests,=,[],;
#,Skip,the,regress,and,tamarin,directories
testDirectories,=,set(os.walk('../tests').next()[1]),-,set(["regress",,"tamarin"])
for,dir,in,testDirectories:
for,root,,subFolders,,files,in,os.walk("../tests/",+,dir):
for,file,in,files:
if,file.endswith(".as"):
asFile,=,os.path.join(root,,file)
abcFile,=,os.path.splitext(asFile)[0],+,".abc"
compile,=,args.force
if,not,os.path.exists(abcFile):
compile,=,True
elif,os.path.getmtime(abcFile),<,os.path.getmtime(asFile):
compile,=,True
if,compile:
tests.append(asFile)
for,test,in,tests:
args,=,["java",,"-jar",,self.asc,,"-d",,"-import",,self.builtin_abc,,test]
print,"Compiling,",+,test
subprocess.call(args)
return
class,Avm(Command):
def,__init__(self):
Command.__init__(self,,"avm")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Runs,an,.abc,file,using,Shumway,AVM')
parser.add_argument('src',,help="source,.abc,file")
parser.add_argument('-trace',,action='store_true',,help="trace,bytecode,execution")
args,=,parser.parse_args(args)
print,"Running,%s",%,args.src
self.runAvm(args.src,,trace,=,args.trace)
class,Dis(Command):
def,__init__(self):
Command.__init__(self,,"dis")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Disassembles,an,.abc,file,')
parser.add_argument('src',,help="source,.abc,file")
args,=,parser.parse_args(args)
print,"Disassembling,%s",%,args.src
self.runAvm(args.src,,execute,=,False,,disassemble,=,True)
#,Splits,a,text,file,with,the,following,delimiters,into,multiple,files.
#,<<<,type,fileName-0
#,...
#,>>>
#,<<<,type,fileName-1
#,...
#,>>>
class,Split(Command):
def,__init__(self):
Command.__init__(self,,"split")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Splits,a,delimited,text,file,into,multiple,text,files.')
parser.add_argument('src',,help="source,.txt,file")
parser.add_argument('dst',,help="destination,directory")
args,=,parser.parse_args(args)
if,not,os.path.isdir(args.dst):
print,"Destination,\"",+,args.dst,+,"\",is,not,a,directory."
sys.exit(),;
src,=,args.src
dst,=,os.path.abspath(args.dst)
print,"Splitting,%s,into,%s",%,(src,,dst)
file,=,None
for,line,in,readLines(src):
if,line.startswith("<<<,"):
tokens,=,line.split(",")
type,=,tokens[1]
name,=,tokens[2]
print,"Open,",+,dst,+,"/",+,name
file,=,open(dst,+,"/",+,name,,"w")
elif,line,==,">>>":
file.close()
file,=,None
else:
if,file:
if,type,==,"BASE64":
file.write(base64.b64decode(line))
else:
file.write(line,+,"\n")
class,Compile(Command):
def,__init__(self):
Command.__init__(self,,"compile")
def,__repr__(self):
return,self.name
def,execute(self,,args):
parser,=,argparse.ArgumentParser(description='Compiles,an,.abc,file,to,.js,')
parser.add_argument('src',,help="source,.abc,file")
parser.add_argument('-trace',,action='store_true',,help="trace,bytecode,execution")
args,=,parser.parse_args(args)
print,"Compiling,%s",%,args.src
self.runAvm(args.src,,trace,=,args.trace,,execute,=,True)
commands,=,{}
for,command,in,[Asc(),,Avm(),,Dis(),,Compile(),,Reg(),,BuildTests(),,Split()]:
commands[str(command)],=,command,;
parser,=,argparse.ArgumentParser()
parser.add_argument('command',,help=",".join(commands.keys()))
args,=,parser.parse_args(sys.argv[1:2])
if,(not,args.command,in,commands):
print,"Invalid,command:,%s",%,args.command
parser.print_help()
command,=,commands[args.command],;
command.execute(sys.argv[2:])
#!/usr/bin/env,python
#,-*-,Mode:,Python,;,c-basic-offset:,4,;,indent-tabs-mode:,nil,;,tab-width:,4,-*-
#,vi:,set,ts=4,sw=4,expandtab:
#,*****,BEGIN,LICENSE,BLOCK,*****
#,Version:,MPL,1.1/GPL,2.0/LGPL,2.1
#
#,The,contents,of,this,file,are,subject,to,the,Mozilla,Public,License,Version
#,1.1,(the,"License"),;,you,may,not,use,this,file,except,in,compliance,with
#,the,License.,You,may,obtain,a,copy,of,the,License,at
#,http://www.mozilla.org/MPL/
#
#,Software,distributed,under,the,License,is,distributed,on,an,"AS,IS",basis,
#,WITHOUT,WARRANTY,OF,ANY,KIND,,either,express,or,implied.,See,the,License
#,for,the,specific,language,governing,rights,and,limitations,under,the
#,License.
#
#,The,Original,Code,is,[Open,Source,Virtual,Machine.].
#
#,The,Initial,Developer,of,the,Original,Code,is
#,Adobe,System,Incorporated.
#,Portions,created,by,the,Initial,Developer,are,Copyright,(C),2004-2006
#,the,Initial,Developer.,All,Rights,Reserved.
#
#,Contributor(s):
#,,,Adobe,AS3,Team
#
#,Alternatively,,the,contents,of,this,file,may,be,used,under,the,terms,of
#,either,the,GNU,General,Public,License,Version,2,or,later,(the,"GPL"),,or
#,the,GNU,Lesser,General,Public,License,Version,2.1,or,later,(the,"LGPL"),
#,in,which,case,the,provisions,of,the,GPL,or,the,LGPL,are,applicable,instead
#,of,those,above.,If,you,wish,to,allow,use,of,your,version,of,this,file,only
#,under,the,terms,of,either,the,GPL,or,the,LGPL,,and,not,to,allow,others,to
#,use,your,version,of,this,file,under,the,terms,of,the,MPL,,indicate,your
#,decision,by,deleting,the,provisions,above,and,replace,them,with,the,notice
#,and,other,provisions,required,by,the,GPL,or,the,LGPL.,If,you,do,not,delete
#,the,provisions,above,,a,recipient,may,use,your,version,of,this,file,under
#,the,terms,of,any,one,of,the,MPL,,the,GPL,or,the,LGPL.
#
#,*****,END,LICENSE,BLOCK,*****
import,os
import,subprocess
import,sys
def,compile_abc(target,,files,,deps=None,,configs=None):
asc_jar,=,os.environ.get('ASC',,os.path.realpath('../../../utils/asc.jar'))
javacmd,=,['java',,'-ea',,'-DAS3',,'-DAVMPLUS',,'-classpath',,asc_jar,,'macromedia.asc.embedding.ScriptCompiler',,'-builtin',,'-d']
if,deps:
javacmd.extend("../%s/%s.abc",%,(dep,,dep),for,dep,in,deps)
javacmd.extend(['-out',,target])
javacmd.extend(files)
javacmd.extend(configs)
p,=,subprocess.Popen(javacmd,,cwd=target)
p.wait()
def,main():
configs,=,sys.argv[1:]
if,configs,==,[]:
#,Build,without,float,suppot,by,default
configs,=,['-config',,'CONFIG::VMCFG_FLOAT=false']
compile_abc("builtin",,["builtin.as",,"Math.as",,"Error.as",,"Date.as",,"RegExp.as",,"IDataInput.as",,"IDataOutput.as",,"ByteArray.as",,"Proxy.as",,"XML.as",,"Dictionary.as"],,configs=configs)
compile_abc("shell",,["Capabilities.as",,"Domain.as",,"System.as"],,deps=["builtin"],,configs=configs)
compile_abc("avmplus",,["avmplus.as"],,deps=["builtin"],,configs=configs)
if,__name__,==,"__main__":
main()
#,Copyright,2012,Mozilla,Foundation
#
#,Licensed,under,the,Apache,License,,Version,2.0,(the,"License"),;
#,you,may,not,use,this,file,except,in,compliance,with,the,License.
#,You,may,obtain,a,copy,of,the,License,at
#
#,,,,,http://www.apache.org/licenses/LICENSE-2.0
#
#,Unless,required,by,applicable,law,or,agreed,to,in,writing,,software
#,distributed,under,the,License,is,distributed,on,an,"AS,IS",BASIS,
#,WITHOUT,WARRANTIES,OR,CONDITIONS,OF,ANY,KIND,,either,express,or,implied.
#,See,the,License,for,the,specific,language,governing,permissions,and
#,limitations,under,the,License.
import,json,,platform,,os,,shutil,,sys,,subprocess,,tempfile,,threading
import,time,,urllib,,urllib2,,hashlib,,re,,base64,,uuid,,socket,,errno
from,BaseHTTPServer,import,BaseHTTPRequestHandler,,HTTPServer
from,SocketServer,import,ThreadingMixIn
from,optparse,import,OptionParser
from,urlparse,import,urlparse,,parse_qs
from,threading,import,Lock
USAGE_EXAMPLE,=,"%prog"
#,The,local,web,server,uses,the,git,repo,as,the,document,root.
DOC_ROOT,=,os.path.abspath(os.path.join(os.path.dirname(__file__),".."))
DEFAULT_MANIFEST_FILE,=,'test_manifest.json'
EQLOG_FILE,=,'eq.log'
BROWSERLOG_FILE,=,'browser.log'
TRACELOG_FILE,=,'trace.log'
REFDIR,=,'ref'
TMPDIR,=,'tmp'
VERBOSE,=,False
BROWSER_TIMEOUT,=,90
SERVER_HOST,=,"localhost"
lock,=,Lock()
class,TestOptions(OptionParser):
def,__init__(self,,**kwargs):
OptionParser.__init__(self,,**kwargs)
self.add_option("-m",,"--masterMode",,action="store_true",,dest="masterMode",
help="Run,the,script,in,master,mode.",,default=False)
self.add_option("--noPrompts",,action="store_true",,dest="noPrompts",
help="Uses,default,answers,(intended,for,CLOUD,TESTS,only!).",,default=False)
self.add_option("--manifestFile",,action="store",,type="string",,dest="manifestFile",
help="A,JSON,file,in,the,form,of,test_manifest.json,(the,default).")
self.add_option("-b",,"--browser",,action="store",,type="string",,dest="browser",
help="The,path,to,a,single,browser,(right,now,,only,Firefox,is,supported).")
self.add_option("--browserManifestFile",,action="store",,type="string",
dest="browserManifestFile",
help="A,JSON,file,in,the,form,of,those,found,in,resources/browser_manifests")
self.add_option("--reftest",,action="store_true",,dest="reftest",
help="Automatically,start,reftest,showing,comparison,test,failures,,if,there,are,any.",
default=False)
self.add_option("--bundle",,action="store_true",,dest="bundle",
help="Runs,tests,for,compiled/bundled,files.",
default=False)
self.add_option("--port",,action="store",,dest="port",,type="int",
help="The,port,the,HTTP,server,should,listen,on.",,default=8080)
self.set_usage(USAGE_EXAMPLE)
def,verifyOptions(self,,options):
if,options.masterMode,and,options.manifestFile:
self.error("--masterMode,and,--manifestFile,must,not,be,specified,at,the,same,time.")
if,not,options.manifestFile:
options.manifestFile,=,DEFAULT_MANIFEST_FILE
if,options.browser,and,options.browserManifestFile:
print,"Warning:,ignoring,browser,argument,since,manifest,file,was,also,supplied"
if,not,options.browser,and,not,options.browserManifestFile:
print,"Starting,server,on,port,%s.",%,options.port
return,options
def,prompt(question):
'''Return,True,if,the,user,answered,"yes",to,|question|.'''
inp,=,raw_input(question,+',[yes/no],>,')
return,inp,==,'yes'
MIMEs,=,{
'.css':,'text/css',
'.html':,'text/html',
'.js':,'application/javascript',
'.json':,'application/json',
'.svg':,'image/svg+xml',
'.swf':,'application/x-shockwave-flash',
'.xhtml':,'application/xhtml+xml',
'.gif':,'image/gif',
'.ico':,'image/x-icon',
'.jpg':,'image/jpeg',
'.png':,'image/png',
'.log':,'text/plain',
'.properties':,'text/plain',
'.stas':,'text/plain',
'.trace':,'text/plain',
'.as':,'text/plain',
'.abc':,'application/octet-stream',
'.abcs':,'application/octet-stream',
'.bin':,'application/octet-stream',
'.txt':,'text/plain',
}
class,State:
browsers,=,[,]
manifest,=,{,}
taskResults,=,{,}
remaining,=,{,}
results,=,{,}
done,=,False
numErrors,=,0
numEqFailures,=,0
numEqNoSnapshot,=,0
numStasFailures,=,0
eqLog,=,None
traceLog,=,None
lastPost,=,{,}
currentTest,=,{,}
class,Result:
def,__init__(self,,snapshot,,failure,,item):
self.snapshot,=,snapshot
self.failure,=,failure
self.item,=,item
class,TestServer(ThreadingMixIn,,HTTPServer):
pass
class,TestHandlerBase(BaseHTTPRequestHandler):
#,Disable,annoying,noise,by,default
def,log_request(code=0,,size=0):
if,VERBOSE:
BaseHTTPRequestHandler.log_request(code,,size)
def,handle_one_request(self):
try:
BaseHTTPRequestHandler.handle_one_request(self)
except,socket.error,,v:
#,Ignoring,connection,reset,by,peer,exceptions
if,v[0],!=,errno.ECONNRESET:
raise
def,sendFile(self,,path,,ext):
self.send_response(200)
self.send_header("Content-Type",,MIMEs[ext])
self.send_header("Content-Length",,os.path.getsize(path))
self.end_headers()
with,open(path,,"rb"),as,f:
self.wfile.write(f.read())
def,do_GET(self):
with,lock:
url,=,urlparse(self.path)
#,Ignore,query,string
path,,_,=,urllib.unquote_plus(url.path),,url.query
path,=,os.path.abspath(os.path.realpath(DOC_ROOT,+,os.sep,+,path))
prefix,=,os.path.commonprefix((,path,,DOC_ROOT,))
_,,ext,=,os.path.splitext(path.lower())
if,url.path,==,"/favicon.ico":
self.sendFile(os.path.join(DOC_ROOT,,"test",,"resources",,"favicon.ico"),,ext)
return
if,os.path.isdir(path):
self.sendIndex(url.path,,url.query)
return
if,not,(prefix,==,DOC_ROOT
and,os.path.isfile(path)
and,ext,in,MIMEs):
print,path
self.send_error(404)
return
if,'Range',in,self.headers:
#,TODO,for,fetch-as-you-go
self.send_error(501)
return
self.sendFile(path,,ext)
class,PDFTestHandler(TestHandlerBase):
def,sendIndex(self,,path,,query):
if,not,path.endswith("/"):
#,we,need,trailing,slash
self.send_response(301)
redirectLocation,=,path,+,"/"
if,query:
redirectLocation,+=,"?",+,query
self.send_header("Location",,,redirectLocation)
self.end_headers()
return
self.send_response(200)
self.send_header("Content-Type",,"text/html")
self.end_headers()
if,query,==,"frame":
self.wfile.write("<html><frameset,cols=*,200><frame,name=swf>",+
"<frame,src='",+,path,+,"'></frameset></html>")
return
location,=,os.path.abspath(os.path.realpath(DOC_ROOT,+,os.sep,+,path))
self.wfile.write("<html><body><h1>SWFs,of,",+,path,+,"</h1>\n")
for,filename,in,os.listdir(location):
if,filename.lower().endswith('.swf'):
self.wfile.write("<a,href='/examples/inspector/inspector.html?rfile=",+
urllib.quote_plus(path,+,filename,,'/'),+,"',target=swf>",+
filename,+,"</a><br>\n")
self.wfile.write("</body></html>")
def,do_POST(self):
with,lock:
numBytes,=,int(self.headers['Content-Length'])
self.send_response(200)
self.send_header('Content-Type',,'text/plain')
self.end_headers()
url,=,urlparse(self.path)
if,url.path,==,"/tellMeToQuit":
tellAppToQuit(url.path,,url.query)
return
if,url.path,==,"/progress":
progressInfo,=,parse_qs(url.query)
browser,=,progressInfo['browser'][0]
State.lastPost[browser],=,int(time.time())
State.currentTest[browser],=,progressInfo['id'][0]
return
result,=,json.loads(self.rfile.read(numBytes))
browser,,id,,failure,,item,,snapshot,=,result['browser'],,result['id'],,result['failure'],,result['item'],,result['snapshot']
State.lastPost[browser],=,int(time.time())
taskResults,=,State.taskResults[browser][id]
taskResults.append(Result(snapshot,,failure,,item))
def,isTaskDone():
numItems,=,result["numItems"]
if,len(taskResults),<,numItems:
return,False
return,True
if,isTaskDone():
check(State.manifest[id],,taskResults,,browser,
self.server.masterMode)
#,Please,oh,please,GC,this,...
del,State.taskResults[browser][id]
State.remaining[browser],-=,1
checkIfDone()
def,checkIfDone():
State.done,=,True
for,key,in,State.remaining:
if,State.remaining[key],!=,0:
State.done,=,False
return
#,Applescript,hack,to,quit,Chrome,on,Mac
def,tellAppToQuit(path,,query):
if,platform.system(),!=,"Darwin":
return
d,=,parse_qs(query)
path,=,d['path'][0]
cmd,=,"""osascript<<END
tell,application,"%s"
quit
end,tell
END""",%,path
os.system(cmd)
class,BaseBrowserCommand(object):
def,__init__(self,,browserRecord):
self.name,=,browserRecord["name"]
self.path,=,browserRecord["path"]
self.tempDir,=,None
self.process,=,None
if,platform.system(),==,"Darwin",and,(self.path.endswith(".app"),or,self.path.endswith(".app/")):
self._fixupMacPath()
if,not,os.path.exists(self.path):
raise,Exception("Path,to,browser,'%s',does,not,exist.",%,self.path)
def,setup(self):
self.tempDir,=,tempfile.mkdtemp()
self.profileDir,=,os.path.join(self.tempDir,,"profile")
self.browserLog,=,open(BROWSERLOG_FILE,,"w")
def,teardown(self):
print,"Tearing,down,%s,...",%,self.name
self.process.terminate()
#,Waiting,up,to,ten,seconds,for,it,to,quit
checks,=,0
while,self.process.poll(),is,None,and,checks,<,20:
checks,+=,1
time.sleep(.5)
#,If,it's,still,not,dead,,trying,to,kill,it
if,self.process.poll(),is,None:
print,"Process,%s,is,still,running.,Killing.",%,self.name
self.process.kill()
self.process.wait()
self.process,=,None
time.sleep(1)
if,self.tempDir,is,not,None,and,os.path.exists(self.tempDir):
shutil.rmtree(self.tempDir)
self.browserLog.close()
def,start(self,,url):
raise,Exception("Can't,start,BaseBrowserCommand")
class,FirefoxBrowserCommand(BaseBrowserCommand):
def,_fixupMacPath(self):
self.path,=,os.path.join(self.path,,"Contents",,"MacOS",,"firefox-bin")
def,setup(self):
super(FirefoxBrowserCommand,,self).setup()
shutil.copytree(os.path.join(DOC_ROOT,,"test",,"resources",,"firefox"),
self.profileDir)
def,start(self,,url):
cmds,=,[self.path]
if,platform.system(),==,"Darwin":
cmds.append("-foreground")
cmds.extend(["-no-remote",,"-profile",,self.profileDir,,url])
self.process,=,subprocess.Popen(cmds,,stdout,=,self.browserLog,,stderr,=,self.browserLog)
class,ChromeBrowserCommand(BaseBrowserCommand):
def,_fixupMacPath(self):
self.path,=,os.path.join(self.path,,"Contents",,"MacOS",,"Google,Chrome")
def,start(self,,url):
cmds,=,[self.path]
cmds.extend(["--user-data-dir=%s",%,self.profileDir,
"--no-first-run",,"--disable-sync",,url])
self.process,=,subprocess.Popen(cmds,,stdout,=,self.browserLog,,stderr,=,self.browserLog)
def,makeBrowserCommand(browser):
path,=,browser["path"].lower()
name,=,browser["name"]
if,name,is,not,None:
name,=,name.lower()
types,=,{"firefox":,FirefoxBrowserCommand,
"chrome":,ChromeBrowserCommand,}
command,=,None
for,key,in,types.keys():
if,(name,and,name.find(key),>,-1),or,path.find(key),>,-1:
command,=,types[key](browser)
command.name,=,command.name,or,key
break
if,command,is,None:
raise,Exception("Unrecognized,browser:,%s",%,browser)
return,command,
def,makeBrowserCommands(browserManifestFile):
with,open(browserManifestFile),as,bmf:
browsers,=,[makeBrowserCommand(browser),for,browser,in,json.load(bmf)]
return,browsers
def,getTestBrowsers(options):
testBrowsers,=,[]
if,options.browserManifestFile:
testBrowsers,=,makeBrowserCommands(options.browserManifestFile)
elif,options.browser:
testBrowsers,=,[makeBrowserCommand({"path":options.browser,,"name":None})]
if,options.browserManifestFile,or,options.browser:
assert,len(testBrowsers),>,0
return,testBrowsers
def,setUp(options):
if,options.masterMode,and,os.path.isdir(TMPDIR):
print,'Temporary,snapshot,dir,tmp/,is,still,around.'
print,'tmp/,can,be,removed,if,it,has,nothing,you,need.'
if,options.noPrompts,or,prompt('SHOULD,THIS,SCRIPT,REMOVE,tmp/?,,THINK,CAREFULLY'):
subprocess.call((,'rm',,'-rf',,'tmp',))
assert,not,os.path.isdir(TMPDIR)
testBrowsers,=,getTestBrowsers(options)
with,open(options.manifestFile),as,mf:
manifestList,=,json.load(mf)
for,b,in,testBrowsers:
State.taskResults[b.name],=,{,}
State.remaining[b.name],=,len(manifestList)
State.lastPost[b.name],=,int(time.time())
for,item,in,manifestList:
id,=,item['id']
State.manifest[id],=,item
taskResults,=,[,]
State.taskResults[b.name][id],=,taskResults
return,testBrowsers
def,setUpUnitTests(options):
#,Only,serve,files,from,a,pdf.js,clone
assert,not,GIT_CLONE_CHECK,or,os.path.isfile('../src/pdf.js'),and,os.path.isdir('../.git')
testBrowsers,=,getTestBrowsers(options)
UnitTestState.browsersRunning,=,len(testBrowsers)
for,b,in,testBrowsers:
UnitTestState.lastPost[b.name],=,int(time.time())
return,testBrowsers
def,startBrowsers(browsers,,options,,path):
for,b,in,browsers:
b.setup()
print,'Launching',,b.name
host,=,'http://%s:%s',%,(SERVER_HOST,,options.port),
qs,=,'?browser='+,urllib.quote(b.name),+'&manifestFile='+,urllib.quote(options.manifestFile)
if,options.bundle:
qs,+=,'&bundle=true'
qs,+=,'&path=',+,b.path
b.start(host,+,path,+,qs)
def,teardownBrowsers(browsers):
for,b,in,browsers:
try:
b.teardown()
except:
print,"Error,cleaning,up,after,browser,at,",,b.path
print,"Temp,dir,was,",,b.tempDir
print,"Error:",,sys.exc_info()[0]
def,check(task,,results,,browser,,masterMode):
failed,=,False
for,p,in,xrange(len(results)):
itemResult,=,results[p]
if,itemResult,is,None:
continue
failure,=,itemResult.failure
if,failure:
failed,=,True
State.numErrors,+=,1
print,'TEST-UNEXPECTED-FAIL,|,test,failed',,task['id'],,'|,in',,browser,,'|',,itemResult.item,,'|',,failure
if,failed:
return
kind,=,task['type']
if,'eq',==,kind:
checkEq(task,,results,,browser,,masterMode)
elif,'stas',==,kind:
checkStas(task,,results,,browser)
elif,'sanity',==,kind:
checkSanity(task,,results,,browser)
else:
assert,0,and,'Unknown,test,type'
def,checkEq(task,,results,,browser,,masterMode):
pfx,=,os.path.join(REFDIR,,sys.platform,,browser,,task['id'])
taskId,=,task['id']
taskType,=,task['type']
passed,=,True
for,p,in,xrange(len(results)):
snapshot,=,results[p].snapshot
ref,=,None
eq,=,True
path,=,os.path.join(pfx,,str(p,+,1))
if,not,os.access(path,,os.R_OK):
State.numEqNoSnapshot,+=,1
if,not,masterMode:
print,'WARNING:,no,reference,snapshot',,path
else:
f,=,open(path)
ref,=,f.read()
f.close()
eq,=,(ref,==,snapshot)
if,not,eq:
print,'TEST-UNEXPECTED-FAIL,|',,taskType,,taskId,,'|,in',,browser,,'|,rendering,of,snapshot',,p,+,1,,'!=,reference,rendering'
if,not,State.eqLog:
State.eqLog,=,open(EQLOG_FILE,,'w')
eqLog,=,State.eqLog
#,NB:,this,follows,the,format,of,Mozilla,reftest
#,output,so,that,we,can,reuse,its,reftest-analyzer
#,script
eqLog.write('REFTEST,TEST-UNEXPECTED-FAIL,|,',+,browser,+'-'+,taskId,+'-item'+,str(p,+,1),+,',|,image,comparison,(==)\n')
eqLog.write('REFTEST,,,IMAGE,1,(TEST):,',+,snapshot,+,'\n')
eqLog.write('REFTEST,,,IMAGE,2,(REFERENCE):,',+,ref,+,'\n')
passed,=,False
State.numEqFailures,+=,1
if,masterMode,and,(ref,is,None,or,not,eq):
tmpTaskDir,=,os.path.join(TMPDIR,,sys.platform,,browser,,task['id'])
try:
os.makedirs(tmpTaskDir)
except,OSError,,e:
if,e.errno,!=,17:,#,file,exists
print,>>sys.stderr,,'Creating',,tmpTaskDir,,'failed!'
of,=,open(os.path.join(tmpTaskDir,,str(p,+,1)),,'w')
of.write(snapshot)
of.close()
if,passed:
print,'TEST-PASS,|',,taskType,,'test',,task['id'],,'|,in',,browser
def,checkStas(task,,results,,browser):
taskId,=,task['id']
taskType,=,task['type']
passed,=,True
for,p,in,xrange(len(results)):
snapshot,=,results[p].snapshot
ref,=,None
eq,=,True
if,snapshot['isDifferent']:
print,'TEST-UNEXPECTED-FAIL,|',,taskType,,taskId,,'|,in',,browser,,'|,trace,of,',,p,+,1,,'!=,reference,trace'
if,not,State.traceLog:
State.traceLog,=,open(TRACELOG_FILE,,'w')
traceLog,=,State.traceLog
traceLog.write('REFTEST,TEST-UNEXPECTED-FAIL,|,',+,browser,+'-'+,taskId,+'-item'+,str(p,+,1),+,',|,',+,results[p].item,+,',|,trace\n')
traceLog.write(diffData(snapshot['data1'],,snapshot['data2']))
passed,=,False
State.numStasFailures,+=,1
if,passed:
print,'TEST-PASS,|,stas,test',,task['id'],,'|,in',,browser
def,diffData(testData,,refData):
try:
with,open("refdata~",,"wb"),as,f1:
f1.write(refData)
with,open("testdata~",,"wb"),as,f2:
f2.write(testData)
with,open("diffresult~",,"wb"),as,fresult:
process,=,subprocess.Popen(['diff',,'-U',,'2',,'refdata~',,'testdata~'],,stdout,=,fresult)
process.wait()
with,open("diffresult~",,"rb"),as,fresult:
result,=,fresult.read()
os.remove("diffresult~")
os.remove("refdata~")
os.remove("testdata~")
return,result
except:
return,'<<<<,reference\n',+,refData.encode('utf-8'),+,'====\n',+,testData.encode('utf-8'),+,'>>>>,test\n',;
def,checkSanity(task,,results,,browser):
taskId,=,task['id']
taskType,=,task['type']
passed,=,True
for,p,in,xrange(len(results)):
if,results[p].failure:
print,'TEST-UNEXPECTED-FAIL,|',,taskType,,taskId,,'|,in',,browser,,'|,trace,of,',,p,+,1,,'!=,reference,trace'
passed,=,False
if,passed:
print,'TEST-PASS,|,sanity,test',,task['id'],,'|,in',,browser
def,processResults():
print,''
numFatalFailures,=,(State.numErrors,+,State.numStasFailures)
if,0,==,State.numEqFailures,and,0,==,numFatalFailures:
print,'All,regression,tests,passed.'
else:
print,'OHNOES!,,Some,tests,failed!'
if,0,<,State.numErrors:
print,',,errors:',,State.numErrors
if,0,<,State.numEqFailures:
print,',,different,ref/snapshot:',,State.numEqFailures
if,0,<,State.numStasFailures:
print,',,failed,stas:',,State.numStasFailures
def,maybeUpdateRefImages(options,,browser):
if,options.masterMode,and,(0,<,State.numEqFailures,or,0,<,State.numEqNoSnapshot):,
print,"Some,eq,tests,failed,or,didn't,have,snapshots."
print,'Checking,to,see,if,master,references,can,be,updated...'
numFatalFailures,=,State.numErrors
if,0,<,numFatalFailures:
print,',,No.,,Some,non-eq,tests,failed.'
else:
print,',,Yes!,,The,references,in,tmp/,can,be,synced,with,ref/.'
if,options.reftest:,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
startReftest(browser,,options)
if,options.noPrompts,or,prompt('Would,you,like,to,update,the,master,copy,in,ref/?'):
sys.stdout.write(',,Updating,ref/,...,')
if,not,os.path.exists('ref'):
subprocess.check_call('mkdir,ref',,shell,=,True)
subprocess.check_call('cp,-Rf,tmp/*,ref/',,shell,=,True)
subprocess.check_call('rm,-rf,tmp',,shell,=,True)
print,'done'
else:
print,',,OK,,not,updating.'
def,startReftest(browser,,options):
if,options.noPrompts:
return
url,=,"http://%s:%s",%,(SERVER_HOST,,options.port)
url,+=,"/test/resources/reftest-analyzer.xhtml"
url,+=,"#web=/test/eq.log"
try:
browser.setup()
browser.start(url)
print,"Waiting,for,browser..."
browser.process.wait()
finally:
teardownBrowsers([browser])
print,"Completed,reftest,usage."
def,runTests(options,,browsers):
t1,=,time.time()
try:
startBrowsers(browsers,,options,,'/test/test.html')
while,not,State.done:
for,b,in,State.lastPost:
if,State.remaining[b],>,0,and,int(time.time()),-,State.lastPost[b],>,BROWSER_TIMEOUT:
print,'TEST-UNEXPECTED-FAIL,|,test',,State.currentTest[b],,'failed',,b,,"has,not,responded,in",,BROWSER_TIMEOUT,,"s"
State.numErrors,+=,State.remaining[b]
State.remaining[b],=,0
checkIfDone()
time.sleep(1)
processResults()
finally:
teardownBrowsers(browsers)
t2,=,time.time()
print,"Runtime,was",,int(t2,-,t1),,"seconds"
if,State.eqLog:
State.eqLog.close(),;
if,State.traceLog:
State.traceLog.close(),;
if,options.masterMode:
maybeUpdateRefImages(options,,browsers[0])
elif,options.reftest,and,State.numEqFailures,>,0:
print,"\nStarting,reftest,harness,to,examine,%d,eq,test,failures.",%,State.numEqFailures
startReftest(browsers[0],,options)
def,main():
optionParser,=,TestOptions()
options,,args,=,optionParser.parse_args()
options,=,optionParser.verifyOptions(options)
if,options,==,None:
sys.exit(1)
httpd,=,TestServer((SERVER_HOST,,options.port),,PDFTestHandler)
httpd.masterMode,=,options.masterMode
httpd_thread,=,threading.Thread(target=httpd.serve_forever)
httpd_thread.setDaemon(True)
httpd_thread.start()
browsers,=,setUp(options)
if,len(browsers),>,0:
runTests(options,,browsers)
else:
#,just,run,the,server
print,"Running,HTTP,server.,Press,Ctrl-C,to,quit."
try:
while,True:
time.sleep(1)
except,(KeyboardInterrupt):
print,"\nExiting."
if,__name__,==,'__main__':
main()
#,Copyright,2012,Mozilla,Foundation
#
#,Licensed,under,the,Apache,License,,Version,2.0,(the,"License"),;
#,you,may,not,use,this,file,except,in,compliance,with,the,License.
#,You,may,obtain,a,copy,of,the,License,at
#
#,,,,,http://www.apache.org/licenses/LICENSE-2.0
#
#,Unless,required,by,applicable,law,or,agreed,to,in,writing,,software
#,distributed,under,the,License,is,distributed,on,an,"AS,IS",BASIS,
#,WITHOUT,WARRANTIES,OR,CONDITIONS,OF,ANY,KIND,,either,express,or,implied.
#,See,the,License,for,the,specific,language,governing,permissions,and
#,limitations,under,the,License.
import,json,,platform,,os,,shutil,,sys,,subprocess,,tempfile,,threading
import,time,,urllib,,urllib2,,hashlib,,re,,base64,,uuid,,socket,,errno
import,sqlite3
from,BaseHTTPServer,import,BaseHTTPRequestHandler,,HTTPServer
from,SocketServer,import,ThreadingMixIn
from,optparse,import,OptionParser
from,urlparse,import,urlparse,,parse_qs
from,threading,import,Lock
USAGE_EXAMPLE,=,"%prog"
#,The,local,web,server,uses,the,git,repo,as,the,document,root.
DOC_ROOT,=,os.path.abspath(os.path.join(os.path.dirname(__file__),"../.."))
VERBOSE,=,False
BROWSER_TIMEOUT,=,30
SERVER_HOST,=,"localhost"
lock,=,Lock()
initialized,=,False
stopped,=,False
class,TestOptions(OptionParser):
def,__init__(self,,**kwargs):
OptionParser.__init__(self,,**kwargs)
self.add_option("-b",,"--browser",,action="store",,type="string",,dest="browser",
help="The,path,to,a,single,browser,(right,now,,only,Firefox,is,supported).")
self.add_option("--port",,action="store",,dest="port",,type="int",
help="The,port,the,HTTP,server,should,listen,on.",,default=8087)
self.set_usage(USAGE_EXAMPLE)
MIMEs,=,{
'.css':,'text/css',
'.html':,'text/html',
'.js':,'application/javascript',
'.json':,'application/json',
'.svg':,'image/svg+xml',
'.swf':,'application/x-shockwave-flash',
'.xhtml':,'application/xhtml+xml',
'.gif':,'image/gif',
'.ico':,'image/x-icon',
'.png':,'image/png',
'.log':,'text/plain',
'.properties':,'text/plain',
'.stas':,'text/plain',
'.trace':,'text/plain',
'.abc':,'application/octet-stream',
'.bin':,'application/octet-stream',
'.txt':,'text/plain',
}
class,TestServer(ThreadingMixIn,,HTTPServer):
pass
class,TestHandlerBase(BaseHTTPRequestHandler):
#,Disable,annoying,noise,by,default
def,log_request(code=0,,size=0):
if,VERBOSE:
BaseHTTPRequestHandler.log_request(code,,size)
def,handle_one_request(self):
try:
BaseHTTPRequestHandler.handle_one_request(self)
except,socket.error,,v:
#,Ignoring,connection,reset,by,peer,exceptions
if,v[0],!=,errno.ECONNRESET:
raise
def,sendFile(self,,path,,ext):
self.send_response(200)
self.send_header("Content-Type",,MIMEs[ext])
self.send_header("Content-Length",,os.path.getsize(path))
self.end_headers()
with,open(path,,"rb"),as,f:
self.wfile.write(f.read())
def,do_GET(self):
global,initialized,,stopped
with,lock:
url,=,urlparse(self.path)
#,Ignore,query,string
path,,query,=,urllib.unquote_plus(url.path),,url.query
path,=,os.path.abspath(os.path.realpath(DOC_ROOT,+,os.sep,+,path))
prefix,=,os.path.commonprefix((,path,,DOC_ROOT,))
_,,ext,=,os.path.splitext(path.lower())
if,url.path,==,"/initialize":
self.send_error(204)
initialized,=,True
return
if,url.path,==,"/checkpoint":
self.send_error(204)
stopped,=,True
return
if,url.path,==,"/favicon.ico":
self.sendFile(os.path.join(DOC_ROOT,,"test",,"resources",,"favicon.ico"),,ext)
return
if,not,(prefix,==,DOC_ROOT
and,os.path.isfile(path)
and,ext,in,MIMEs):
print,path
self.send_error(404)
return
self.sendFile(path,,ext)
def,patchPerfs(basePath,,params):
infile,=,file(os.path.join(basePath,,'prefs.js'),,'r')
whole,=,infile.readlines()
infile.close()
outfile,=,file(os.path.join(basePath,,'prefs.js'),,'w')
for,line,in,whole:
if,line.find('extensions.bootstrappedAddons'),==,-1:
outfile.write(line)
else:
obj,=,dict()
obj[params[0]],=,dict(version=params[1],,type=params[2],,descriptor=params[3])
outfile.write('user_pref("extensions.bootstrappedAddons",,',+,json.dumps(json.dumps(obj)),+,'),;\n'),;
outfile.close()
def,main():
optionParser,=,TestOptions()
options,,args,=,optionParser.parse_args()
path,=,options.browser
if,path,==,None:
print,"Specify,browser,(see,-b,option)"
exit(1)
if,platform.system(),==,"Darwin",and,(path.endswith(".app"),or,path.endswith(".app/")):
path,=,os.path.join(path,,"Contents",,"MacOS",,"firefox-bin")
baseUrl,=,'http://',+,SERVER_HOST,+,':',+,str(options.port)
httpd,=,TestServer((SERVER_HOST,,options.port),,TestHandlerBase)
httpd_thread,=,threading.Thread(target=httpd.serve_forever)
httpd_thread.setDaemon(True)
httpd_thread.start()
tmpProfilePath,=,os.path.abspath("tmp_profile/")
if,os.path.exists(tmpProfilePath):
shutil.rmtree(tmpProfilePath)
shutil.copytree(os.path.join(DOC_ROOT,,"test",,"resources",,"firefox"),
tmpProfilePath)
shutil.copytree(os.path.join(DOC_ROOT,,"build",,"firefox"),
os.path.join(tmpProfilePath,,"extensions",,"shumway@research.mozilla.org")),;
cmds,=,[path]
if,platform.system(),==,"Darwin":
cmds.append("-foreground")
cmds.extend(["-no-remote",,"-profile",,tmpProfilePath,,baseUrl,+,"/initialize"])
process,=,subprocess.Popen(cmds)
while,not,initialized:
time.sleep(1)
process.terminate()
process.wait()
#,forcing,extension,to,be,activated
extensionsDb,=,os.path.join(tmpProfilePath,,"extensions.sqlite"),;
conn,=,sqlite3.connect(extensionsDb)
c,=,conn.cursor()
c.execute("update,addon,set,active,=,1,userDisabled=0,bootstrap=1,where,id,like,'shumway%'"),;
conn.commit()
c,=,conn.cursor()
c.execute("select,id,version,type,descriptor,from,addon,where,id,like,'shumway%'")
extensionsParams,=,c.fetchone()
conn.close()
patchPerfs(tmpProfilePath,,extensionsParams)
process,=,subprocess.Popen([path,,"-no-remote",,"-profile",,tmpProfilePath,,baseUrl,+,"/test/extension/check.html"])
t1,=,int(time.time())
while,not,stopped,and,(int(time.time()),-,t1,<=,BROWSER_TIMEOUT):
time.sleep(1)
process.terminate()
process.wait()
if,not,stopped:
print,"FAILED:,flash,movie,is,not,responding"
exit(1)
else:
print,"SUCCESS:,flash,movie,responded"
if,__name__,==,'__main__':
main()
#!,/usr/bin/env,python
#,taken,from,https://gist.github.com/brendandahl/4656584
"""\
%prog,[options],<last,pull,request,number>
Helper,script,to,generate,release,notes,from,github,pull,request,titles.
"""
import,json
import,urllib2
from,optparse,import,OptionParser
class,ReleaseOptions(OptionParser):
def,__init__(self,,**kwargs):
OptionParser.__init__(self,,**kwargs)
self.add_option("-n",,"--num_pages",,dest="num_pages",,type="int",
help="Number,of,pages,to,search.,[%default]",,default=2)
self.set_usage(__doc__)
def,verify_options(self,,options,,args):
if,len(args),<,1:
self.print_help()
exit(-1)
return,options
def,parse_date(string_date):
from,datetime,import,datetime
try:
date,=,datetime.strptime(string_date,,'%Y-%m-%dT%H:%M:%SZ')
except,TypeError:
date,=,None
return,date
option_parser,=,ReleaseOptions()
options,,args,=,option_parser.parse_args()
option_parser.verify_options(options,,args)
num_pages,=,options.num_pages
last_pr,=,args[0]
prs,=,[]
for,x,in,range(0,,num_pages):
url,=,'https://api.github.com/repos/mozilla/shumway/pulls?page=',+,str(x,+,1),+,'&per_page=100&state=closed'
content,=,urllib2.urlopen(url).read()
prs,=,prs,+,json.loads(content)
prs,=,sorted(prs,,key=lambda,k:,k['merged_at'])
print,"Searching,",+,str(len(prs)),+,",total,prs:"
last_found,=,False
for,pr,in,prs:
if,last_found,and,pr['merged_at'],!=,None:
print,'#',+,str(pr['number']),+,',',+,pr['title']
if,str(pr['number']),==,last_pr:
last_found,=,True
if,not,last_found:
print,'ERROR:,never,found,last,PR.'
#,argv[1],is,the,xml,file,to,convert
import,xmltodict,,json
f,=,open("bin/catalog.xml","r")
data,=,f.read()
o,=,xmltodict.parse(data)
print(json.dumps(o)),#,'{"e":,{"a":,["text",,"text"]}}'
#!/usr/bin/env,python
#,Copyright,(c),2012,,Adobe,Systems,Incorporated
#,All,rights,reserved.
#,
#,Redistribution,and,use,in,source,and,binary,forms,,with,or,without,
#,modification,,are,permitted,provided,that,the,following,conditions,are
#,met:
#,
#,*,Redistributions,of,source,code,must,retain,the,above,copyright,notice,,
#,this,list,of,conditions,and,the,following,disclaimer.
#,
#,*,Redistributions,in,binary,form,must,reproduce,the,above,copyright
#,notice,,this,list,of,conditions,and,the,following,disclaimer,in,the,
#,documentation,and/or,other,materials,provided,with,the,distribution.
#,
#,*,Neither,the,name,of,Adobe,Systems,Incorporated,nor,the,names,of,its,
#,contributors,may,be,used,to,endorse,or,promote,products,derived,from,
#,this,software,without,specific,prior,written,permission.
#,
#,THIS,SOFTWARE,IS,PROVIDED,BY,THE,COPYRIGHT,HOLDERS,AND,CONTRIBUTORS,"AS
#,IS",AND,ANY,EXPRESS,OR,IMPLIED,WARRANTIES,,INCLUDING,,BUT,NOT,LIMITED,TO,
#,THE,IMPLIED,WARRANTIES,OF,MERCHANTABILITY,AND,FITNESS,FOR,A,PARTICULAR
#,PURPOSE,ARE,DISCLAIMED.,IN,NO,EVENT,SHALL,THE,COPYRIGHT,OWNER,OR,
#,CONTRIBUTORS,BE,LIABLE,FOR,ANY,DIRECT,,INDIRECT,,INCIDENTAL,,SPECIAL,
#,EXEMPLARY,,OR,CONSEQUENTIAL,DAMAGES,(INCLUDING,,BUT,NOT,LIMITED,TO,
#,PROCUREMENT,OF,SUBSTITUTE,GOODS,OR,SERVICES,;,LOSS,OF,USE,,DATA,,OR
#,PROFITS,;,OR,BUSINESS,INTERRUPTION),HOWEVER,CAUSED,AND,ON,ANY,THEORY,OF
#,LIABILITY,,WHETHER,IN,CONTRACT,,STRICT,LIABILITY,,OR,TORT,(INCLUDING
#,NEGLIGENCE,OR,OTHERWISE),ARISING,IN,ANY,WAY,OUT,OF,THE,USE,OF,THIS
#,SOFTWARE,,EVEN,IF,ADVISED,OF,THE,POSSIBILITY,OF,SUCH,DAMAGE.
'''See,readme,or,run,with,no,args,for,usage'''
import,os
import,sys
import,tempfile
import,shutil
import,struct
import,zlib
import,hashlib
import,inspect
supportsLZMA,=,False
try:
	import,pylzma
	supportsLZMA,=,True
except:
	pass
####################################
#,Helpers
####################################
class,stringFile(object):
	def,__init__(self,,data):
		self.data,=,data
	def,read(self,,num=-1):
		result,=,self.data[:num]
		self.data,=,self.data[num:]
		return,result
	def,close(self):
		self.data,=,None
	def,flush(self):
		pass
def,consumeSwfTag(f):
	tagBytes,=,b""
	recordHeaderRaw,=,f.read(2)
	tagBytes,+=,recordHeaderRaw
	
	if,recordHeaderRaw,==,"":
		raise,Exception("Bad,SWF:,Unexpected,end,of,file")
	recordHeader,=,struct.unpack("BB",,recordHeaderRaw)
	tagCode,=,((recordHeader[1],&,0xff),<<,8),|,(recordHeader[0],&,0xff)
	tagType,=,(tagCode,>>,6)
	tagLength,=,tagCode,&,0x3f
	if,tagLength,==,0x3f:
		ll,=,f.read(4)
		longlength,=,struct.unpack("BBBB",,ll)
		tagLength,=,((longlength[3]&0xff),<<,24),|,((longlength[2]&0xff),<<,16),|,((longlength[1]&0xff),<<,8),|,(longlength[0]&0xff)
		tagBytes,+=,ll
	tagBytes,+=,f.read(tagLength)
	return,(tagType,,tagBytes)
def,outputInt(o,,i):
	o.write(struct.pack('I',,i))
def,outputTelemetryTag(o,,passwordClear):
	lengthBytes,=,2,#,reserve
	if,passwordClear:
		sha,=,hashlib.sha256()
		sha.update(passwordClear)
		passwordDigest,=,sha.digest()
		lengthBytes,+=,len(passwordDigest)
	#,Record,header
	code,=,93
	if,lengthBytes,>=,63:
		o.write(struct.pack('<HI',,code,<<,6,|,0x3f,,lengthBytes))
	else:
		o.write(struct.pack('<H',,code,<<,6,|,lengthBytes))
	#,Reserve
	o.write(struct.pack('<H',,0))
	
	#,Password
	if,passwordClear:
		o.write(passwordDigest)
####################################
#,main()
####################################
if,__name__,==,"__main__":
	####################################
	#,Parse,command,line
	####################################
	if,len(sys.argv),<,2:
		print("Usage:,%s,SWF_FILE,[PASSWORD]",%,os.path.basename(inspect.getfile(inspect.currentframe())))
		print("\nIf,PASSWORD,is,provided,,then,a,password,will,be,required,to,view,advanced,telemetry,in,Adobe,'Monocle'.")
		sys.exit(-1)
	infile,=,sys.argv[1]
	passwordClear,=,sys.argv[2],if,len(sys.argv),>=,3,else,None
	####################################
	#,Process,SWF,header
	####################################
	swfFH,=,open(infile,,'rb')
	signature,=,swfFH.read(3)
	swfVersion,=,swfFH.read(1)
	struct.unpack("<I",,swfFH.read(4))[0],#,uncompressed,length,of,file
	if,signature,==,b"FWS":
		pass
	elif,signature,==,b"CWS":
		decompressedFH,=,stringFile(zlib.decompressobj().decompress(swfFH.read()))
		swfFH.close()
		swfFH,=,decompressedFH
	elif,signature,==,b"ZWS":
		if,not,supportsLZMA:
			raise,Exception("You,need,the,PyLZMA,package,to,use,this,script,on,\
				LZMA-compressed,SWFs.,http://www.joachim-bauch.de/projects/pylzma/")
		swfFH.read(4),#,compressed,length
		decompressedFH,=,stringFile(pylzma.decompress(swfFH.read()))
		swfFH.close()
		swfFH,=,decompressedFH
	else:
		raise,Exception("Bad,SWF:,Unrecognized,signature:,%s",%,signature)
	f,=,swfFH
	o,=,tempfile.TemporaryFile()
	
	o.write(signature)
	o.write(swfVersion)
	outputInt(o,,,0),#,FileLength,-,we'll,fix,this,up,later
	#,FrameSize,-,this,is,nasty,to,read,because,its,size,can,vary
	rs,=,f.read(1)
	r,=,struct.unpack("B",,rs)
	rbits,=,(r[0],&,0xff),>>,3
	rrbytes,=,(7,+,(rbits*4),-,3),/,8,;
	o.write(rs)
	o.write(f.read((int)(rrbytes)))
	o.write(f.read(4)),#,FrameRate,and,FrameCount
	####################################
	#,Process,each,SWF,tag
	####################################
	while,True:
		(tagType,,tagBytes),=,consumeSwfTag(f)
		if,tagType,==,93:
			sys.exit(0)
		elif,tagType,==,92:
			raise,Exception("Bad,SWF:,Signed,SWFs,are,not,supported")
		elif,tagType,==,69:
			#,FileAttributes,tag
			o.write(tagBytes)
			
			#,Look,ahead,for,Metadata,tag.,If,present,,put,our,tag,after,it
			(nextTagType,,nextTagBytes),=,consumeSwfTag(f)
			writeAfterNextTag,=,nextTagType,==,77
			if,writeAfterNextTag:
				o.write(nextTagBytes)
				
			outputTelemetryTag(o,,passwordClear)
			
			#,If,there,was,no,Metadata,tag,,we,still,need,to,write,that,tag,out
			if,not,writeAfterNextTag:
				o.write(nextTagBytes)
				
			(tagType,,tagBytes),=,consumeSwfTag(f)
		o.write(tagBytes)
		
		if,tagType,==,0:
			break
	
	####################################
	#,Finish,up
	####################################
	
	#,Fix,the,FileLength,header
	uncompressedLength,=,o.tell()
	o.seek(4)
	o.write(struct.pack("I",,uncompressedLength)),,,
	o.flush()
	o.seek(0)
	
	#,Copy,the,temp,file,to,the,outFile,,compressing,if,necessary
	outFile,=,open(infile,,"wb")
	if,signature,==,b"FWS":	
		shutil.copyfileobj(o,,outFile)
	else:
		outFile.write(o.read(8)),#,File,is,compressed,after,header
		if,signature,==,b"CWS":
			outFile.write(zlib.compress(o.read()))
		elif,signature,==,b"ZWS":
			compressed,=,pylzma.compress(o.read())
			outputInt(outFile,,len(compressed)-5),#,LZMA,SWF,has,CompressedLength,header,field
			outFile.write(compressed)
		else:
			assert(false)
	
	outFile.close()
	
	if,passwordClear:
		print("Added,Telemetry,flag,with,encrypted,password,",+,passwordClear,+,",in,",+,infile)
	else:
		print("Added,Telemetry,flag,in,",+,infile)
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='cp949',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,cp950.py:,Python,Unicode,Codec,for,CP950
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_tw,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_tw.getcodec('cp950')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='cp950',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,euc_jisx0213.py:,Python,Unicode,Codec,for,EUC_JISX0213
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_jp,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_jp.getcodec('euc_jisx0213')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='euc_jisx0213',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,euc_jis_2004.py:,Python,Unicode,Codec,for,EUC_JIS_2004
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_jp,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_jp.getcodec('euc_jis_2004')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='euc_jis_2004',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,euc_jp.py:,Python,Unicode,Codec,for,EUC_JP
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_jp,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_jp.getcodec('euc_jp')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='euc_jp',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,euc_kr.py:,Python,Unicode,Codec,for,EUC_KR
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_kr,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_kr.getcodec('euc_kr')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='euc_kr',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,gb18030.py:,Python,Unicode,Codec,for,GB18030
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_cn,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_cn.getcodec('gb18030')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='gb18030',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,gb2312.py:,Python,Unicode,Codec,for,GB2312
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_cn,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_cn.getcodec('gb2312')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='gb2312',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,gbk.py:,Python,Unicode,Codec,for,GBK
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_cn,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_cn.getcodec('gbk')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='gbk',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
""",Python,'hex_codec',Codec,-,2-digit,hex,content,transfer,encoding
Unlike,most,of,the,other,codecs,which,target,Unicode,,this,codec
will,return,Python,string,objects,for,both,encode,and,decode.
Written,by,Marc-Andre,Lemburg,(mal@lemburg.com).
"""
import,codecs,,binascii
###,Codec,APIs
def,hex_encode(input,errors='strict'):
""",Encodes,the,object,input,and,returns,a,tuple,(output
object,,length,consumed).
errors,defines,the,error,handling,to,apply.,It,defaults,to
'strict',handling,which,is,the,only,currently,supported
error,handling,for,this,codec.
"""
assert,errors,==,'strict'
output,=,binascii.b2a_hex(input)
return,(output,,len(input))
def,hex_decode(input,errors='strict'):
""",Decodes,the,object,input,and,returns,a,tuple,(output
object,,length,consumed).
input,must,be,an,object,which,provides,the,bf_getreadbuf
buffer,slot.,Python,strings,,buffer,objects,and,memory
mapped,files,are,examples,of,objects,providing,this,slot.
errors,defines,the,error,handling,to,apply.,It,defaults,to
'strict',handling,which,is,the,only,currently,supported
error,handling,for,this,codec.
"""
assert,errors,==,'strict'
output,=,binascii.a2b_hex(input)
return,(output,,len(input))
class,Codec(codecs.Codec):
def,encode(self,,input,errors='strict'):
return,hex_encode(input,errors)
def,decode(self,,input,errors='strict'):
return,hex_decode(input,errors)
class,IncrementalEncoder(codecs.IncrementalEncoder):
def,encode(self,,input,,final=False):
assert,self.errors,==,'strict'
return,binascii.b2a_hex(input)
class,IncrementalDecoder(codecs.IncrementalDecoder):
def,decode(self,,input,,final=False):
assert,self.errors,==,'strict'
return,binascii.a2b_hex(input)
class,StreamWriter(Codec,codecs.StreamWriter):
pass
class,StreamReader(Codec,codecs.StreamReader):
pass
###,encodings,module,API
def,getregentry():
return,codecs.CodecInfo(
name='hex',
encode=hex_encode,
decode=hex_decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamwriter=StreamWriter,
streamreader=StreamReader,
)
""",Python,Character,Mapping,Codec,generated,from,'hp_roman8.txt',with,gencodec.py.
Based,on,data,from,ftp://dkuug.dk/i18n/charmaps/HP-ROMAN8,(Keld,Simonsen)
Original,source:,LaserJet,IIP,Printer,User's,Manual,HP,part,no
33471-90901,,Hewlet-Packard,,June,1989.
"""#"
import,codecs
###,Codec,APIs
class,Codec(codecs.Codec):
def,encode(self,input,errors='strict'):
return,codecs.charmap_encode(input,errors,encoding_map)
def,decode(self,input,errors='strict'):
return,codecs.charmap_decode(input,errors,decoding_map)
class,IncrementalEncoder(codecs.IncrementalEncoder):
def,encode(self,,input,,final=False):
return,codecs.charmap_encode(input,self.errors,encoding_map)[0]
class,IncrementalDecoder(codecs.IncrementalDecoder):
def,decode(self,,input,,final=False):
return,codecs.charmap_decode(input,self.errors,decoding_map)[0]
class,StreamWriter(Codec,codecs.StreamWriter):
pass
class,StreamReader(Codec,codecs.StreamReader):
pass
###,encodings,module,API
def,getregentry():
return,codecs.CodecInfo(
name='hp-roman8',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamwriter=StreamWriter,
streamreader=StreamReader,
)
###,Decoding,Map
decoding_map,=,codecs.make_identity_dict(range(256))
decoding_map.update({
0x00a1:,0x00c0,,#,,,,,,,LATIN,CAPITAL,LETTER,A,WITH,GRAVE
0x00a2:,0x00c2,,#,,,,,,,LATIN,CAPITAL,LETTER,A,WITH,CIRCUMFLEX
0x00a3:,0x00c8,,#,,,,,,,LATIN,CAPITAL,LETTER,E,WITH,GRAVE
0x00a4:,0x00ca,,#,,,,,,,LATIN,CAPITAL,LETTER,E,WITH,CIRCUMFLEX
0x00a5:,0x00cb,,#,,,,,,,LATIN,CAPITAL,LETTER,E,WITH,DIAERESIS
0x00a6:,0x00ce,,#,,,,,,,LATIN,CAPITAL,LETTER,I,WITH,CIRCUMFLEX
0x00a7:,0x00cf,,#,,,,,,,LATIN,CAPITAL,LETTER,I,WITH,DIAERESIS
0x00a8:,0x00b4,,#,,,,,,,ACUTE,ACCENT
0x00a9:,0x02cb,,#,,,,,,,MODIFIER,LETTER,GRAVE,ACCENT,(Mandarin,Chinese,fourth,tone)
0x00aa:,0x02c6,,#,,,,,,,MODIFIER,LETTER,CIRCUMFLEX,ACCENT
0x00ab:,0x00a8,,#,,,,,,,DIAERESIS
0x00ac:,0x02dc,,#,,,,,,,SMALL,TILDE
0x00ad:,0x00d9,,#,,,,,,,LATIN,CAPITAL,LETTER,U,WITH,GRAVE
0x00ae:,0x00db,,#,,,,,,,LATIN,CAPITAL,LETTER,U,WITH,CIRCUMFLEX
0x00af:,0x20a4,,#,,,,,,,LIRA,SIGN
0x00b0:,0x00af,,#,,,,,,,MACRON
0x00b1:,0x00dd,,#,,,,,,,LATIN,CAPITAL,LETTER,Y,WITH,ACUTE
0x00b2:,0x00fd,,#,,,,,,,LATIN,SMALL,LETTER,Y,WITH,ACUTE
0x00b3:,0x00b0,,#,,,,,,,DEGREE,SIGN
0x00b4:,0x00c7,,#,,,,,,,LATIN,CAPITAL,LETTER,C,WITH,CEDILLA
0x00b5:,0x00e7,,#,,,,,,,LATIN,SMALL,LETTER,C,WITH,CEDILLA
0x00b6:,0x00d1,,#,,,,,,,LATIN,CAPITAL,LETTER,N,WITH,TILDE
0x00b7:,0x00f1,,#,,,,,,,LATIN,SMALL,LETTER,N,WITH,TILDE
0x00b8:,0x00a1,,#,,,,,,,INVERTED,EXCLAMATION,MARK
0x00b9:,0x00bf,,#,,,,,,,INVERTED,QUESTION,MARK
0x00ba:,0x00a4,,#,,,,,,,CURRENCY,SIGN
0x00bb:,0x00a3,,#,,,,,,,POUND,SIGN
0x00bc:,0x00a5,,#,,,,,,,YEN,SIGN
0x00bd:,0x00a7,,#,,,,,,,SECTION,SIGN
0x00be:,0x0192,,#,,,,,,,LATIN,SMALL,LETTER,F,WITH,HOOK
0x00bf:,0x00a2,,#,,,,,,,CENT,SIGN
0x00c0:,0x00e2,,#,,,,,,,LATIN,SMALL,LETTER,A,WITH,CIRCUMFLEX
0x00c1:,0x00ea,,#,,,,,,,LATIN,SMALL,LETTER,E,WITH,CIRCUMFLEX
0x00c2:,0x00f4,,#,,,,,,,LATIN,SMALL,LETTER,O,WITH,CIRCUMFLEX
0x00c3:,0x00fb,,#,,,,,,,LATIN,SMALL,LETTER,U,WITH,CIRCUMFLEX
0x00c4:,0x00e1,,#,,,,,,,LATIN,SMALL,LETTER,A,WITH,ACUTE
0x00c5:,0x00e9,,#,,,,,,,LATIN,SMALL,LETTER,E,WITH,ACUTE
0x00c6:,0x00f3,,#,,,,,,,LATIN,SMALL,LETTER,O,WITH,ACUTE
0x00c7:,0x00fa,,#,,,,,,,LATIN,SMALL,LETTER,U,WITH,ACUTE
0x00c8:,0x00e0,,#,,,,,,,LATIN,SMALL,LETTER,A,WITH,GRAVE
0x00c9:,0x00e8,,#,,,,,,,LATIN,SMALL,LETTER,E,WITH,GRAVE
0x00ca:,0x00f2,,#,,,,,,,LATIN,SMALL,LETTER,O,WITH,GRAVE
0x00cb:,0x00f9,,#,,,,,,,LATIN,SMALL,LETTER,U,WITH,GRAVE
0x00cc:,0x00e4,,#,,,,,,,LATIN,SMALL,LETTER,A,WITH,DIAERESIS
0x00cd:,0x00eb,,#,,,,,,,LATIN,SMALL,LETTER,E,WITH,DIAERESIS
0x00ce:,0x00f6,,#,,,,,,,LATIN,SMALL,LETTER,O,WITH,DIAERESIS
0x00cf:,0x00fc,,#,,,,,,,LATIN,SMALL,LETTER,U,WITH,DIAERESIS
0x00d0:,0x00c5,,#,,,,,,,LATIN,CAPITAL,LETTER,A,WITH,RING,ABOVE
0x00d1:,0x00ee,,#,,,,,,,LATIN,SMALL,LETTER,I,WITH,CIRCUMFLEX
0x00d2:,0x00d8,,#,,,,,,,LATIN,CAPITAL,LETTER,O,WITH,STROKE
0x00d3:,0x00c6,,#,,,,,,,LATIN,CAPITAL,LETTER,AE
0x00d4:,0x00e5,,#,,,,,,,LATIN,SMALL,LETTER,A,WITH,RING,ABOVE
0x00d5:,0x00ed,,#,,,,,,,LATIN,SMALL,LETTER,I,WITH,ACUTE
0x00d6:,0x00f8,,#,,,,,,,LATIN,SMALL,LETTER,O,WITH,STROKE
0x00d7:,0x00e6,,#,,,,,,,LATIN,SMALL,LETTER,AE
0x00d8:,0x00c4,,#,,,,,,,LATIN,CAPITAL,LETTER,A,WITH,DIAERESIS
0x00d9:,0x00ec,,#,,,,,,,LATIN,SMALL,LETTER,I,WITH,GRAVE
0x00da:,0x00d6,,#,,,,,,,LATIN,CAPITAL,LETTER,O,WITH,DIAERESIS
0x00db:,0x00dc,,#,,,,,,,LATIN,CAPITAL,LETTER,U,WITH,DIAERESIS
0x00dc:,0x00c9,,#,,,,,,,LATIN,CAPITAL,LETTER,E,WITH,ACUTE
0x00dd:,0x00ef,,#,,,,,,,LATIN,SMALL,LETTER,I,WITH,DIAERESIS
0x00de:,0x00df,,#,,,,,,,LATIN,SMALL,LETTER,SHARP,S,(German)
0x00df:,0x00d4,,#,,,,,,,LATIN,CAPITAL,LETTER,O,WITH,CIRCUMFLEX
0x00e0:,0x00c1,,#,,,,,,,LATIN,CAPITAL,LETTER,A,WITH,ACUTE
0x00e1:,0x00c3,,#,,,,,,,LATIN,CAPITAL,LETTER,A,WITH,TILDE
0x00e2:,0x00e3,,#,,,,,,,LATIN,SMALL,LETTER,A,WITH,TILDE
0x00e3:,0x00d0,,#,,,,,,,LATIN,CAPITAL,LETTER,ETH,(Icelandic)
0x00e4:,0x00f0,,#,,,,,,,LATIN,SMALL,LETTER,ETH,(Icelandic)
0x00e5:,0x00cd,,#,,,,,,,LATIN,CAPITAL,LETTER,I,WITH,ACUTE
0x00e6:,0x00cc,,#,,,,,,,LATIN,CAPITAL,LETTER,I,WITH,GRAVE
0x00e7:,0x00d3,,#,,,,,,,LATIN,CAPITAL,LETTER,O,WITH,ACUTE
0x00e8:,0x00d2,,#,,,,,,,LATIN,CAPITAL,LETTER,O,WITH,GRAVE
0x00e9:,0x00d5,,#,,,,,,,LATIN,CAPITAL,LETTER,O,WITH,TILDE
0x00ea:,0x00f5,,#,,,,,,,LATIN,SMALL,LETTER,O,WITH,TILDE
0x00eb:,0x0160,,#,,,,,,,LATIN,CAPITAL,LETTER,S,WITH,CARON
0x00ec:,0x0161,,#,,,,,,,LATIN,SMALL,LETTER,S,WITH,CARON
0x00ed:,0x00da,,#,,,,,,,LATIN,CAPITAL,LETTER,U,WITH,ACUTE
0x00ee:,0x0178,,#,,,,,,,LATIN,CAPITAL,LETTER,Y,WITH,DIAERESIS
0x00ef:,0x00ff,,#,,,,,,,LATIN,SMALL,LETTER,Y,WITH,DIAERESIS
0x00f0:,0x00de,,#,,,,,,,LATIN,CAPITAL,LETTER,THORN,(Icelandic)
0x00f1:,0x00fe,,#,,,,,,,LATIN,SMALL,LETTER,THORN,(Icelandic)
0x00f2:,0x00b7,,#,,,,,,,MIDDLE,DOT
0x00f3:,0x00b5,,#,,,,,,,MICRO,SIGN
0x00f4:,0x00b6,,#,,,,,,,PILCROW,SIGN
0x00f5:,0x00be,,#,,,,,,,VULGAR,FRACTION,THREE,QUARTERS
0x00f6:,0x2014,,#,,,,,,,EM,DASH
0x00f7:,0x00bc,,#,,,,,,,VULGAR,FRACTION,ONE,QUARTER
0x00f8:,0x00bd,,#,,,,,,,VULGAR,FRACTION,ONE,HALF
0x00f9:,0x00aa,,#,,,,,,,FEMININE,ORDINAL,INDICATOR
0x00fa:,0x00ba,,#,,,,,,,MASCULINE,ORDINAL,INDICATOR
0x00fb:,0x00ab,,#,,,,,,,LEFT-POINTING,DOUBLE,ANGLE,QUOTATION,MARK
0x00fc:,0x25a0,,#,,,,,,,BLACK,SQUARE
0x00fd:,0x00bb,,#,,,,,,,RIGHT-POINTING,DOUBLE,ANGLE,QUOTATION,MARK
0x00fe:,0x00b1,,#,,,,,,,PLUS-MINUS,SIGN
0x00ff:,None,
})
###,Encoding,Map
encoding_map,=,codecs.make_encoding_map(decoding_map)
#
#,hz.py:,Python,Unicode,Codec,for,HZ
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_cn,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_cn.getcodec('hz')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='hz',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#,This,module,implements,the,RFCs,3490,(IDNA),and,3491,(Nameprep)
import,stringprep,,re,,codecs
from,unicodedata,import,ucd_3_2_0,as,unicodedata
#,IDNA,section,3.1
dots,=,re.compile(u"[\u002E\u3002\uFF0E\uFF61]")
#,IDNA,section,5
ace_prefix,=,"xn--"
uace_prefix,=,unicode(ace_prefix,,"ascii")
#,This,assumes,query,strings,,so,AllowUnassigned,is,true
def,nameprep(label):
#,Map
newlabel,=,[]
for,c,in,label:
if,stringprep.in_table_b1(c):
#,Map,to,nothing
continue
newlabel.append(stringprep.map_table_b2(c))
label,=,u"".join(newlabel)
#,Normalize
label,=,unicodedata.normalize("NFKC",,label)
#,Prohibit
for,c,in,label:
if,stringprep.in_table_c12(c),or,\
stringprep.in_table_c22(c),or,\
stringprep.in_table_c3(c),or,\
stringprep.in_table_c4(c),or,\
stringprep.in_table_c5(c),or,\
stringprep.in_table_c6(c),or,\
stringprep.in_table_c7(c),or,\
stringprep.in_table_c8(c),or,\
stringprep.in_table_c9(c):
raise,UnicodeError("Invalid,character,%r",%,c)
#,Check,bidi
RandAL,=,map(stringprep.in_table_d1,,label)
for,c,in,RandAL:
if,c:
#,There,is,a,RandAL,char,in,the,string.,Must,perform,further
#,tests:
#,1),The,characters,in,section,5.8,MUST,be,prohibited.
#,This,is,table,C.8,,which,was,already,checked
#,2),If,a,string,contains,any,RandALCat,character,,the,string
#,MUST,NOT,contain,any,LCat,character.
if,filter(stringprep.in_table_d2,,label):
raise,UnicodeError("Violation,of,BIDI,requirement,2")
#,3),If,a,string,contains,any,RandALCat,character,,a
#,RandALCat,character,MUST,be,the,first,character,of,the
#,string,,and,a,RandALCat,character,MUST,be,the,last
#,character,of,the,string.
if,not,RandAL[0],or,not,RandAL[-1]:
raise,UnicodeError("Violation,of,BIDI,requirement,3")
return,label
def,ToASCII(label):
try:
#,Step,1:,try,ASCII
label,=,label.encode("ascii")
except,UnicodeError:
pass
else:
#,Skip,to,step,3:,UseSTD3ASCIIRules,is,false,,so
#,Skip,to,step,8.
if,0,<,len(label),<,64:
return,label
raise,UnicodeError("label,empty,or,too,long")
#,Step,2:,nameprep
label,=,nameprep(label)
#,Step,3:,UseSTD3ASCIIRules,is,false
#,Step,4:,try,ASCII
try:
label,=,label.encode("ascii")
except,UnicodeError:
pass
else:
#,Skip,to,step,8.
if,0,<,len(label),<,64:
return,label
raise,UnicodeError("label,empty,or,too,long")
#,Step,5:,Check,ACE,prefix
if,label.startswith(uace_prefix):
raise,UnicodeError("Label,starts,with,ACE,prefix")
#,Step,6:,Encode,with,PUNYCODE
label,=,label.encode("punycode")
#,Step,7:,Prepend,ACE,prefix
label,=,ace_prefix,+,label
#,Step,8:,Check,size
if,0,<,len(label),<,64:
return,label
raise,UnicodeError("label,empty,or,too,long")
def,ToUnicode(label):
#,Step,1:,Check,for,ASCII
if,isinstance(label,,str):
pure_ascii,=,True
else:
try:
label,=,label.encode("ascii")
pure_ascii,=,True
except,UnicodeError:
pure_ascii,=,False
if,not,pure_ascii:
#,Step,2:,Perform,nameprep
label,=,nameprep(label)
#,It,doesn't,say,this,,but,apparently,,it,should,be,ASCII,now
try:
label,=,label.encode("ascii")
except,UnicodeError:
raise,UnicodeError("Invalid,character,in,IDN,label")
#,Step,3:,Check,for,ACE,prefix
if,not,label.startswith(ace_prefix):
return,unicode(label,,"ascii")
#,Step,4:,Remove,ACE,prefix
label1,=,label[len(ace_prefix):]
#,Step,5:,Decode,using,PUNYCODE
result,=,label1.decode("punycode")
#,Step,6:,Apply,ToASCII
label2,=,ToASCII(result)
#,Step,7:,Compare,the,result,of,step,6,with,the,one,of,step,3
#,label2,will,already,be,in,lower,case.
if,label.lower(),!=,label2:
raise,UnicodeError("IDNA,does,not,round-trip",,label,,label2)
#,Step,8:,return,the,result,of,step,5
return,result
###,Codec,APIs
class,Codec(codecs.Codec):
def,encode(self,input,errors='strict'):
if,errors,!=,'strict':
#,IDNA,is,quite,clear,that,implementations,must,be,strict
raise,UnicodeError("unsupported,error,handling,"+errors)
if,not,input:
return,"",,0
result,=,[]
labels,=,dots.split(input)
if,labels,and,len(labels[-1])==0:
trailing_dot,=,'.'
del,labels[-1]
else:
trailing_dot,=,''
for,label,in,labels:
result.append(ToASCII(label))
#,Join,with,U+002E
return,".".join(result)+trailing_dot,,len(input)
def,decode(self,input,errors='strict'):
if,errors,!=,'strict':
raise,UnicodeError("Unsupported,error,handling,"+errors)
if,not,input:
return,u"",,0
#,IDNA,allows,decoding,to,operate,on,Unicode,strings,,too.
if,isinstance(input,,unicode):
labels,=,dots.split(input)
else:
#,Must,be,ASCII,string
input,=,str(input)
unicode(input,,"ascii")
labels,=,input.split(".")
if,labels,and,len(labels[-1]),==,0:
trailing_dot,=,u'.'
del,labels[-1]
else:
trailing_dot,=,u''
result,=,[]
for,label,in,labels:
result.append(ToUnicode(label))
return,u".".join(result)+trailing_dot,,len(input)
class,IncrementalEncoder(codecs.BufferedIncrementalEncoder):
def,_buffer_encode(self,,input,,errors,,final):
if,errors,!=,'strict':
#,IDNA,is,quite,clear,that,implementations,must,be,strict
raise,UnicodeError("unsupported,error,handling,"+errors)
if,not,input:
return,("",,0)
labels,=,dots.split(input)
trailing_dot,=,u''
if,labels:
if,not,labels[-1]:
trailing_dot,=,'.'
del,labels[-1]
elif,not,final:
#,Keep,potentially,unfinished,label,until,the,next,call
del,labels[-1]
if,labels:
trailing_dot,=,'.'
result,=,[]
size,=,0
for,label,in,labels:
result.append(ToASCII(label))
if,size:
size,+=,1
size,+=,len(label)
#,Join,with,U+002E
result,=,".".join(result),+,trailing_dot
size,+=,len(trailing_dot)
return,(result,,size)
class,IncrementalDecoder(codecs.BufferedIncrementalDecoder):
def,_buffer_decode(self,,input,,errors,,final):
if,errors,!=,'strict':
raise,UnicodeError("Unsupported,error,handling,"+errors)
if,not,input:
return,(u"",,0)
#,IDNA,allows,decoding,to,operate,on,Unicode,strings,,too.
if,isinstance(input,,unicode):
labels,=,dots.split(input)
else:
#,Must,be,ASCII,string
input,=,str(input)
unicode(input,,"ascii")
labels,=,input.split(".")
trailing_dot,=,u''
if,labels:
if,not,labels[-1]:
trailing_dot,=,u'.'
del,labels[-1]
elif,not,final:
#,Keep,potentially,unfinished,label,until,the,next,call
del,labels[-1]
if,labels:
trailing_dot,=,u'.'
result,=,[]
size,=,0
for,label,in,labels:
result.append(ToUnicode(label))
if,size:
size,+=,1
size,+=,len(label)
result,=,u".".join(result),+,trailing_dot
size,+=,len(trailing_dot)
return,(result,,size)
class,StreamWriter(Codec,codecs.StreamWriter):
pass
class,StreamReader(Codec,codecs.StreamReader):
pass
###,encodings,module,API
def,getregentry():
return,codecs.CodecInfo(
name='idna',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamwriter=StreamWriter,
streamreader=StreamReader,
)
#
#,iso2022_jp.py:,Python,Unicode,Codec,for,ISO2022_JP
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_iso2022,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_iso2022.getcodec('iso2022_jp')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='iso2022_jp',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)
#
#,iso2022_jp_2.py:,Python,Unicode,Codec,for,ISO2022_JP_2
#
#,Written,by,Hye-Shik,Chang,<perky@FreeBSD.org>
#
import,_codecs_iso2022,,codecs
import,_multibytecodec,as,mbc
codec,=,_codecs_iso2022.getcodec('iso2022_jp_2')
class,Codec(codecs.Codec):
encode,=,codec.encode
decode,=,codec.decode
class,IncrementalEncoder(mbc.MultibyteIncrementalEncoder,
codecs.IncrementalEncoder):
codec,=,codec
class,IncrementalDecoder(mbc.MultibyteIncrementalDecoder,
codecs.IncrementalDecoder):
codec,=,codec
class,StreamReader(Codec,,mbc.MultibyteStreamReader,,codecs.StreamReader):
codec,=,codec
class,StreamWriter(Codec,,mbc.MultibyteStreamWriter,,codecs.StreamWriter):
codec,=,codec
def,getregentry():
return,codecs.CodecInfo(
name='iso2022_jp_2',
encode=Codec().encode,
decode=Codec().decode,
incrementalencoder=IncrementalEncoder,
incrementaldecoder=IncrementalDecoder,
streamreader=StreamReader,
streamwriter=StreamWriter,
)